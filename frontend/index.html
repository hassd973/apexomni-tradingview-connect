<!doctype html>

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta content="width=device-width, initial-scale=1.0" name="viewport" />
		<meta
			content="QuantumI Dashboard: Live crypto market analytics powered by CoinGecko, Etherscan, Dune, and TradingView across multiple chains."
			name="description"
		/>
		<meta
			content="crypto, dashboard, QuantumI, trading, analytics, multi-chain, Dune"
			name="keywords"
		/>
                <meta content="xAI" name="author" />
                <meta name="robots" content="noindex" />
                <title>QUANTUMI</title>
		<link
			href="https://i.postimg.cc/R6HKW38z/q-logo.png"
			rel="icon"
			type="image/png"
		/>
		<link
			href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
			rel="stylesheet"
		/>
                <link href="https://fonts.googleapis.com" rel="preconnect" />
                <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
                <link
                        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap"
                        rel="stylesheet"
                />
                <link
                        href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@200..900&amp;family=Limelight&amp;display=swap"
                        rel="stylesheet"
                />
                <link
                        href="https://fonts.googleapis.com/css2?family=Sixtyfour&amp;display=swap"
                        rel="stylesheet"
                />
                <link
                        href="https://api.fontshare.com/v2/css?f[]=satoshi@400,700&display=swap"
                        rel="stylesheet"
                />
		<script
			defer=""
			src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"
		></script>
		<script
			defer=""
			src="https://unpkg.com/@splinetool/viewer@1.9.98/build/spline-viewer.js"
			type="module"
		></script>
		<script defer="" src="https://s3.tradingview.com/tv.js"></script>
		<script
			defer=""
			src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"
		></script>
		<script
			defer=""
			src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/exporters/OBJExporter.js"
		></script>
		<script
			defer=""
			src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"
		></script>
		<script
			defer=""
			src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/exporters/FBXExporter.js"
		></script>
		<script src="https://www.youtube.com/iframe_api"></script>
                <style>
                        :root {
                                --quantumi-green: #00FF7E;
                                --quantumi-black: #010101;
                                --quantumi-white: #F8F8F8;
                                --quantumi-gray: #1A1A1A;
                                --quantumi-accent: #00FF7E;
                                --quantumi-radius: 18px;
                                --quantumi-blur: 18px;
                                --quantumi-glow: 0 0 20px var(--quantumi-green);

                                --bg-color: var(--quantumi-black);
                                --text-color: var(--quantumi-white);
                                --primary-color: var(--quantumi-green);
                                --secondary-color: var(--quantumi-green);
                                --shadow-color: rgba(0, 255, 126, 0.3);
                        }
                        body {
                                font-family: 'Inter', 'Segoe UI', sans-serif;
                                background: var(--bg-color);
                                color: var(--text-color);
                                margin: 0;
                                min-height: 100vh;
                                display: flex;
                                flex-direction: column;
                                line-height: 1.6;
                        }
                        body.locked > :not(#access-overlay) {
                                display: none !important;
                        }
                        h1,
                        h2 {
                                font-family: 'Satoshi', sans-serif;
                                color: var(--text-color);
                                text-shadow:
                                        0 0 8px var(--shadow-color),
                                        0 0 12px rgba(0, 255, 126, 0.3);
                        }
                        h3 {
                                font-family: 'Limelight', cursive;
                                color: var(--text-color);
                                text-shadow:
                                        0 0 8px var(--shadow-color),
                                        0 0 12px rgba(0, 255, 126, 0.3);
                        }
			.main-title,
			.sixtyfour-font {
				font-family: 'Sixtyfour', sans-serif;
			}
			#loading-screen {
				position: fixed;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				background: var(--bg-color);
				display: flex;
				flex-direction: column;
				justify-content: center;
				align-items: center;
				z-index: 1000;
				transition: opacity 0.5s ease;
			}
			#loading-screen .loading-video {
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				overflow: hidden;
				z-index: 0;
			}
			#loading-video-player {
				pointer-events: none;
			}
			#loading-screen .video-container {
				width: 100%;
				height: 100%;
			}
			#loading-screen video {
				width: 100%;
				height: 100%;
				object-fit: cover;
			}
			#loading-screen #loading-video-player,
			#loading-screen .loading-video iframe {
				width: 100%;
				height: 100%;
			}
			#mute-btn {
				position: absolute;
				bottom: 1rem;
				right: 1rem;
				background: rgba(0, 0, 0, 0.5);
				color: #fff;
				border: none;
				padding: 0.5rem;
				border-radius: 0.25rem;
				cursor: pointer;
				z-index: 1002;
				pointer-events: auto;
			}
			.intro-buttons {
				position: fixed;
				bottom: 1.5rem;
				left: 50%;
				transform: translateX(-50%);
				display: flex;
				justify-content: center;
				gap: 0.5rem;
				z-index: 1007;
				pointer-events: auto;
			}
			#play-intro-btn,
			#skip-intro-btn {
				background-color: var(--primary-color);
				color: #1e2727;
				border: 1px solid var(--shadow-color);
				border-radius: 9999px;
				padding: 0.25rem 0.75rem;
				font-size: 0.875rem;
				cursor: pointer;
				position: relative;
				z-index: 1005;
			}
			#play-intro-btn:hover,
			#skip-intro-btn:hover {
				background-color: var(--secondary-color);
				box-shadow: 0 0 8px var(--secondary-color);
			}
			@media (max-width: 640px) {
				#mute-btn {
					padding: 0.25rem;
					font-size: 0.75rem;
				}
			}
			.playlist-container {
				position: relative;
				width: 100%;
				max-width: 500px;
				aspect-ratio: 1 / 1;
				margin: 0 auto;
				display: flex;
				align-items: center;
				justify-content: center;
			}
			@media (max-width: 640px) {
				.playlist-container {
					max-width: 90vw;
				}
			}
			.video-container {
				position: relative;
				width: 100%;
				height: 100%;
				border: 1px solid rgba(255, 255, 255, 0.2);
				border-radius: 50px;
				overflow: hidden;
				box-shadow:
					inset 0 0 4px rgba(255, 255, 255, 0.3),
					0 0 4px var(--shadow-color);
			}
			.video-container::before {
				content: '';
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				background: rgba(0, 0, 0, 0.3);
				pointer-events: none;
			}
			.video-container iframe,
			.video-container > div {
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				border: 0;
				transform: scale(1.5);
				object-fit: cover;
				object-position: center;
			}
			#dj-dashboard {
				position: relative;
				max-height: 50vh;
				overflow-y: auto;
			}
			#dj-dashboard.locked {
				overflow-y: hidden;
			}
			#dj-activation-overlay {
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				display: flex;
				flex-direction: column;
				align-items: center;
				justify-content: center;
				background: rgba(0, 0, 0, 0.5);
				color: #fff;
				cursor: pointer;
				z-index: 20;
			}
			#dj-activation-overlay img {
				width: 60px;
				height: 60px;
				margin-bottom: 0.5rem;
			}
			#dj-activation-overlay.fade-out {
				opacity: 0;
				transition: opacity 0.5s ease;
			}
			#dj-activation-overlay:active img {
				animation: logoPulse 1s;
			}
			#dj-dashboard .video-container iframe,
			#dj-dashboard .video-container > div {
				transform: none;
			}
			#loading-screen .video-container iframe,
			#loading-screen .video-container > div {
				transform: none;
			}
			#music-player {
				width: 100%;
				height: 100%;
			}
			.video-overlay,
			.playlist-overlay {
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				display: flex;
				flex-wrap: wrap;
				gap: 0.5rem;
				align-items: center;
				justify-content: center;
				background: rgba(0, 0, 0, 0.1);
				color: var(--text-color);
				pointer-events: none;
				padding: 0.25rem;
				font-size: clamp(10px, 2vw, 14px);
			}
			#loading-screen .video-overlay {
				position: absolute;
				bottom: 20px;
				left: 20px;
				top: auto;
				width: auto;
				justify-content: flex-start;
				align-items: flex-end;
				z-index: 1002;
			}
			#music-mute-btn,
			#quantumi-sound-btn {
				background-color: var(--primary-color);
				color: #1e2727;
				border: 1px solid var(--shadow-color);
				font-size: 0.875rem;
				border-radius: 6px;
				padding: 0.5rem 1rem;
				transition:
					background-color 0.3s ease,
					box-shadow 0.3s ease;
				cursor: pointer;
			}
			#music-mute-btn:hover,
			#quantumi-sound-btn:hover,
			#music-mute-btn.active,
			#quantumi-sound-btn.active {
				background-color: var(--secondary-color);
				box-shadow: 0 0 8px var(--secondary-color);
			}
			.dj-track {
                                background: linear-gradient(
                                        135deg,
                                        rgba(0, 255, 126, 0.1),
                                        rgba(0, 0, 0, 0.2)
                                );
				border: 1px solid var(--shadow-color);
				border-radius: 8px;
				padding: 0.5rem;
				position: relative;
				display: flex;
				flex-direction: column;
				align-items: center;
			}
			.dj-track .playlist-container {
				position: relative;
				width: 600px;
				height: 300px;
				max-width: 100%;
				overflow: hidden;
				margin-left: auto;
				margin-right: auto;
			}
			.dj-track iframe {
				width: 100%;
				height: 100%;
				border-radius: 6px;
				transform: scale(1.05);
				pointer-events: none;
			}
			#dj-playlist {
				display: grid;
				grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
				gap: 0.5rem;
			}
			#dj-playlist .playlist-item {
				display: flex;
				align-items: center;
				gap: 0.5rem;
				background: rgba(0, 0, 0, 0.2);
				padding: 0.25rem;
				border-radius: 6px;
			}
			#dj-playlist img {
				width: 40px;
				height: 30px;
				object-fit: cover;
				border-radius: 4px;
			}
                        .metrics-overlay {
                                position: absolute;
                                top: 2%;
                                left: 50%;
                                transform: translateX(-50%);
                                width: calc(100% - 20px);
                                display: flex;
                                flex-direction: column;
                                align-items: center;
                                justify-content: center;
                                background: rgba(0, 0, 0, 0.15);
                                padding: 4px;
                                border-radius: 5px;
                                gap: 4px;
                                z-index: 15;
                                pointer-events: none;
                        }
                        #btc-metrics-overlay {
                                top: 0;
                                left: 0;
                                transform: none;
                                width: 100%;
                                padding: 0.5rem;
                                min-height: 2rem;
                                display: flex;
                                align-items: center;
                        }
                        #btc-metrics-overlay .metrics-container {
                                gap: 2px;
                                padding: 2px;
                        }
                        #btc-metrics-overlay .metric-main {
                                font-size: clamp(8px, 1.5vw, 12px);
                        }
                        #btc-metrics-overlay .metric-sub {
                                font-size: clamp(6px, 1.2vw, 10px);
                        }
                        #btc-metrics-overlay .metrics-row {
                                display: flex;
                                align-items: center;
                                justify-content: space-around;
                                width: 100%;
                                gap: 0.5rem;
                        }
			#btc-metrics-overlay .metrics-row .metric {
				flex: 1 1 auto;
				text-align: center;
				font-size: inherit;
			}
			.metrics-container {
				display: flex;
				flex-wrap: wrap;
				justify-content: center;
				gap: 4px;
				width: 100%;
			}
			#loading-screen .metrics-overlay {
				position: absolute;
				bottom: 0;
				left: 0;
				width: 100%;
				justify-content: center;
				align-items: flex-end;
				z-index: 1002;
				flex-direction: column;
				padding: 1rem;
			}
			#loading-screen .metrics-overlay .logo {
				position: absolute;
				bottom: 1rem;
				left: 1rem;
				width: 50px;
				height: 50px;
			}
			#loading-screen .metrics-overlay .metrics-container {
				position: absolute;
				top: 50%;
				left: 50%;
				transform: translate(-50%, -50%);
				display: flex;
				flex-direction: column;
				align-items: center;
				gap: 0.5rem;
			}
			.metric {
				flex: 0 1 45%;
				text-align: center;
				overflow: hidden;
				text-overflow: ellipsis;
				white-space: nowrap;
				font-size: clamp(10px, 2vw, 14px);
				min-width: 0;
			}
			.metric-main {
				font-weight: bold;
			}
			.metric-sub {
				font-size: clamp(12px, 2vw, 18px);
				opacity: 0.85;
			}
			.logo {
				width: 40px;
				height: 40px;
				margin: 0 auto 2px;
			}
			@keyframes logoPulse {
				0%,
				100% {
					filter: drop-shadow(0 0 0px #fff);
				}
				50% {
					filter: drop-shadow(0 0 6px #fff);
				}
			}
			.pulse {
				animation: logoPulse 3s infinite;
			}
			@media (max-width: 600px) {
				.metrics-overlay {
					flex-wrap: wrap;
				}
				.metric {
					font-size: 12px;
					margin: 2px;
				}
			}
			.dj-btn {
				background-color: rgba(255, 255, 255, 0.1);
				color: #fff;
				border: none;
				border-radius: 5px;
				padding: 0.5rem 1rem;
				cursor: pointer;
				transition:
					background-color 0.3s ease,
					transform 0.2s ease;
			}
			.dj-btn:hover {
				background-color: rgba(0, 0, 0, 0.5);
				transform: scale(1.05);
			}
			.dj-btn:hover {
				background-color: rgba(33, 150, 243, 0.6);
			}
			.dj-btn:active {
                                background-color: var(--primary-color);
			}
			.dj-btn:hover {
				background-color: rgba(255, 255, 255, 0.2);
			}
			.dj-btn:active {
				background-color: rgba(255, 255, 255, 0.3);
			}
			.dj-btn:hover {
				background-color: rgba(255, 255, 255, 0.2);
			}
			.dj-btn:active {
				background-color: rgba(255, 255, 255, 0.3);
			}
                        .dj-btn:hover {
                                background-color: rgba(0, 255, 126, 0.2);
                                box-shadow: 0 0 8px var(--primary-color);
                        }
                        .dj-btn:active {
                                background-color: rgba(0, 255, 126, 0.4);
                        }
                        .dj-error {
                                color: #f87171;
                                font-size: 0.75rem;
                                text-align: center;
                                margin-top: 0.25rem;
                                display: none;
                        }
                        @media (max-width: 640px) {
                                .dj-btn {
                                        padding: 0.25rem 0.5rem;
                                        font-size: 0.75rem;
                                }
                                #dj-deactivate-btn {
                                        font-size: 0.7rem;
                                        padding: 0.3rem 0.6rem;
                                        width: auto;
                                        max-width: 120px;
                                }
                        }
                        .dj-btn:hover {
                                background-color: rgba(0, 255, 126, 0.2);
                                box-shadow: 0 0 8px var(--primary-color);
                        }
                        .dj-btn:active {
                                background-color: rgba(0, 255, 126, 0.4);
                        }
			.dj-btn.active {
                                box-shadow: 0 0 8px 2px var(--primary-color);
			}
                        .dj-btn.inactive {
                                box-shadow: 0 0 8px 2px var(--secondary-color);
                        }
			#crossfader {
				background: linear-gradient(
					90deg,
					var(--primary-color),
					var(--secondary-color)
				);
				border-radius: 4px;
				height: 6px;
				appearance: none;
				width: 100%;
			}
			#crossfader::-webkit-slider-thumb {
				appearance: none;
				width: 14px;
				height: 14px;
				border-radius: 50%;
				background: var(--text-color);
				cursor: pointer;
			}
			#crossfader::-moz-range-thumb {
				width: 14px;
				height: 14px;
				border-radius: 50%;
				background: var(--text-color);
				cursor: pointer;
			}
			.fx-knob {
				appearance: none;
				width: 80px;
				height: 6px;
				border-radius: 4px;
				background: linear-gradient(
					90deg,
					var(--primary-color),
					var(--secondary-color)
				);
			}
			.fx-knob::-webkit-slider-thumb {
				appearance: none;
				width: 12px;
				height: 12px;
				border-radius: 50%;
				background: var(--text-color);
				cursor: pointer;
			}
			.fx-knob::-moz-range-thumb {
				width: 12px;
				height: 12px;
				border-radius: 50%;
				background: var(--text-color);
				cursor: pointer;
			}
			.dj-controls {
				position: relative;
			}
			.vinyl {
				position: absolute;
				bottom: 0.5rem;
				right: 0.5rem;
				width: 60px;
				height: 60px;
				border: 2px solid var(--secondary-color);
				border-radius: 50%;
				background: radial-gradient(
					circle,
					rgba(255, 255, 255, 0.15) 0%,
					rgba(0, 0, 0, 0.8) 70%
				);
				box-shadow: 0 0 6px var(--secondary-color);
				animation: spin 4s linear infinite;
				opacity: 0.8;
				pointer-events: none;
				z-index: 1;
			}
			.vinyl-disk {
				position: relative;
				width: 80%;
				max-width: 400px;
				aspect-ratio: 1 / 1;
				border-radius: 50%;
				margin: 0.5rem auto;
				background: radial-gradient(
					circle,
					rgba(255, 255, 255, 0.15) 5%,
					rgba(255, 255, 255, 0.05) 40%,
					rgba(0, 0, 0, 0.6) 80%
				);
                                border: 3px solid rgba(0, 255, 126, 0.6);
                                box-shadow: 0 0 8px rgba(0, 255, 126, 0.4);
				backdrop-filter: blur(4px);
				opacity: 0.85;
				transition:
					box-shadow 0.3s ease,
					border-color 0.3s ease;
			}
			.vinyl-disk::before {
				content: '';
				position: absolute;
				top: 50%;
				left: 50%;
				width: 40%;
				height: 40%;
				border-radius: 50%;
				background: url('https://i.postimg.cc/R6HKW38z/q-logo.png') no-repeat
					center/contain;
				opacity: 0.9;
				transform: translate(-50%, -50%);
				pointer-events: none;
			}
			.vinyl-disk::after {
				content: '';
				position: absolute;
				top: 50%;
				left: 50%;
				width: 20%;
				height: 20%;
				border-radius: 50%;
				background: rgba(0, 0, 0, 0.3);
				transform: translate(-50%, -50%);
			}
			.vinyl-disk.spinning {
				animation: spin 3s linear infinite;
				border-color: var(--primary-color);
				box-shadow: 0 0 12px var(--primary-color);
			}
			.vinyl-disk.paused {
				border-color: var(--secondary-color);
				box-shadow: 0 0 12px var(--secondary-color);
			}
			.cd-playing {
				animation: spin 4s linear infinite;
				box-shadow: 0 0 20px 5px rgba(0, 0, 255, 0.7);
			}
			@media (max-width: 640px) {
				.vinyl-disk {
					width: 90%;
					max-width: 280px;
				}
			}
			@keyframes spin {
				from {
					transform: rotate(0deg);
				}
				to {
					transform: rotate(360deg);
				}
			}
			/* intro buttons styling replaced by .intro-buttons section above */
                        #loading-screen .title-box {
                                border: none !important;
                                background: transparent;
                                font-size: 1.25rem;
                                padding: 0.5rem 1rem;
                                position: absolute;
                                top: 1rem;
                                left: 50%;
                                transform: translateX(-50%);
                                z-index: 1003;
                                display: block;
                        }
			#loading-screen .title-box h1 {
				font-size: 2rem;
				color: var(--text-color);
			}
			@media (max-width: 640px) {
				#loading-screen .title-box {
					font-size: 1rem;
					top: 0.5rem;
				}
				#loading-screen .title-box h1 {
					font-size: 1.5rem;
				}
				#loading-screen .metrics-overlay .logo {
					width: 40px;
					height: 40px;
				}
			}
			/* Ensure DJ track overlays are unaffected */
			#track-a-player .metrics-overlay,
			#track-b-player .metrics-overlay {
				position: absolute;
				top: 2%;
				left: 50%;
				transform: translateX(-50%);
				width: calc(100% - 20px);
				justify-content: center;
				align-items: center;
			}
                        header,
                        main,
                        footer {
                                opacity: 0;
                                transition: opacity 0.5s ease-in;
                        }
                        .scroll-module {
                                opacity: 0;
                                transform: translateY(20px);
                                transition: opacity 0.6s ease-out,
                                        transform 0.6s ease-out;
                        }
                        .scroll-module.in-view {
                                opacity: 1;
                                transform: none;
                        }
			#beta-banner {
				background: linear-gradient(
					90deg,
					var(--primary-color),
					var(--secondary-color)
				);
				color: #000;
				text-align: center;
				padding: 0.25rem 0;
				font-weight: bold;
				font-size: 0.875rem;
			}
			.spline-bg {
				position: fixed;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				z-index: -1;
				pointer-events: all;
				transition: opacity 0.3s ease;
			}
			.spline-bg.hidden {
				opacity: 0;
				pointer-events: none;
			}
			spline-viewer {
				width: 100%;
				height: 100%;
			}
			.snowflake {
				position: absolute;
				color: var(--text-color);
				font-size: 6px;
				animation: snowflake linear infinite;
				pointer-events: none;
				z-index: -1;
			}
			@keyframes snowflake {
				0% {
					transform: translate(0, 0) rotate(0deg);
					opacity: 0.6;
				}
				100% {
					transform: translate(calc(-20px + var(--drift)), 100vh) rotate(360deg);
					opacity: 0;
				}
			}
			.particles {
				position: fixed;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				pointer-events: none;
				z-index: -1;
			}
			.star {
				position: absolute;
				width: 1px;
				height: 1px;
                                background: rgba(0, 255, 126, 0.3);
				border-radius: 50%;
				animation: float 15s infinite linear;
			}
			@keyframes float {
				0% {
					transform: translate(0, 0);
					opacity: 0;
				}
				50% {
					opacity: 0.4;
				}
				100% {
					transform: translate(50px, -50px);
					opacity: 0;
				}
			}
			header,
			footer {
				background: rgba(35, 46, 46, 0.1);
				padding: 1rem;
				border-bottom: 1px solid var(--shadow-color);
			}
			footer {
				border-top: 1px solid var(--shadow-color);
			}
			main {
				flex: 1;
				padding: 1rem;
				position: relative;
				z-index: 5;
			}
			.chart-wrapper {
				position: relative;
			}
			@media (max-width: 640px) {
				.chart-wrapper .flex {
					flex-wrap: wrap;
				}
			}
			.chart-container {
				position: relative;
				width: 100%;
				height: calc(100vh - 320px);
				min-height: 250px;
				max-height: 600px;
				border: 1px solid var(--shadow-color);
				border-radius: 6px;
				box-shadow: 0 0 4px var(--shadow-color);
			}
			.chart-container.hidden {
				display: none;
			}
			.tradingview-widget-container {
				position: absolute !important;
				width: 100% !important;
				height: 100% !important;
			}
			.chart-loading {
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				display: flex;
				justify-content: center;
				align-items: center;
				background: rgba(35, 46, 46, 0.2);
				z-index: 10;
				color: var(--primary-color);
				font-size: 0.875rem;
			}
			#chart-container-modal {
				height: calc(90vh - 180px) !important;
				min-height: 300px;
				max-height: 700px;
			}
			@media (max-height: 600px) {
				.chart-container {
					height: 200px;
				}
				#chart-container-modal {
					height: 250px !important;
				}
			}
			@media (min-width: 1024px) {
				.chart-container {
					max-height: 600px;
				}
				#chart-container-modal {
					max-height: 700px;
				}
			}
			.chart-modal {
				display: none;
				position: fixed;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				background: rgba(35, 46, 46, 0.6);
				z-index: 50;
				justify-content: center;
				align-items: center;
				overflow-y: auto;
			}
			.chart-modal.active {
				display: flex;
			}
			.chart-modal-content {
				background: rgba(35, 46, 46, 0.2);
				padding: 1rem;
				border: 1px solid var(--shadow-color);
				border-radius: 6px;
				width: 95%;
				max-width: 1200px;
				max-height: 90vh;
				overflow-y: auto;
				box-shadow: 0 0 8px var(--shadow-color);
			}
			.spline-modal {
				display: none;
				position: fixed;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				background: rgba(35, 46, 46, 0.6);
				z-index: 50;
				justify-content: center;
				align-items: center;
				overflow: hidden;
			}
			.spline-modal.active {
				display: flex;
			}
			.spline-modal-content {
				width: 100%;
				height: 100%;
				position: relative;
				pointer-events: all;
			}
			.spline-modal-close,
			.spline-fullscreen-btn,
			button,
			#chat-send,
			#toggle-indicator-header,
			#toggle-indicator-modal,
			#toggle-background,
			#toggle-background-dock {
				background-color: var(--primary-color);
				color: #1e2727;
				border: 1px solid var(--shadow-color);
				font-size: 0.875rem;
				border-radius: 6px;
				padding: 0.5rem 1rem;
				transition:
					background-color 0.3s ease,
					box-shadow 0.3s ease;
			}
			.spline-modal-close:hover,
			.spline-fullscreen-btn:hover,
			button:hover,
			#chat-send:hover,
			#toggle-indicator-header:hover,
			#toggle-indicator-modal:hover,
			#toggle-background:hover,
			#toggle-background-dock:hover {
				background-color: var(--secondary-color);
				box-shadow: 0 0 8px var(--secondary-color);
			}
			.spline-modal-close {
				position: absolute;
				top: 1rem;
				right: 1rem;
			}
			.spline-fullscreen-btn {
				position: absolute;
				top: 1rem;
				right: 5rem;
			}
			section {
				background: rgba(35, 46, 46, 0.1);
				border: 1px solid var(--shadow-color);
				border-radius: 6px;
				padding: 1rem;
				min-width: 0;
				cursor: move;
				transition:
					transform 0.2s ease,
					box-shadow 0.2s ease;
				box-shadow: 0 0 4px var(--shadow-color);
			}
			@media (max-width: 639px) {
				section {
					cursor: default;
				}
			}
			section.dragging {
				opacity: 0.8;
				transform: scale(0.98);
				box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
				z-index: 100;
			}
			section:hover {
				box-shadow: 0 0 8px var(--shadow-color);
			}
                        .module-header {
                                display: flex;
                                justify-content: space-between;
                                align-items: center;
                                flex-wrap: wrap;
                                gap: 0.5rem;
                                margin-bottom: 0.75rem;
                        }

                        @media (max-width: 640px) {
                                .module-header {
                                        flex-direction: column;
                                        align-items: stretch;
                                        gap: 0.25rem;
                                }
                                .module-header button {
                                        font-size: 0.75rem;
                                        padding: 0.25rem 0.5rem;
                                        width: 100%;
                                }
                        }
                        .toggle-module-btn {
                                background: rgba(255, 255, 255, 0.05);
                                border: 1px solid var(--secondary-color);
                                border-radius: 9999px;
                                color: var(--primary-color);
                                font-size: 0.875rem;
                                cursor: pointer;
                                padding: 0.25rem 0.75rem;
                                transition: background-color 0.3s ease,
                                        color 0.3s ease;
                        }
                        .toggle-module-btn:hover {
                                background: var(--primary-color);
                                color: var(--bg-color);
                        }
			.module-content.hidden {
				display: none;
			}
			ul {
				scrollbar-width: thin;
				scrollbar-color: var(--primary-color) rgba(35, 46, 46, 0.2);
				list-style: none;
				padding: 0;
			}
			ul::-webkit-scrollbar {
				width: 6px;
			}
			ul::-webkit-scrollbar-track {
				background: rgba(35, 46, 46, 0.2);
			}
			ul::-webkit-scrollbar-thumb {
				background: var(--primary-color);
				border-radius: 4px;
			}
                        #token-list,
                        #profit-pairs,
                        #log-list,
                        #chat-list,
                        #gas-heatmap-list,
                        #balances-list,
                        #twitter-list {
                                max-height: 50vh;
                                overflow-y: auto;
                                padding-right: 4px;
                        }
                        #token-search {
                                background: rgba(35, 46, 46, 0.2);
                                color: var(--text-color);
                                width: 100%;
                                border-radius: 4px;
                        }
                        #token-search::placeholder {
                                color: #999;
                        }
                        #gas-heatmap-list,
                        #balances-list,
                        #youtube-list,
                        #twitter-list {
                                max-height: 20vh;
                        }
			#chat-list {
				height: calc(100vh - 200px);
			}
			@media (min-width: 640px) {
                                #token-list,
                                #profit-pairs,
                                #log-list,
                                #chat-list,
                                #gas-heatmap-list,
                                #balances-list,
                                #twitter-list {
                                        max-height: 60vh;
                                }
                                #gas-heatmap-list,
                                #balances-list,
                                #twitter-list {
                                        max-height: 20vh;
                                }
			}
                        #token-list li,
                        #profit-pairs li,
                        #gas-heatmap-list li,
                        #log-list li,
                        #balances-list li,
                        #twitter-list li {
                                display: flex;
                                flex-direction: column;
                                padding: 0.75rem;
				border-radius: 6px;
				margin-bottom: 0.5rem;
				transition: all 0.3s ease;
				cursor: pointer;
				font-size: 0.875rem;
				background: rgba(35, 46, 46, 0.2);
			}
                        #gas-heatmap-list li,
                        #log-list li,
                        #balances-list li,
                        #twitter-list li,
                        #youtube-list li {
                                font-size: 0.75rem;
                                padding: 0.5rem;
                                overflow-x: auto;
                                white-space: nowrap;
                                max-width: 100%;
                        }
                        #token-list li:hover,
                        #gas-heatmap-list li:hover,
                        #log-list li:hover,
                        #balances-list li:hover,
                        #twitter-list li:hover {
                                background: rgba(0, 255, 126, 0.1);
                                transform: translateX(2px);
                                box-shadow: 0 0 6px var(--shadow-color);
                        }
                        #token-list li.selected-token {
                                border: 1px solid var(--secondary-color);
                                background: rgba(0, 255, 126, 0.1);
                                box-shadow: 0 0 6px var(--shadow-color);
                        }
			#token-list .metric,
                        #profit-pairs .metric,
                        #gas-heatmap-list .metric,
                        #log-list .metric,
                        #balances-list .metric,
                        #twitter-list .metric {
                                font-size: 0.75rem;
                                color: var(--text-color);
                        }
                        #gas-heatmap-list .metric,
                        #log-list .metric,
                        #balances-list .metric,
                        #twitter-list .metric {
                                word-break: break-all;
                        }
			#token-list .performance,
			#profit-pairs .top-pair,
			#profit-pairs .bottom-pair {
				font-size: 0.875rem;
				font-weight: 700;
			}
			#profit-pairs .top-pair {
				color: var(--primary-color);
			}
                        #profit-pairs .bottom-pair {
                                color: var(--secondary-color);
                        }
                        #youtube-list {
                                max-height: 50vh;
                                overflow-y: auto;
                        }
                        #youtube-player iframe {
                                max-width: 100%;
                        }
                        .youtube-container {
                                max-width: 900px;
                                margin: 20px auto;
                        }
                        .yt-main {
                                display: flex;
                                gap: 0.75rem;
                                flex-wrap: wrap;
                        }
                        .yt-player-wrapper iframe {
                                width: 100%;
                                height: 400px;
                                border-radius: 8px;
                                box-shadow: 0 0 6px var(--shadow-color);
                        }
                        #yt-playlist-thumbs {
                                flex: 1;
                                min-width: 220px;
                                max-height: 400px;
                                overflow-y: auto;
                                background: rgba(35, 46, 46, 0.2);
                                border: 1px solid var(--shadow-color);
                                border-radius: 8px;
                                padding: 0.5rem;
                        }
                        #yt-playlist-thumbs .yt-thumb {
                                display: flex;
                                align-items: center;
                                gap: 0.5rem;
                                margin-bottom: 0.5rem;
                                cursor: pointer;
                                border-radius: 4px;
                                transition: background 0.2s;
                        }
                        #yt-playlist-thumbs .yt-thumb:hover {
                                background: rgba(0, 255, 126, 0.1);
                        }
                        #yt-playlist-thumbs .yt-thumb.active {
                                background: rgba(0, 255, 126, 0.2);
                        }
                        #yt-playlist-thumbs img {
                                width: 80px;
                                height: 45px;
                                object-fit: cover;
                                border-radius: 4px;
                        }
                        .extra-playlist {
                                margin-top: 1rem;
                        }
                        .extra-playlist iframe {
                                width: 100%;
                                height: 360px;
                                border-radius: 8px;
                                box-shadow: 0 0 6px var(--shadow-color);
                        }
                        .playlist-desc {
                                font-size: 0.875rem;
                                margin-top: 0.25rem;
                        }
                        .toggle-desc-btn {
                                background: none;
                                border: none;
                                color: var(--primary-color);
                                font-size: 0.75rem;
                                cursor: pointer;
                                margin-left: 0.5rem;
                        }
                        .rarible-embed {
                                max-width: 500px;
                                height: 500px;
                                overflow-y: auto;
                                margin: 0 auto;
                                scrollbar-width: thin;
                                scrollbar-color: var(--primary-color) var(--quantumi-black);
                                background: rgba(1, 1, 1, 0.6);
                                border: 1px solid var(--shadow-color);
                                border-radius: 8px;
                                padding: 0.5rem;
                        }
                        .rarible-embed.docked {
                                width: 100%;
                                height: 100%;
                                max-width: none;
                        }
                        .rarible-embed::-webkit-scrollbar {
                                width: 6px;
                        }
                        .rarible-embed::-webkit-scrollbar-thumb {
                                background-color: var(--primary-color);
                                border-radius: 6px;
                        }
                        .rarible-embed::-webkit-scrollbar-track {
                                background: var(--quantumi-black);
                        }
                        .nft-item {
                                margin-bottom: 1rem;
                        }
                        .nft-item iframe {
                                width: 100%;
                                height: 500px;
                                border: none;
                                cursor: pointer;
                                border-radius: 4px;
                        }
                        .twitter-feed,
                        .nft-gallery {
                                background: rgba(35, 46, 46, 0.2);
                                border: 1px solid var(--shadow-color);
                                border-radius: 8px;
                                padding: 0.5rem;
                                box-shadow: 0 0 6px var(--shadow-color);
                        }
                        .nft-modal {
                                display: none;
                                position: fixed;
                                top: 0;
                                left: 0;
                                width: 100%;
                                height: 100%;
                                background: rgba(0, 0, 0, 0.8);
                                z-index: 60;
                                justify-content: center;
                                align-items: center;
                        }
                        .nft-modal.active {
                                display: flex;
                        }
                        .nft-modal-content {
                                position: relative;
                                width: 90%;
                                max-width: 600px;
                                height: 90vh;
                                background: rgba(1, 1, 1, 0.9);
                                border: 1px solid var(--shadow-color);
                                border-radius: 8px;
                                box-shadow: 0 0 8px var(--shadow-color);
                                overflow: hidden;
                        }
                        .rarible-modal {
                                display: none;
                                position: fixed;
                                top: 0;
                                left: 0;
                                width: 100%;
                                height: 100%;
                                background: rgba(0, 0, 0, 0.8);
                                z-index: 60;
                                justify-content: center;
                                align-items: center;
                        }
                        .rarible-modal.active {
                                display: flex;
                        }
                        .rarible-modal-content {
                                position: relative;
                                width: 95vw;
                                height: 95vh;
                                background: rgba(35, 46, 46, 0.9);
                                border: 1px solid var(--shadow-color);
                                border-radius: 8px;
                                box-shadow: 0 0 8px var(--shadow-color);
                                overflow-y: auto;
                                display: flex;
                                justify-content: center;
                                align-items: center;
                                scrollbar-width: thin;
                                scrollbar-color: var(--primary-color) var(--quantumi-black);
                        }
                        .rarible-modal-content::-webkit-scrollbar {
                                width: 6px;
                        }
                        .rarible-modal-content::-webkit-scrollbar-thumb {
                                background-color: var(--primary-color);
                                border-radius: 6px;
                        }
                        .rarible-modal-content::-webkit-scrollbar-track {
                                background: var(--quantumi-black);
                        }
                        #rarible-modal-close {
                                position: absolute;
                                top: 0.25rem;
                                right: 0.25rem;
                                background: rgba(0, 0, 0, 0.5);
                                color: #fff;
                                border: none;
                                border-radius: 4px;
                                padding: 0.25rem 0.5rem;
                                cursor: pointer;
                        }
                        #nft-modal-frame {
                                width: 100%;
                                height: 100%;
                                border: none;
                        }
                        #nft-modal-close {
                                position: absolute;
                                top: 0.25rem;
                                right: 0.25rem;
                                background: rgba(0, 0, 0, 0.5);
                                color: #fff;
                                border: none;
                                border-radius: 4px;
                                padding: 0.25rem 0.5rem;
                                cursor: pointer;
                        }
                        #token-performance-chart {
                                cursor: pointer;
                        }
                        @media (max-width: 640px) {
                                #youtube-list li {
                                        flex-direction: column;
                                        font-size: 0.75rem;
                                }
                                #youtube-list img {
                                        width: 80px;
                                        height: 60px;
                                }
                        }
                        @keyframes pulse {
				0% {
					transform: scale(1);
				}
				50% {
					transform: scale(1.02);
				}
				100% {
					transform: scale(1);
				}
			}
			@keyframes fadeIn {
				from {
					opacity: 0;
					transform: translateY(10px);
				}
				to {
					opacity: 1;
					transform: translateY(0);
				}
			}
			@keyframes fadeOut {
				from {
					opacity: 1;
				}
				to {
					opacity: 0;
				}
			}
			.fade-in {
				animation: fadeIn 0.5s ease-in;
			}
			.fade-out {
				animation: fadeOut 0.5s forwards;
			}
			.hover-transition {
				transition: all 0.3s ease;
			}
			.hover-transition:hover {
                                background: rgba(0, 255, 126, 0.1);
			}
			.drop-target {
				border: 2px dashed var(--secondary-color);
			}
			.marquee-container {
				background: rgba(35, 46, 46, 0.2);
				border: 1px solid var(--shadow-color);
				overflow: hidden;
				white-space: nowrap;
				padding: 0.5rem 0;
				margin-top: 0.5rem;
				border-radius: 6px;
				box-shadow: 0 0 4px var(--shadow-color);
			}
			.marquee {
				display: inline-block;
				animation: marquee 80s linear infinite;
				animation-play-state: running;
			}
			@keyframes marquee {
				0% {
					transform: translateX(100%);
				}
				100% {
					transform: translateX(-100%);
				}
			}
			.marquee span {
				margin-right: 1rem;
				font-size: 0.875rem;
				color: var(--text-color);
			}
			@media (min-width: 640px) {
				.marquee span {
					font-size: 0.875rem;
				}
			}
			.marquee-container:hover .marquee {
				animation-play-state: paused;
			}
			.timeframe-btn.active {
				background-color: var(--secondary-color);
				box-shadow:
					0 0 8px var(--secondary-color),
                                        0 0 12px rgba(0, 255, 126, 0.6);
				border: 1px solid var(--secondary-color);
			}
			#chat-input {
				background: rgba(35, 46, 46, 0.2);
				border: 1px solid var(--shadow-color);
				color: var(--text-color);
				width: 100%;
				padding: 0.5rem;
				border-radius: 6px;
				font-size: 0.875rem;
			}
			#chat-input:focus {
				outline: none;
				border-color: var(--secondary-color);
				box-shadow: 0 0 6px var(--shadow-color);
			}
			.loader {
				display: flex;
				justify-content: center;
				align-items: center;
				padding: 0.5rem;
			}
			.loader::after {
				content: '';
				width: 14px;
				height: 14px;
				border: 2px solid var(--primary-color);
				border-top: 2px solid transparent;
				border-radius: 50%;
				animation: spin 1s linear infinite;
			}
			@keyframes spin {
				to {
					transform: rotate(360deg);
				}
			}
			.typewriter {
				display: inline-block;
				overflow: hidden;
				white-space: nowrap;
				border-right: 2px solid var(--primary-color);
				animation:
					typing 4s steps(30, end),
					blink-caret 0.75s step-end infinite;
			}
			@keyframes typing {
				from {
					width: 0;
				}
				to {
					width: 100%;
				}
			}
			@keyframes blink-caret {
				from,
				to {
					border-color: transparent;
				}
				50% {
					border-color: var(--primary-color);
				}
			}
			.title-box {
				color: var(--text-color);
				text-align: center;
				margin: 0 auto 1rem auto;
				background: rgba(35, 46, 46, 0.2);
				border: 2px solid var(--primary-color);
				border-radius: 6px;
				padding: 0.75rem 1rem;
				box-shadow: 0 0 4px var(--shadow-color);
				display: flex;
				justify-content: center;
				max-width: max-content;
				box-sizing: border-box;
			}
			.title-box h1 {
				animation: pulse 4s infinite;
			}
                        header .title-box {
                                margin-top: 1rem;
                                margin-left: auto;
                                margin-right: auto;
                                margin-bottom: 1.5rem;
                        }
                        @media (max-width: 640px) {
                                header .title-box {
                                        margin-bottom: 1.25rem;
                                }
				header .chart-wrapper .flex {
					flex-wrap: wrap;
					gap: 0.5rem;
				}
				.timeframe-btn,
				#toggle-indicator-header,
				#toggle-sticky-header,
				#toggle-background,
				#toggle-background-dock {
					font-size: 0.75rem;
					padding: 0.25rem 0.5rem;
				}
				header .chart-wrapper > .flex:last-child {
					justify-content: center;
					width: 100%;
				}
			}
			@media (min-width: 640px) {
				.title-box {
					font-size: 1.25rem;
				}
			}
			header.shrink .title-box {
				margin: 0 auto;
				padding: 0.5rem;
				animation: none;
			}
			header.shrink .title-box h1 {
				font-size: 1.25rem;
			}
			header.shrink p {
				display: none;
			}
			#chart-title-header,
			#chart-title-modal {
				text-align: center;
				padding: 0.5rem;
				border-radius: 6px;
				background: rgba(35, 46, 46, 0.2);
				font-size: 0.875rem;
				box-shadow: 0 0 4px var(--shadow-color);
			}
			@media (min-width: 640px) {
				#chart-title-header,
				#chart-title-modal {
					font-size: 1rem;
				}
			}
			[data-tooltip] {
				position: relative;
			}
			[data-tooltip]:hover::after,
			[data-tooltip]:focus::after {
				content: attr(data-tooltip);
				position: absolute;
				bottom: 100%;
				left: 50%;
				transform: translateX(-50%);
                                background: rgba(0, 255, 126, 0.8);
				color: #1e2727;
				padding: 0.25rem 0.5rem;
				border-radius: 4px;
				font-size: 0.75rem;
				white-space: nowrap;
				z-index: 60;
				box-shadow: 0 0 4px var(--shadow-color);
			}
                        .gas-heatmap-section,
                        .twitter-section,
                        .youtube-news-section {
                                display: flex;
                                flex-direction: column;
                                gap: 0.75rem;
                        }
                        .bluesky-box {
                                max-width: 500px;
                                margin: auto;
                                border: 1px solid var(--shadow-color);
                                border-radius: 8px;
                                padding: 16px;
                                box-shadow: 0 0 6px var(--shadow-color);
                                background: rgba(35, 46, 46, 0.2);
                        }
                        .bluesky-title {
                                color: var(--primary-color);
                                margin-bottom: 12px;
                        }
                        .bluesky-link {
                                display: inline-block;
                                margin-top: 12px;
                                padding: 8px 16px;
                                background-color: var(--primary-color);
                                color: white;
                                text-decoration: none;
                                border-radius: 20px;
                        }
                        .bsky-post {
                                border-bottom: 1px solid #444;
                                padding: 8px 0;
                                font-size: 0.85rem;
                        }
                        .bsky-post .post-date {
                                font-size: 0.75rem;
                                color: #888;
                        }
			.gas-heatmap-title,
			.twitter-title,
			.token-insights-title {
				overflow: hidden;
				text-overflow: ellipsis;
				white-space: nowrap;
			}
			#gas-heatmap-canvas {
				width: 100%;
				height: 20vh;
				border: 1px solid var(--shadow-color);
				border-radius: 6px;
				box-shadow: 0 0 4px var(--shadow-color);
				overflow: hidden;
			}
			@media (min-width: 640px) {
				#gas-heatmap-canvas {
					height: 25vh;
				}
			}
			#gas-heatmap-legend {
				display: flex;
				justify-content: center;
				gap: 1rem;
				margin-top: 0.5rem;
				font-size: 0.75rem;
				background: rgba(35, 46, 46, 0.2);
				padding: 0.5rem;
				border-radius: 6px;
			}
			@media (min-width: 640px) {
				#gas-heatmap-legend {
					font-size: 0.875rem;
				}
			}
			.legend-item {
				display: flex;
				align-items: center;
				gap: 0.25rem;
			}
			.legend-color {
				width: 10px;
				height: 10px;
				border-radius: 2px;
			}
			#live-logs-container,
			#chat-list,
			#balances-container,
			#token-insights-container {
				background: rgba(35, 46, 46, 0.2);
			}
			.data-warning {
                                background: rgba(0, 255, 126, 0.2);
				color: var(--secondary-color);
				padding: 0.5rem;
				border-radius: 6px;
				font-size: 0.75rem;
				margin-bottom: 0.5rem;
				text-align: center;
			}
			.chat-logs-container,
			.btc-hash-container,
			.balances-container,
			.token-insights-container {
				padding: 1rem;
				background: rgba(35, 46, 46, 0.1);
				border: 1px solid var(--shadow-color);
				border-radius: 6px;
				box-shadow: 0 0 4px var(--shadow-color);
				text-align: center;
			}
			.btc-hash-container section,
			.balances-container section,
			.token-insights-container section {
				border: none;
				box-shadow: none;
				padding: 0;
			}
			#btc-hash-canvas {
				width: 100% !important;
				height: 50vh !important;
				opacity: 0.8;
				overflow: hidden;
			}
			.btc-hash-svg {
				background: #000000;
				border: 1px solid var(--shadow-color);
				border-radius: 6px;
				box-shadow: 0 0 4px var(--shadow-color);
				position: relative;
			}
			#btc-audio-canvas {
				width: 100%;
				height: 80px;
				pointer-events: none;
			}
			@keyframes fadeIn {
				from {
					opacity: 0;
					transform: translateY(-20px);
				}
				to {
					opacity: 1;
					transform: translateY(0);
				}
			}
			@keyframes fadeOut {
				from {
					opacity: 1;
				}
				to {
					opacity: 0;
				}
			}
			@media (max-width: 640px) {
				#chat-list {
					max-height: 30vh;
				}
				.chat-logs-container,
				.btc-hash-container,
				.balances-container,
				.token-insights-container {
					padding: 0.5rem;
				}
				#chat-input {
					font-size: 0.75rem;
				}
				#chat-send {
					font-size: 0.75rem;
					padding: 0.25rem 0.5rem;
				}
			}
			.nav-menu {
				position: fixed;
				top: 0;
				left: 0;
				width: 250px;
				height: 100%;
				background: rgba(35, 46, 46, 0.9);
				z-index: 100;
				transform: translateX(-100%);
				transition: transform 0.3s ease;
			}
			.nav-menu.active {
				transform: translateX(0);
			}
			.nav-menu-content {
				padding: 2rem;
				color: var(--text-color);
			}
			.nav-menu-toggle {
				position: fixed;
				top: 1rem;
				left: 1rem;
				background: var(--primary-color);
				color: #1e2727;
				border: none;
				padding: 0.5rem;
				cursor: pointer;
				z-index: 101;
			}
			.nav-menu-toggle.hidden {
				display: none;
			}
			.nav-menu-close {
				position: absolute;
				top: 1rem;
				right: 1rem;
				background: none;
				border: none;
				color: var(--text-color);
				font-size: 1.5rem;
				cursor: pointer;
			}
                        #balances-legend,
                        #token-insights-legend {
                                margin-top: 0.5rem;
                                font-size: 0.75rem;
                                background: rgba(35, 46, 46, 0.2);
                                padding: 0.5rem;
                                border-radius: 6px;
                                display: flex;
                                flex-wrap: wrap;
                                justify-content: center;
                                gap: 0.25rem;
                        }
                        #btc-legend {
                                position: absolute;
                                bottom: 0;
                                left: 0;
                                right: 0;
                                margin-top: 0;
                                width: 100%;
                                background: rgba(0, 0, 0, 0.2);
                                z-index: 20;
                                display: flex;
                                align-items: center;
                                flex-wrap: wrap;
                                justify-content: center;
                                gap: 0.25rem;
                                padding: 0.5rem;
                                min-height: 2rem;
                                font-size: clamp(8px, 1.2vw, 12px);
                                pointer-events: none;
                        }
                        .nav-link {
                                display: block;
                                padding: 0.5rem 0;
                                color: var(--text-color);
                                text-decoration: none;
                                font-family: 'Satoshi', sans-serif;
                                transition: color 0.3s ease;
                        }
			.nav-link:hover {
				color: var(--secondary-color);
			}
			@media (max-width: 640px) {
				#dj-dashboard {
					max-height: 80vh;
					padding-bottom: 100px;
				}
				.dj-track {
					flex-direction: column;
					margin-bottom: 1.5rem;
				}
				.dj-track .mb-1 {
					display: flex;
					flex-wrap: wrap;
					gap: 0.25rem;
				}
				.dj-track .mb-1 input {
					flex: 1 0 100%;
				}
				.dj-track .mb-1 button {
					flex: 1 0 48%;
				}
				.dj-track .mt-1 {
					flex-wrap: wrap;
					gap: 0.25rem;
				}
				.playlist-container {
					width: 100%;
					max-width: 90vw;
					height: 160px;
					aspect-ratio: unset;
				}
                                .dj-controls {
                                        position: relative;
                                        background: rgba(18, 18, 18, 0.95);
                                        padding: 0.5rem 0;
                                        flex-direction: column;
                                        gap: 0.4rem;
                                        align-items: stretch;
                                        width: 100%;
                                        margin-top: 0.5rem;
                                }
                                .dj-controls > .flex {
                                        flex-wrap: wrap;
                                        gap: 0.4rem;
                                }
				.dj-btn,
				.dj-cue-btn {
					font-size: 0.75rem;
					padding: 0.3rem 0.5rem;
					flex: 1 0 100%;
					text-align: center;
				}
				.dj-track input {
					font-size: 0.75rem;
				}
				.fx-knob {
					width: 50px;
				}
				#dj-playlist {
					max-height: 25vh;
					font-size: 0.8rem;
				}
				.vinyl-disk {
					width: 85%;
					max-width: 180px;
				}
				#dj-playlist .playlist-item span {
					font-size: 0.75rem;
				}
                        .dj-controls input[type='range'] {
                                width: 100%;
                        }
                    }
                    #access-overlay {
                        position: fixed;
                        inset: 0;
                        width: 100%;
                        height: 100%;
                        background: rgba(15, 12, 41, 0.8);
                        z-index: 2000;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: var(--text-color);
                    }
                    #access-form {
                        background: rgba(0, 0, 0, 0.75);
                        padding: 2rem;
                        border-radius: 1rem;
                        text-align: center;
                        box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
                        width: 90%;
                        max-width: 22rem;
                    }
                    #access-form h2 {
                        font-size: 1.5rem;
                        margin-bottom: 1rem;
                        font-family: 'Limelight', cursive;
                    }
                    #access-form input,
                    #access-form button {
                        width: 100%;
                        margin-top: 0.75rem;
                        padding: 0.5rem;
                        border-radius: 0.25rem;
                        border: none;
                        color: #000;
                    }
                    #access-form button {
                        background: var(--primary-color);
                        cursor: pointer;
                    }
                    #access-form button:hover {
                        background: var(--secondary-color);
                    }
                    #access-form label {
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 0.875rem;
                        margin-top: 0.75rem;
                    }
                    #access-form label span {
                        margin-left: 0.5rem;
                    }
                    #access-error {
                        color: #f87171;
                        margin-top: 0.75rem;
                    }
                    #nda-link {
                        color: var(--secondary-color);
                        text-decoration: underline;
                    }
                    #overlay-description {
                        font-size: 0.875rem;
                        margin-top: 0.5rem;
                    }
                </style>
		<style>
                        html,
                        body {
                                max-width: 100%;
                                overflow-x: hidden;
                                font-family: 'Inter', sans-serif;
                                scroll-behavior: smooth;
                        }
			.module-card {
				border-radius: 0.75rem;
				background: linear-gradient(to bottom, #0f172a, #000);
                                border: 1px solid var(--secondary-color);
				padding: 1rem;
				margin-bottom: 1rem;
			}
			.custom-scroll::-webkit-scrollbar {
				width: 6px;
			}
			.custom-scroll::-webkit-scrollbar-thumb {
                                background-color: var(--secondary-color);
				border-radius: 6px;
			}
			.custom-scroll::-webkit-scrollbar-track {
				background: #1e293b;
			}
		</style>
		<style>
			#refreshWalletData,
			#chart-export-btn,
			#connectWallet,
			#toggleBalance,
			#toggleAddress {
				background-color: var(--primary-color) !important;
				color: #000 !important;
				transition: background-color 0.3s ease;
			}
			#refreshWalletData:hover,
			#chart-export-btn:hover,
			#connectWallet:hover,
			#toggleBalance:hover,
			#toggleAddress:hover {
                                background-color: var(--secondary-color) !important;
			}
			.cmc-link {
				color: var(--primary-color);
				cursor: pointer;
			}
			.cmc-link:hover {
				color: var(--secondary-color);
				text-decoration: underline;
			}
			.text-brand-blue {
				color: var(--primary-color);
			}
			.text-brand-orange {
				color: var(--secondary-color);
			}
			.zoom-btn {
				background-color: var(--primary-color);
				color: #000;
				border: none;
				padding: 0.25rem 0.5rem;
				border-radius: 4px;
				cursor: pointer;
			}
                        .zoom-btn:hover {
                                background-color: var(--secondary-color);
                        }
			.dj-cue-btn {
				background-color: var(--primary-color);
				color: #1e2727;
				border: 1px solid var(--shadow-color);
				border-radius: 6px;
				padding: 0.25rem 0.5rem;
				cursor: pointer;
			}
			.dj-cue-btn:hover {
				background-color: var(--secondary-color);
				box-shadow: 0 0 4px var(--secondary-color);
			}
		</style>
	</head>
        <body
                class="text-white min-h-screen flex flex-col overflow-x-hidden overflow-y-auto scrollbar-thin scrollbar-track-gray-900 scrollbar-thumb-[\#00FF7E]"
        >
                <div id="access-overlay">
                        <form id="access-form">
                                <h2>QuantumI Pre-Launch</h2>
                                <input type="password" id="access-password" placeholder="Password" required />
                                <input type="email" id="access-email" placeholder="Email" required />
                                <label>
                                        <input type="checkbox" id="access-nda" required />
                                        <span>I agree to the NDA</span>
                                </label>
                                <button type="submit">Enter</button>
                                <a id="nda-link" href="QuantumI_NDA_v3.pdf" download class="block mt-2 underline">Download NDA</a>
                                <p id="overlay-description" class="mt-2 text-sm">
                                        QuantumI visually standardizes and logs blockchain transactions, simplifying crypto analytics for everyone.
                                </p>
                                <div id="access-error" class="hidden"></div>
                        </form>
                </div>
		<button
			aria-label="Toggle navigation menu"
			class="nav-menu-toggle hidden"
			id="nav-menu-toggle"
			role="button"
		>
			
		</button>
		<div class="nav-menu" id="nav-menu">
			<button
				aria-label="Close navigation menu"
				class="nav-menu-close"
				id="nav-menu-close"
				role="button"
			>
				
			</button>
			<div class="nav-menu-content">
				<img
					alt="QuantumI Logo"
					class="w-16 h-16 mb-4"
					src="https://i.postimg.cc/R6HKW38z/q-logo.png"
				/>
				<h2 class="text-xl mb-2">QuantumI Dashboard</h2>
				<p>
					Real-time crypto analytics with CoinGecko, Etherscan, Dune, and
					TradingView across multiple chains.
				</p>
				<nav>
                                        <a class="nav-link" href="#world-module">QuantumI Insights</a>
                                        <a class="nav-link" href="#tokens-module">Tokens </a>
                                        <a class="nav-link" href="#gas-module">Gas &amp; Fees</a>
                                       <a class="nav-link" href="#balances-module">Finance Tweets</a>
                                       <a class="nav-link" href="#wallet-module">Wallet</a>
                                        <a class="nav-link" href="#btc-hash-module">BTC Hash</a>
					<a class="nav-link" href="#chat-logs-container">Chat &amp; Logs</a>
					<a class="nav-link" href="#" id="undock-background-link"
						>Undock Background</a
					>
				</nav>
			</div>
		</div>
		<div id="loading-screen">
			<div class="loading-video">
				<div class="video-container">
                                        <video
                                                id="intro-video"
                                                preload="auto"
                                                playsinline
                                                muted
                                                autoplay
                                                crossorigin="anonymous"
                                                class="w-full"
                                        >
						<source src="INTRO%20TRAILER.mp4" type="video/mp4" />
					</video>
					<div class="video-overlay metrics-overlay">
						<img
							src="https://i.postimg.cc/R6HKW38z/q-logo.png"
							alt="QuantumI Logo"
							class="logo"
						/>
						<span id="loading-price"></span>
						<span id="loading-topcoin"></span>
						<span id="loading-inverse"></span>
						<span id="loading-time"></span>
						<span id="loading-date"></span>
					</div>
					<button id="mute-btn" aria-label="Toggle mute"></button>
				</div>
				<div class="title-box">
                                        <h1 class="text-2xl md:text-3xl main-title">QUANTUMI </h1>
				</div>
				<div class="intro-buttons">
					<button id="play-intro-btn" aria-label="Play intro">
						Play Intro
					</button>
					<button
						id="skip-intro-btn"
						aria-label="Skip intro"
						onclick="hideLoadingScreen()"
					>
						Skip Intro
					</button>
				</div>
			</div>
		</div>
		<div class="spline-bg hidden" id="spline-bg">
			<spline-viewer
				url="https://prod.spline.design/fJRTSatt5qGHtFUW/scene.splinecode"
			></spline-viewer>
		</div>
		<div class="particles" id="particles"></div>
                <div id="beta-banner">QuantumI Alpha Version Pro </div>
		<header class="w-full flex justify-center items-center">
			<div class="w-full max-w-[98vw] mx-auto px-4">
                                <div class="title-box">
                                        <h1 class="text-2xl md:text-3xl main-title">QUANTUMI </h1>
                                </div>
				<p class="text-base text-center">
					Real-time cryptocurrency market data and analytics powered by
					CoinGecko, Etherscan, Dune, and TradingView across multiple chains.
				</p>
				<div class="chart-wrapper w-full">
					<div class="flex flex-wrap justify-between items-center mb-4 gap-2">
						<div class="flex flex-wrap space-x-2 gap-2">
							<button
								aria-label="Switch to 1-minute chart"
								class="timeframe-btn"
								data-interval="1"
								data-tooltip="1-minute chart"
								id="header-timeframe-1min"
								role="button"
							>
								1M
							</button>
							<button
								aria-label="Switch to 5-minute chart"
								class="timeframe-btn"
								data-interval="5"
								data-tooltip="5-minute chart"
								id="header-timeframe-5min"
								role="button"
							>
								5M
							</button>
							<button
								aria-label="Switch to 15-minute chart"
								class="timeframe-btn"
								data-interval="15"
								data-tooltip="15-minute chart"
								id="header-timeframe-15min"
								role="button"
							>
								15M
							</button>
							<button
								aria-label="Switch to 1-hour chart"
								class="timeframe-btn"
								data-interval="60"
								data-tooltip="1-hour chart"
								id="header-timeframe-1hr"
								role="button"
							>
								1H
							</button>
							<button
								aria-label="Switch to daily chart"
								class="timeframe-btn active"
								data-interval="D"
								data-tooltip="Daily chart"
								id="header-timeframe-1d"
								role="button"
							>
								1D
							</button>
						</div>
						<div class="flex flex-wrap space-x-2 gap-2">
							<button
								aria-label="Toggle QuantumI indicator"
								data-tooltip="Toggle QuantumI indicator"
								id="toggle-indicator-header"
								role="button"
							>
								Toggle Indicator
							</button>
							<button
								aria-label="Open chart in modal"
								data-tooltip="Open chart in modal"
								id="toggle-sticky-header"
								role="button"
							>
								Dock Chart
							</button>
							<button
								aria-label="Dock background in modal"
								data-tooltip="Dock background in modal"
								id="toggle-background"
								role="button"
							>
								Dock Background
							</button>
							<button
								aria-label="Turn on background"
								data-tooltip="Enable 3D background (may slow site)"
								id="toggle-background-dock"
								role="button"
							>
								Turn On Background
							</button>
						</div>
						<div
							class="data-warning"
							id="background-warning"
							style="display: none"
						>
							 3D background may slow down the site
						</div>
					</div>
					<div class="flex justify-between items-center mb-4 flex-wrap gap-2">
						<div class="text-sm" id="live-price-header">
							&gt; Live Price: Loading...
						</div>
					</div>
					<div class="chart-container" id="chart-container-header">
						<div class="chart-loading">
							<div class="loader"></div>
							<div class="ml-2">Loading chart...</div>
						</div>
					</div>
					<h3 class="mt-2" id="chart-title-header">Loading...</h3>
					<div class="marquee-container">
						<div class="marquee" id="ticker-marquee-header">
							<span>Loading market data...</span>
						</div>
					</div>
				</div>
			</div>
		</header>
		<div class="chart-modal" id="chart-modal">
			<div class="chart-modal-content">
				<div class="chart-wrapper w-full">
					<div class="flex flex-wrap justify-between items-center mb-4 gap-2">
						<div class="flex flex-wrap space-x-2 gap-2">
							<button
								aria-label="Switch to 1-minute chart"
								class="timeframe-btn"
								data-interval="1"
								data-tooltip="1-minute chart"
								id="modal-timeframe-1min"
								role="button"
							>
								1M
							</button>
							<button
								aria-label="Switch to 5-minute chart"
								class="timeframe-btn"
								data-interval="5"
								data-tooltip="5-minute chart"
								id="modal-timeframe-5min"
								role="button"
							>
								5M
							</button>
							<button
								aria-label="Switch to 15-minute chart"
								class="timeframe-btn"
								data-interval="15"
								data-tooltip="15-minute chart"
								id="modal-timeframe-15min"
								role="button"
							>
								15M
							</button>
							<button
								aria-label="Switch to 1-hour chart"
								class="timeframe-btn"
								data-interval="60"
								data-tooltip="1-hour chart"
								id="modal-timeframe-1hr"
								role="button"
							>
								1H
							</button>
							<button
								aria-label="Switch to daily chart"
								class="timeframe-btn active"
								data-interval="D"
								data-tooltip="Daily chart"
								id="modal-timeframe-1d"
								role="button"
							>
								1D
							</button>
						</div>
						<div class="flex flex-wrap space-x-2 gap-2">
							<button
								aria-label="Toggle QuantumI indicator"
								data-tooltip="Toggle QuantumI indicator"
								id="toggle-indicator-modal"
								role="button"
							>
								Toggle Indicator
							</button>
							<button
								aria-label="Close chart modal"
								data-tooltip="Close chart modal"
								id="toggle-sticky-modal"
								role="button"
							>
								Undock Chart
							</button>
						</div>
					</div>
					<div class="flex justify-between items-center mb-4 flex-wrap gap-2">
						<div class="text-sm" id="live-price-modal">
							&gt; Live Price: Loading...
						</div>
					</div>
					<div class="chart-container" id="chart-container-modal">
						<div class="chart-loading">
							<div class="loader"></div>
							<div class="ml-2">Loading chart...</div>
						</div>
					</div>
					<h3 class="mt-2" id="chart-title-modal">Loading...</h3>
					<div class="marquee-container">
						<div class="marquee" id="ticker-marquee-modal">
							<span>Loading market data...</span>
						</div>
					</div>
				</div>
			</div>
		</div>
                <div class="spline-modal" id="spline-modal">
                        <div class="spline-modal-content">
				<button
					aria-label="Toggle fullscreen"
					class="spline-fullscreen-btn"
					id="spline-fullscreen-btn"
					role="button"
				>
					Fullscreen
				</button>
				<button
					aria-label="Close spline modal"
					class="spline-modal-close"
					id="spline-modal-close"
					role="button"
				>
					Undock
				</button>
				<spline-viewer
					id="spline-viewer-modal"
					url="https://prod.spline.design/fJRTSatt5qGHtFUW/scene.splinecode"
				></spline-viewer>
                        </div>
                </div>
                <div class="nft-modal" id="nft-modal">
                        <div class="nft-modal-content">
                                <button id="nft-modal-close" aria-label="Close NFT view">Close</button>
                                <iframe id="nft-modal-frame" allowfullscreen loading="lazy"></iframe>
                        </div>
                </div>
                <div class="rarible-modal" id="rarible-modal">
                        <div class="rarible-modal-content">
                                <button id="rarible-modal-close" aria-label="Close NFTs view">Close</button>
                        </div>
                </div>
                <main
                        class="flex-1 p-4 w-full max-w-[98vw] mx-auto grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"
                        id="module-grid"
                >
                        <section class="rounded-lg youtube-news-section" draggable="true" id="world-module">
                                <div class="module-header">
                                <h2 class="text-lg md:text-xl token-insights-title typewriter">
                                                &gt; QuantumI Insights
                                        </h2>
                                        <button
                                                aria-label="Toggle module visibility"
                                                class="toggle-module-btn"
                                                data-tooltip="Toggle module visibility"
                                                role="button"
                                        >
                                                
                                        </button>
                                </div>
                                <div class="module-content">
                                        <p class="text-sm mb-2">
                                                QuantumI Insights is your curated gateway to the cutting edge of technology and world events.
                                        </p>
                                        <div class="extra-playlists">
                                                <div class="extra-playlist">
                                                        <div class="flex items-center justify-between">
                                                                <h3>Y Combinator: Startup School</h3>
                                                                <button class="toggle-desc-btn" type="button">Info</button>
                                                        </div>
                                                        <p class="playlist-desc hidden">
                                                                Get behind the curtain of emerging startups, hear live pitches, technical roundtables, and founder storiesall focusing on artificial intelligence, scaling products, and building the next generation of innovation.
                                                        </p>
                                                        <iframe src="https://www.youtube.com/embed/videoseries?list=PLQ-uHSnFig5NPx4adxl97CZb8vU4numwi" allowfullscreen></iframe>
                                                </div>
                                                <div class="extra-playlist">
                                                        <div class="flex items-center justify-between">
                                                                <h3>The Guardian</h3>
                                                                <button class="toggle-desc-btn" type="button">Info</button>
                                                        </div>
                                                        <p class="playlist-desc hidden">
                                                                Stay informed with in-depth coverage from The Guardianranging from geopolitics and global crises to culture and policy shifts. Insights you can trust, delivered clearly and contextually.
                                                        </p>
                                                <iframe src="https://www.youtube.com/embed/videoseries?list=PLa_1MA_DEorHsfi3ntZ8ME6n3rTKM_uGQ" allowfullscreen></iframe>
                                                </div>
                                                <div class="extra-playlist">
                                                        <div class="flex items-center justify-between">
                                                                <h3>AI & Blockchain Research</h3>
                                                                <button class="toggle-desc-btn" type="button">Info</button>
                                                        </div>
                                                        <p class="playlist-desc hidden">
                                                                Lectures and discussions on cutting-edge AI and blockchain advancements.
                                                        </p>
                                                        <iframe src="https://www.youtube.com/embed/videoseries?list=PLvKrZQfu6htWeHwqRFQ9uBYVb2lLZURTS" allowfullscreen></iframe>
                                                </div>
                                        </div>
                                </div>
                        </section>
                        <section class="rounded-lg" draggable="true" id="tokens-module">
				<div class="module-header">
					<h2 class="text-lg md:text-xl typewriter">&gt; Tokens</h2>
					<button
						aria-label="Toggle module visibility"
						class="toggle-module-btn"
						data-tooltip="Toggle module visibility"
						role="button"
					>
						
					</button>
				</div>
				<div class="module-content">
					<div
						class="loader text-center text-gray-500 text-sm"
						id="loader-tokens"
					>
						&gt; Loading...
					</div>
                                        <div class="data-warning" id="token-warning" style="display: none">
                                                &gt; Live data from Dune API
                                        </div>
                                        <input
                                                type="text"
                                                id="token-search"
                                                placeholder="Search tokens"
                                                class="w-full p-1 mb-2 rounded bg-gray-800 text-sm"
                                        />
                                        <ul class="space-y-2 text-sm" id="token-list"></ul>
					<div class="mt-4">
						<h3 class="text-base md:text-lg mb-2 typewriter">
							&gt; Performers
						</h3>
						<ul class="space-y-2 text-sm" id="profit-pairs"></ul>
					</div>
					<div class="mt-4">
						<h3 class="text-base md:text-lg mb-2 typewriter">
							&gt; Top USDT Pairs
						</h3>
						<ul
							class="text-sm text-gray-500 flex flex-wrap gap-2"
							id="top-pairs"
						></ul>
					</div>
					<div class="mt-4">
						<h3 class="text-base md:text-lg mb-2 typewriter">
							&gt; Token Performance
						</h3>
						<canvas id="token-performance-chart"></canvas>
					</div>
					<button
						aria-label="Export token data as CSV"
						class="mt-2"
						data-tooltip="Export token data as CSV"
						id="export-tokens"
						role="button"
					>
						Export CSV
					</button>
				</div>
			</section>
			<section
				class="rounded-lg gas-heatmap-section"
				draggable="true"
				id="gas-module"
			>
				<div class="module-header">
					<h2 class="text-lg md:text-xl gas-heatmap-title typewriter">
						&gt; Multi-Chain Gas &amp; Fees
					</h2>
					<button
						aria-label="Toggle module visibility"
						class="toggle-module-btn"
						data-tooltip="Toggle module visibility"
						role="button"
					>
						
					</button>
				</div>
				<div class="module-content">
					<div
						class="loader text-center text-gray-500 text-sm"
						id="loader-gas-fees"
					>
						&gt; Loading...
					</div>
					<div class="data-warning" id="gas-fees-warning" style="display: none">
						&gt; Live data from Dune API
					</div>
					<div class="flex flex-col gap-4">
						<div>
							<h3 class="text-base md:text-lg mb-2">
								Gas Heatmap (Multi-Chain)
							</h3>
							<canvas id="gas-heatmap-canvas"></canvas>
							<div id="gas-heatmap-legend">
								<div class="legend-item">
                                                                        <div class="legend-color" style="background: var(--primary-color)"></div>
									<span>Safe</span>
								</div>
								<div class="legend-item">
                                                                        <div class="legend-color" style="background: var(--secondary-color)"></div>
									<span>Propose</span>
								</div>
								<div class="legend-item">
									<div class="legend-color" style="background: #ff0000"></div>
									<span>Fast</span>
								</div>
							</div>
							<ul class="space-y-2 text-sm mt-2" id="gas-heatmap-list"></ul>
						</div>
						<div>
							<h3 class="text-base md:text-lg mb-2">Fees</h3>
							<ul class="space-y-2 text-sm" id="fees-list">
								<li class="p-2 rounded">
									<div>
										Transfer Fee (ETH):
										<span id="transfer-fee">Loading...</span> USD
									</div>
								</li>
								<li class="p-2 rounded">
									<div>
										Withdraw Fee: <span id="withdraw-fee">Loading...</span> USD
									</div>
								</li>
								<li class="p-2 rounded">
									<div>
										Bridge Fee: <span id="bridge-fee">Loading...</span> USD
									</div>
								</li>
							</ul>
						</div>
					</div>
					<button
						aria-label="Export gas data as CSV"
						class="mt-2"
						data-tooltip="Export gas data as CSV"
						id="export-gas"
						role="button"
					>
						Export CSV
					</button>
				</div>
			</section>
                        <section
                                class="rounded-lg twitter-section"
                                draggable="true"
                                id="balances-module"
                        >
                                <div class="module-header">
                                        <h2 class="text-lg md:text-xl twitter-title typewriter">
                                                &gt; Finance Tweets
                                        </h2>
                                        <button
                                                aria-label="Toggle module visibility"
                                                class="toggle-module-btn"
                                                data-tooltip="Toggle module visibility"
                                                role="button"
                                        >
                                                
                                        </button>
                                        <button id="rarible-dock-btn" class="ml-2 dj-btn" aria-label="Dock NFTs">Dock NFTs</button>
                                </div>
                                <div class="module-content">
                                        <div
                                                class="loader text-center text-gray-500 text-sm"
                                                id="loader-twitter"
                                        >
                                                &gt; Loading tweets...
                                        </div>
                                        <div class="data-warning" id="twitter-warning" style="display: none">
                                                &gt; Using cached tweets
                                        </div>
                                        <div class="twitter-feed">
                                                <div id="twitter-timeline">
                                                        <p>Loading timeline...</p>
                                                </div>
                                                <ul id="twitter-list" style="display: none"></ul>
                                        </div>
                                <div class="nft-gallery mt-4">
                                        <div id="loader-rarible" class="loader text-center text-gray-500 text-sm">
                                                &gt; Loading NFTs...
                                        </div>
                                        <div id="rarible-container" class="rarible-embed custom-scroll" style="display:block;">
                                                <div class="nft-item">
                                                <iframe src="https://rarible.com/token/0xb66a603f4cfe17e3d27b87a8bfcad319856518b8:22936115272184638310144869580050457590453526233528138311905466789674025484289" loading="lazy" allowfullscreen></iframe>
                                                </div>
                                                <div class="nft-item">
                                                <iframe src="https://rarible.com/token/0xc9154424b823b10579895ccbe442d41b9abd96ed:22936115272184638310144869580050457590453526233528138311905466789674025484291" loading="lazy" allowfullscreen></iframe>
                                                </div>
                                                <div class="nft-item">
                                                <iframe src="https://rarible.com/token/0xc9154424b823b10579895ccbe442d41b9abd96ed:22936115272184638310144869580050457590453526233528138311905466789674025484292" loading="lazy" allowfullscreen></iframe>
                                                </div>
                                        </div>
                                </div>
                                </div>
                        </section>
                        <section class="rounded-lg" draggable="true" id="inverse-winners-module">
				<div class="module-header">
					<h2 class="text-lg md:text-xl typewriter">Inverse Metrics</h2>
					<button
						aria-label="Toggle module visibility"
						class="toggle-module-btn"
						data-tooltip="Toggle module visibility"
						role="button"
					>
						
					</button>
				</div>
				<div class="module-content">
					<div class="flex flex-wrap justify-between items-center mb-3">
						<div>
							<label class="text-white mr-2 text-sm" for="chartTypeToggle"
								>Metric:</label
							>
							<select
								class="bg-gray-800 text-white text-sm px-2 py-1 rounded"
								id="chartTypeToggle"
							>
								<option selected="" value="correlation">Correlation</option>
								<option value="change_24h">24h % Change</option>
							</select>
						</div>
						<div>
							<label class="text-white mr-2 text-sm" for="topCount">Top:</label>
							<select
								class="bg-gray-800 text-white text-sm px-2 py-1 rounded"
								id="topCount"
							>
								<option selected="" value="5">Top 5</option>
								<option value="10">Top 10</option>
								<option value="20">Top 20</option>
							</select>
							<button
								class="ml-4 text-white px-3 py-1 rounded text-sm"
								id="chart-export-btn"
								onclick="exportChart()"
							>
								 Export
							</button>
						</div>
					</div>
					<canvas
						class="w-full max-w-3xl mx-auto h-72 md:h-96"
						id="inverseChart"
					></canvas>
				</div>
			</section>
			<section
				class="rounded-lg col-span-full"
				draggable="true"
                                id="wallet-module"
			>
				<div class="module-header flex justify-between items-center">
                                        <h2 class="text-lg md:text-xl text-white"> Wallet & Tokens</h2>
					<div class="flex gap-2">
						<button
							class="text-white py-1 px-4 rounded text-sm"
							id="connectWallet"
						>
							 Connect Wallet
						</button>
						<button
							class="text-white py-1 px-4 rounded text-sm"
							id="refreshWalletData"
						>
							 Refresh Wallet
						</button>
						<button
							class="text-white py-1 px-2 rounded text-xs"
							id="toggleBalance"
						>
							Hide Balance
						</button>
						<button
							class="text-white py-1 px-2 rounded text-xs"
							id="toggleAddress"
						>
							Show Address
						</button>
					</div>
				</div>
                                <div class="module-content text-white">
                                        <div
                                                class="loader text-center text-gray-500 text-sm"
                                                id="loader-balances"
                                        >
                                                &gt; Loading wallet...
                                        </div>
                                        <div class="data-warning" id="balances-warning" style="display: none">
                                                &gt; Using cached balances
                                        </div>
                                        <div class="wallet-info my-2">
						<p>
							<strong>Wallet Address:</strong>
							<span id="wallet-address">Not connected</span>
						</p>
						<p>
							<strong>ETH Balance:</strong> <span id="wallet-balance">-</span>
						</p>
						<p>
							<strong>Detected Exchange:</strong>
							<span id="detected-exchange">Scanning...</span>
						</p>
						<p><strong>Token Count:</strong> <span id="token-count">0</span></p>
						<p><strong>Last Tx:</strong> <span id="last-tx">N/A</span></p>
						<p>
							<strong>Track Status:</strong>
							<span id="wallet-track-status">-</span>
						</p>
					</div>
                                        <ul
                                                class="list-disc ml-4 text-sm text-gray-300"
                                                id="balances-list"
                                        ></ul>
				</div>
			</section>
		</main>
		<div class="btc-hash-container w-full max-w-[98vw] mx-auto text-center">
			<section class="rounded-lg" draggable="true" id="btc-hash-module">
				<div class="module-header">
					<h2 class="text-lg md:text-xl sixtyfour-font">
						&gt; BTC Hash Visualization
					</h2>
					<button
						aria-label="Toggle module visibility"
						class="toggle-module-btn"
						data-tooltip="Toggle module visibility"
						role="button"
					>
						
					</button>
					<button
						id="hash-log-toggle"
						aria-label="Toggle hash log"
						class="ml-2 dj-btn"
						data-tooltip="Toggle hash log"
						role="button"
					>
						Show Log
					</button>
                                        <button
                                                id="legend-toggle"
                                                aria-label="Toggle legend"
                                                class="ml-2 dj-btn"
                                                data-tooltip="Toggle legend"
                                                role="button"
                                        >
                                                Show Legend
                                        </button>
                                        <button
                                                id="btc-fullscreen-btn"
                                                aria-label="Toggle fullscreen"
                                                class="ml-2 dj-btn"
                                                role="button"
                                        >
                                                Fullscreen
                                        </button>
                                        <button id="dj-dock-btn" class="ml-2 dj-btn">Dock DJ</button>
                                </div>
				<div class="module-content">
					<div class="data-warning" id="btc-hash-warning" style="display: none">
						&gt; Live data from Dune API
					</div>
                                        <div class="btc-hash-svg relative" id="btc-hash-canvas">
                                                <canvas
                                                        id="btc-audio-canvas"
                                                        width="600"
                                                        height="80"
                                                        class="absolute top-0 left-0 w-full pointer-events-none"
                                                ></canvas>
                                                <div id="btc-metrics-overlay" class="metrics-overlay">
                                                        <div class="metrics-row">
                                                                <span id="btc-overlay-price" class="metric metric-main"></span>
                                                                <img
                                                                        src="https://i.postimg.cc/R6HKW38z/q-logo.png"
                                                                        alt="QuantumI Logo"
                                                                        class="logo"
                                                                />
                                                                <span id="btc-overlay-loss" class="metric metric-main"></span>
                                                        </div>
                                                        <div class="metrics-row">
                                                                <span
                                                                        id="btc-overlay-hashrate"
                                                                        class="metric metric-sub"
                                                                ></span>
                                                                <span
                                                                        id="btc-overlay-difficulty"
                                                                        class="metric metric-sub"
                                                                ></span>
                                                                <span
                                                                        id="btc-overlay-mode"
                                                                        class="metric metric-sub"
                                                                ></span>
                                                        </div>
                                                </div>
                                                <div id="btc-legend">
                                                        <span id="btc-price">Price: Loading...</span>
                                                        <span id="btc-time">Time: Loading...</span>
                                                        <span id="btc-date">Date: Loading...</span>
                                                        <span id="btc-volume">Volume: Loading...</span>
                                                        <span id="btc-volatility">Volatility: Loading...</span>
                                                        <span id="btc-momentum">Momentum: Loading...</span>
                                                        <span id="camera-pos">Pos: 0,0,0</span>
                                                </div>
                                        </div>
					<div
						class="mt-2 flex justify-center gap-2"
						id="btc-color-legend"
					></div>
					<div class="mt-2 flex justify-center gap-2" id="btc-theme-controls">
						<label for="btc-theme-select" class="text-sm text-white mr-2"
							>Theme:</label
						>
						<select
							id="btc-theme-select"
							class="bg-gray-800 text-white text-sm px-2 py-1 rounded"
						>
							<option value="original">Original</option>
                                                        <option value="heatmap" selected>Heat Map</option>
							<option value="lifecycle">Life Cycle</option>
						</select>
					</div>
					<div class="mt-2 flex justify-center gap-2" id="btc-zoom-controls">
						<button class="zoom-btn" id="btc-zoom-in" aria-label="Zoom in">
							+
						</button>
						<button class="zoom-btn" id="btc-zoom-out" aria-label="Zoom out">
							-
						</button>
						<button class="zoom-btn" id="btc-zoom-z0" aria-label="Center">
							Z0
						</button>
						<button class="zoom-btn" id="btc-zoom-z1" aria-label="Zoom 1">
							-Z1
						</button>
						<button class="zoom-btn" id="btc-zoom-z2" aria-label="Zoom 2">
							-Z2
						</button>
					</div>
					<div class="mt-4 text-sm hidden" id="btc-legend-explanation">
						<h3 class="text-base md:text-lg mb-2">Legend</h3>
						<p>The rotating 3D hash visualizes real-time Bitcoin blocks.</p>
						<p>
							Original theme uses site colors; Heat Map reflects bullish and
							bearish momentum; Life Cycle shades blocks by age.
						</p>
						<p>
							Clouds rise with audio volume, and hovering the legend reveals
							price and time for each cluster.
						</p>
					</div>
                                        <button
                                                aria-label="Export as OBJ"
                                                class="mt-2"
                                                data-tooltip="Export as OBJ"
                                                id="export-obj"
                                                role="button"
                                        >
                                                Export OBJ
                                        </button>
                                        <button
                                                aria-label="Export as FBX"
                                                class="mt-2"
                                                data-tooltip="Export as FBX"
                                                id="export-fbx"
                                                role="button"
                                        >
                                                Export FBX
                                        </button>
                                        <div class="mt-4 hidden" id="btc-hash-log">
						<h3 class="text-base md:text-lg mb-2">Hash Log</h3>
						<ul class="space-y-2 text-sm" id="hash-log-list"></ul>
						<button
							aria-label="Export hash log as CSV"
							class="mt-2"
							data-tooltip="Export hash log as CSV"
							id="export-hash-log"
							role="button"
						>
							Export CSV
						</button>
					</div>
				</div>
			</section>
		</div>
		<section
			id="dj-dashboard"
			class="rounded-lg w-full max-w-[98vw] mx-auto text-center mt-4 custom-scroll locked"
		>
			<div
				id="dj-activation-overlay"
				class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center cursor-pointer z-20 text-white"
			>
				<img
					src="https://i.postimg.cc/R6HKW38z/q-logo.png"
					alt="QuantumI Logo"
					class="logo"
				/>
				<span>Tap to activate DJ</span>
			</div>
			<div class="flex justify-between items-center">
				<h2 class="text-lg md:text-xl">&gt; QuantumI DJ</h2>
				<button id="dj-deactivate-btn" class="dj-btn">Deactivate DJ</button>
			</div>
			<div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
				<div class="dj-track flex-1" draggable="true">
					<div class="mb-1 flex justify-center gap-2">
						<input
							id="track-a-url"
							class="p-1 rounded text-sm"
							placeholder="Search"
						/>
						<button id="track-a-load" class="dj-btn">Load A</button>
						<button id="track-a-setcue" class="dj-cue-btn">Set Cue</button>
						<button id="track-a-cue" class="dj-cue-btn">Cue</button>
					</div>
                                        <div class="playlist-container video-container">
                                                <div id="track-a-player"></div>
                                                <div class="metrics-overlay">
                                                        <img
                                                                src="https://i.postimg.cc/R6HKW38z/q-logo.png"
                                                                alt="QuantumI Logo"
								class="logo pulse"
							/>
                                                        <div class="metrics-container">
                                                                <span id="track-a-price" class="metric metric-main"></span>
                                                                <span id="track-a-topcoin" class="metric metric-main"></span>
                                                                <span id="track-a-time" class="metric metric-sub"></span>
                                                                <span id="track-a-inverse" class="metric metric-sub"></span>
                                                        </div>
                                                </div>
                                        </div>
                                        <div id="track-a-error" class="dj-error">Video unavailable, please try another track.</div>
                                        <div class="mt-1 flex gap-2 justify-center">
                                                <button id="track-a-back" class="dj-btn">&#9664;&#9664;</button>
						<button id="track-a-play" class="dj-btn">Play</button>
						<button id="track-a-pause" class="dj-btn">Pause</button>
						<button id="track-a-forward" class="dj-btn">&#9654;&#9654;</button>
						<button
							id="track-a-stop"
							class="dj-btn"
							onclick="trackAPlayer.stopVideo()"
						>
							Stop
						</button>
						<button id="track-a-mute" class="dj-btn">Unmute</button>
						<input
							id="track-a-volume"
							type="range"
							min="0"
							max="100"
							value="50"
							class="w-24 fx-knob"
						/>
					</div>
					<div class="vinyl-disk paused" id="vinyl-a"></div>
				</div>
				<div class="dj-track flex-1" draggable="true">
					<div class="mb-1 flex justify-center gap-2">
						<input
							id="track-b-url"
							class="p-1 rounded text-sm"
							placeholder="Search"
						/>
						<button id="track-b-load" class="dj-btn">Load B</button>
						<button id="track-b-setcue" class="dj-cue-btn">Set Cue</button>
						<button id="track-b-cue" class="dj-cue-btn">Cue</button>
					</div>
                                        <div class="playlist-container video-container">
                                                <div id="track-b-player"></div>
                                                <div class="metrics-overlay">
                                                        <img
                                                                src="https://i.postimg.cc/R6HKW38z/q-logo.png"
                                                                alt="QuantumI Logo"
								class="logo pulse"
							/>
                                                        <div class="metrics-container">
                                                                <span id="track-b-price" class="metric metric-main"></span>
                                                                <span id="track-b-topcoin" class="metric metric-main"></span>
                                                                <span id="track-b-time" class="metric metric-sub"></span>
                                                                <span id="track-b-inverse" class="metric metric-sub"></span>
                                                        </div>
                                                </div>
                                        </div>
                                        <div id="track-b-error" class="dj-error">Video unavailable, please try another track.</div>
                                        <div class="mt-1 flex gap-2 justify-center">
                                                <button id="track-b-back" class="dj-btn">&#9664;&#9664;</button>
						<button id="track-b-play" class="dj-btn">Play</button>
						<button id="track-b-pause" class="dj-btn">Pause</button>
						<button id="track-b-forward" class="dj-btn">&#9654;&#9654;</button>
						<button
							id="track-b-stop"
							class="dj-btn"
							onclick="trackBPlayer.stopVideo()"
						>
							Stop
						</button>
						<button id="track-b-mute" class="dj-btn">Unmute</button>
						<input
							id="track-b-volume"
							type="range"
							min="0"
							max="100"
							value="50"
							class="w-24 fx-knob"
						/>
					</div>
					<div class="vinyl-disk paused" id="vinyl-b"></div>
				</div>
			</div>
			<div
				id="dj-playlist"
				class="mt-2 max-h-40 overflow-y-auto text-sm custom-scroll w-full"
			></div>
			<div class="flex flex-col items-center mt-2 dj-controls">
				<input
					id="crossfader"
					type="range"
					min="0"
					max="1"
					step="0.01"
					value="0.5"
					class="w-full md:w-2/3"
				/>
				<div class="mt-2 flex gap-2">
					<button id="dj-play" class="dj-btn">Play Both</button>
					<button id="dj-stop" class="dj-btn">Stop</button>
					<button id="dj-shuffle" class="dj-btn">Shuffle</button>
					<button id="auto-blend" class="dj-btn">Auto Blend</button>
					<button id="record-mix" class="dj-btn">Record</button>
					<a id="download-mix" class="dj-btn" style="display: none" href="#"
						>Download</a
					>
					<button id="surround-toggle" class="dj-btn">Surround</button>
					<button id="volume-bars-toggle" class="dj-btn">Bars</button>
				</div>
				<div
					class="mt-2 flex flex-wrap gap-2 items-center text-sm justify-center"
				>
					<label for="delay-knob">Delay</label>
					<input
						id="delay-knob"
						class="fx-knob"
						type="range"
						min="0"
						max="1"
						step="0.01"
						value="0.25"
					/>
					<label for="reverb-knob">Reverb</label>
					<input
						id="reverb-knob"
						class="fx-knob"
						type="range"
						min="0"
						max="1"
						step="0.01"
						value="0.5"
					/>
					<label for="decimate-knob">Decimate</label>
					<input
						id="decimate-knob"
						class="fx-knob"
						type="range"
						min="0"
						max="1"
						step="0.01"
						value="0.1"
					/>
					<label for="lofi-knob">LoFi</label>
					<input
						id="lofi-knob"
						class="fx-knob"
						type="range"
						min="0"
						max="1"
						step="0.01"
						value="0.5"
					/>
					<label for="repeat-knob">Repeat</label>
					<input
						id="repeat-knob"
						class="fx-knob"
						type="range"
						min="0"
						max="1"
						step="0.01"
						value="0"
					/>
				</div>
				<div class="vinyl" id="vinyl-visual"></div>
			</div>
		</section>
		<div class="chat-logs-container w-full max-w-[98vw] mx-auto text-center">
			<div class="module-header">
				<h2 class="text-lg md:text-xl typewriter">
					&gt; Trading Bot &amp; System Logs
				</h2>
				<button
					aria-label="Toggle visibility"
					class="toggle-module-btn"
					data-tooltip="Toggle visibility"
					role="button"
				>
					
				</button>
			</div>
			<div class="module-content">
				<div class="mt-4">
					<h3 class="text-base md:text-lg mb-2">System Logs</h3>
					<div
                                                class="max-h-[30vh] overflow-y-auto scrollbar-thin scrollbar-track-gray-800 scrollbar-thumb-green-400 p-2 rounded text-sm"
						id="live-logs-container"
					>
						<ul class="space-y-2" id="system-logs-list">
							<li class="p-2 rounded">
								<div>System initialized successfully</div>
								<div class="metric">Time: 13:14:01</div>
							</li>
							<li class="p-2 rounded">
								<div>API connection established</div>
								<div class="metric">Time: 13:14:05</div>
							</li>
							<li class="p-2 rounded">
								<div>Data feed active: CoinGecko</div>
								<div class="metric">Time: 13:14:10</div>
							</li>
							<li class="p-2 rounded">
								<div>TradingView widget loaded</div>
								<div class="metric">Time: 13:14:15</div>
							</li>
						</ul>
					</div>
				</div>
				<div class="loader text-center text-gray-500 text-sm" id="loader-chat">
					&gt; Loading...
				</div>
				<div
                                        class="flex-grow overflow-y-auto p-2 space-y-2 scroll-smooth scrollbar-thin scrollbar-track-gray-800 scrollbar-thumb-green-400 text-sm"
					id="chat-list"
				></div>
				<div class="mt-4 flex flex-col sm:flex-row gap-2">
					<input
						aria-label="Chat input"
						class="p-2 rounded"
						data-tooltip="Type your query"
						id="chat-input"
						placeholder="Ask ChatGPT..."
						type="text"
					/>
					<button
						aria-label="Send chat message"
						class="px-4 py-2 rounded"
						data-tooltip="Send message"
						id="chat-send"
						role="button"
					>
						Send
					</button>
				</div>
			</div>
		</div>
		<footer class="text-center text-gray-500 text-sm">
			<p class="typewriter">
				Powered by CoinGecko, Etherscan, Dune &amp; TradingView
			</p>
		</footer>
		<script>
			const DOM = {
				navMenuToggle: document.getElementById('nav-menu-toggle'),
				navMenuClose: document.getElementById('nav-menu-close'),
				navMenu: document.getElementById('nav-menu'),
				loadingScreen: document.getElementById('loading-screen'),
				particleContainer: document.getElementById('particles'),
				moduleGrid: document.getElementById('module-grid'),
				toggleIndicatorHeaderBtn: document.getElementById(
					'toggle-indicator-header'
				),
				toggleIndicatorModalBtn: document.getElementById(
					'toggle-indicator-modal'
				),
				toggleStickyHeader: document.getElementById('toggle-sticky-header'),
				toggleStickyModal: document.getElementById('toggle-sticky-modal'),
				chartModal: document.getElementById('chart-modal'),
				tokenList: document.getElementById('token-list'),
				toggleBackgroundBtn: document.getElementById('toggle-background'),
				toggleBackgroundDockBtn: document.getElementById(
					'toggle-background-dock'
				),
				splineModal: document.getElementById('spline-modal'),
				splineModalCloseBtn: document.getElementById('spline-modal-close'),
				splineFullscreenBtn: document.getElementById('spline-fullscreen-btn'),
				chatSendBtn: document.getElementById('chat-send'),
				chatInput: document.getElementById('chat-input'),
				chatList: document.getElementById('chat-list'),
				exportTokensBtn: document.getElementById('export-tokens'),
				exportGasBtn: document.getElementById('export-gas'),
				tokenPerformanceChart: document.getElementById(
					'token-performance-chart'
				),
                                exportObjBtn: document.getElementById('export-obj'),
                                exportFbxBtn: document.getElementById('export-fbx'),
                                btcFullscreenBtn: document.getElementById('btc-fullscreen-btn'),
                                zoomInBtn: document.getElementById('btc-zoom-in'),
				zoomOutBtn: document.getElementById('btc-zoom-out'),
				zoomZ0Btn: document.getElementById('btc-zoom-z0'),
				zoomZ1Btn: document.getElementById('btc-zoom-z1'),
				zoomZ2Btn: document.getElementById('btc-zoom-z2'),
				undockBackgroundLink: document.getElementById('undock-background-link'),
				exportHashLogBtn: document.getElementById('export-hash-log'),
				exportBalancesBtn: document.getElementById('export-balances'),
                                balancesList: document.getElementById('balances-list'),
                                tokenSearch: document.getElementById('token-search'),
				loaderBalances: document.getElementById('loader-balances'),
				balancesWarning: document.getElementById('balances-warning'),
                                tokenInsightsWarning: document.getElementById('token-insights-warning'),
                                twitterTimeline: document.getElementById('twitter-timeline'),
                                loaderTwitter: document.getElementById('loader-twitter'),
                                twitterWarning: document.getElementById('twitter-warning'),
				duneVersion: document.getElementById('dune-version'),
				walletTrackStatus: document.getElementById('wallet-track-status'),
				muteBtn: document.getElementById('mute-btn'),
				musicMuteBtn: document.getElementById('music-mute-btn'),
				quantumiSoundBtn: document.getElementById('quantumi-sound-btn'),
				skipIntroBtn: document.getElementById('skip-intro-btn'),
				playIntroBtn: document.getElementById('play-intro-btn'),
				introVideo: document.getElementById('intro-video'),
				loadingPrice: document.getElementById('loading-price'),
				loadingTopcoin: document.getElementById('loading-topcoin'),
				loadingInverse: document.getElementById('loading-inverse'),
				loadingTime: document.getElementById('loading-time'),
				loadingDate: document.getElementById('loading-date'),
				btcDate: document.getElementById('btc-date'),
				cameraPos: document.getElementById('camera-pos'),
				playlistPrice: document.getElementById('playlist-price'),
				playlistTime: document.getElementById('playlist-time'),
				playlistDate: document.getElementById('playlist-date'),
				trackAPrice: document.getElementById('track-a-price'),
				trackAInverse: document.getElementById('track-a-inverse'),
				trackATopcoin: document.getElementById('track-a-topcoin'),
				trackATime: document.getElementById('track-a-time'),
				trackBPrice: document.getElementById('track-b-price'),
				trackBInverse: document.getElementById('track-b-inverse'),
				trackBTopcoin: document.getElementById('track-b-topcoin'),
				trackBTime: document.getElementById('track-b-time'),
				trackAUrl: document.getElementById('track-a-url'),
				trackALoad: document.getElementById('track-a-load'),
				trackASetCue: document.getElementById('track-a-setcue'),
				trackACue: document.getElementById('track-a-cue'),
				trackBUrl: document.getElementById('track-b-url'),
				trackBLoad: document.getElementById('track-b-load'),
				trackBSetCue: document.getElementById('track-b-setcue'),
				trackBCue: document.getElementById('track-b-cue'),
				crossfader: document.getElementById('crossfader'),
				autoBlendBtn: document.getElementById('auto-blend'),
				djDockBtn: document.getElementById('dj-dock-btn'),
				recordMixBtn: document.getElementById('record-mix'),
				downloadMixBtn: document.getElementById('download-mix'),
				surroundToggleBtn: document.getElementById('surround-toggle'),
				hashLogToggleBtn: document.getElementById('hash-log-toggle'),
				legendToggleBtn: document.getElementById('legend-toggle'),
				djPlayBtn: document.getElementById('dj-play'),
				djStopBtn: document.getElementById('dj-stop'),
				djShuffleBtn: document.getElementById('dj-shuffle'),
				vinylA: document.getElementById('vinyl-a'),
				vinylB: document.getElementById('vinyl-b'),
				delayKnob: document.getElementById('delay-knob'),
				reverbKnob: document.getElementById('reverb-knob'),
				decimateKnob: document.getElementById('decimate-knob'),
				lofiKnob: document.getElementById('lofi-knob'),
				repeatKnob: document.getElementById('repeat-knob'),
				audioCanvas: document.getElementById('btc-audio-canvas'),
				btcThemeSelect: document.getElementById('btc-theme-select'),
				trackAPlay: document.getElementById('track-a-play'),
				trackABack: document.getElementById('track-a-back'),
				trackAForward: document.getElementById('track-a-forward'),
				trackAPause: document.getElementById('track-a-pause'),
				trackAStop: document.getElementById('track-a-stop'),
                                trackAMute: document.getElementById('track-a-mute'),
                                trackAVolume: document.getElementById('track-a-volume'),
                                trackAError: document.getElementById('track-a-error'),
                                trackBPlay: document.getElementById('track-b-play'),
				trackBBack: document.getElementById('track-b-back'),
				trackBForward: document.getElementById('track-b-forward'),
				trackBPause: document.getElementById('track-b-pause'),
                                trackBStop: document.getElementById('track-b-stop'),
                                trackBMute: document.getElementById('track-b-mute'),
                                trackBVolume: document.getElementById('track-b-volume'),
                                trackBError: document.getElementById('track-b-error'),
                                djPlaylist: document.getElementById('dj-playlist'),
				djOverlay: document.getElementById('dj-activation-overlay'),
				djLogoBtn: document.querySelector('#dj-activation-overlay .logo'),
				djDashboard: document.getElementById('dj-dashboard'),
				djDeactivateBtn: document.getElementById('dj-deactivate-btn'),
				btcOverlayPrice: document.getElementById('btc-overlay-price'),
                                btcOverlayLoss: document.getElementById('btc-overlay-loss'),
                                btcOverlayHashrate: document.getElementById('btc-overlay-hashrate'),
                                btcOverlayDifficulty: document.getElementById('btc-overlay-difficulty'),
                                btcOverlayMode: document.getElementById('btc-overlay-mode'),
                                nftModal: document.getElementById('nft-modal'),
                                nftModalCloseBtn: document.getElementById('nft-modal-close'),
                                nftModalFrame: document.getElementById('nft-modal-frame'),
                                raribleDockBtn: document.getElementById('rarible-dock-btn'),
                                raribleModal: document.getElementById('rarible-modal'),
                               raribleModalCloseBtn: document.getElementById('rarible-modal-close'),
                               raribleContainer: document.getElementById('rarible-container'),
                               raribleLoader: document.getElementById('loader-rarible')
                       };

                       let raribleOriginalParent = null;

			let draggedModule = null;
			let isIndicatorEnabledHeader = false;
			let isIndicatorEnabledModal = false;
			const chartCache = {};
			let scene,
				camera,
				renderer,
				controls,
				dotClouds = [],
				colorLegend = [],
				hashLog = [];
                        let bgMusicPlayer;
                        let trackAPlayer;
                        let trackBPlayer;
			let djCtx,
				gainA,
				gainB,
				recorder,
				dest,
				analyser,
				srcA,
				srcB,
				autoBlendInterval;
			let delayNodeA,
				delayNodeB,
				reverbNodeA,
				reverbNodeB,
				filterNodeA,
				filterNodeB,
				bitcrusherNodeA,
				bitcrusherNodeB;
			let chunks = [];
			const fxMatrix = { A: [], B: [] };
			let volumeBarsEnabled = false;
			let btcVolumeBar;
			let isQuantumSound = false;
			let audioCtx,
				audioSource,
				delayNode,
				convolverNode,
				filterNode,
				bitcrusherNode,
				gainNode;
                        const themes = {
                                original: ['#00FF7E', '#00cc5b', '#009944', '#e0f7fa'],
                                heatmap: ['#66ff66', '#ffff00', '#ff0000'],
                                lifecycle: ['#003a1c', '#00cc5b', '#00FF7E']
                        };
                        let currentTheme = 'heatmap';
			let siteColors = themes.original;
			let currentEthPrice = 0;
                        let isUsingMockLogs = false;
			let gasHistory = [];
			let tokensData = [];
			let balancesData = [];
			let tokenInsightsData = [];
			let isBTCPriceMock = false;
			let cachedTopCoin = null;
			let cachedInverseCoin = null;

                        const PLAYLIST_A = 'PLjyTw1v0Tp27WoFeOITARFdNy_bEyFQu2';
                        const PLAYLIST_B = 'PLjyTw1v0Tp242zNBCT6whi48bEK3gP3Yj';
			let DJ_TRACKS = [
				{ id: 'RkQ3m_uGwXE', title: 'Intro' },
				{ id: 'zHLmyJvSkaA', title: 'BORN FREE' }
			];

			async function loadDJPlaylist() {
				try {
					const res = await fetch(
						`https://www.youtube.com/feeds/videos.xml?playlist_id=${PLAYLIST_A}`
					);
					const text = await res.text();
					const doc = new DOMParser().parseFromString(text, 'application/xml');
					const entries = Array.from(doc.querySelectorAll('entry'));
					if (entries.length) {
						DJ_TRACKS = entries.map((e) => ({
							id: e.querySelector('yt\\:videoId')?.textContent || '',
							title: e.querySelector('title')?.textContent || ''
						}));
					}
				} catch (err) {
					console.error('Playlist fetch failed', err);
				}
				renderDJPlaylist();
			}
			function renderDJPlaylist() {
				if (!DOM.djPlaylist) return;
				DOM.djPlaylist.innerHTML = DJ_TRACKS.map(
					(t) => `
        <div class="playlist-item">
          <img src="https://img.youtube.com/vi/${t.id}/default.jpg" alt="${t.title}"/>
          <span>${t.title}</span>
        </div>`
				).join('');
			}

                        function initIntroVideo() {
                                const introVideo = DOM.introVideo;
                                if (!introVideo) return;
                                introVideo.volume = 0.5;
                                introVideo.muted = true;
                                if (!introPlayed) {
                                        const playPromise = introVideo.play();
                                        if (playPromise !== undefined) {
                                                playPromise.catch(() => {
                                                        console.warn('Autoplay blocked, retrying on user interaction');
                                                        document.addEventListener('click', () => introVideo.play(), {
                                                                once: true
                                                        });
                                                });
                                        }
                                } else {
                                        hideLoadingScreen();
                                        return;
                                }
                                introVideo.addEventListener('play', () => {
                                        introPlayed = true;
                                        localStorage.setItem('introPlayed', '1');
                                });
                                introVideo.addEventListener('ended', () => {
                                        introPlayed = true;
                                        localStorage.setItem('introPlayed', '1');
                                        hideLoadingScreen();
                                });
				introVideo.addEventListener('error', () =>
					console.warn('Intro trailer failed to load')
				);
			}

			function onYouTubeIframeAPIReady() {
				bgMusicPlayer = new YT.Player('music-player', {
					host: 'https://www.youtube.com',
					videoId: 'RkQ3m_uGwXE',
                                        playerVars: {
                                                listType: 'playlist',
                                                list: PLAYLIST_A,
                                                autoplay: 1,
                                                mute: 1,
                                                loop: 1,
                                                controls: 0,
                                                rel: 0,
                                                modestbranding: 1,
                                                origin: location.origin,
                                                enablejsapi: 1
                                        },
                                        events: {
                                                onReady: (e) => {
                                                        e.target.setVolume(100);
                                                        e.target.mute();
                                                        e.target.playVideo();
                                                        const frame = e.target.getIframe();
                                                        frame.setAttribute('loading', 'lazy');
                                                        frame.setAttribute('crossorigin', 'anonymous');
                                                },
                                                onError: (err) => {
                                                        console.error('Failed to load YouTube video', err);
                                                }
                                        }
                                });

				trackAPlayer = new YT.Player('track-a-player', {
					host: 'https://www.youtube.com',
					height: '100%',
					width: '100%',
                                        playerVars: {
                                                listType: 'playlist',
                                                list: PLAYLIST_A,
                                                autoplay: 0,
                                                mute: 1,
                                                origin: location.origin,
                                                enablejsapi: 1
                                        },
                                        events: {
                                                onReady: (ev) => {
                                                        if (DOM.trackAError) DOM.trackAError.style.display = 'none';
                                                        attachTrack(ev.target, 'A');
                                                        if (bgMusicPlayer)
                                                                bgMusicPlayer.loadPlaylist({ list: PLAYLIST_A });
                                                        const frameA = ev.target.getIframe();
                                                        frameA.setAttribute('loading', 'lazy');
                                                        frameA.setAttribute('crossorigin', 'anonymous');
                                                        if (DOM.trackAMute) DOM.trackAMute.textContent = 'Unmute';
                                                },
                                                onStateChange: (ev) => {
                                                        if (ev.data === YT.PlayerState.PLAYING)
                                                                attachTrack(ev.target, 'A');
                                                        updateVinyl('A');
                                                },
                                                onError: () => {
                                                        if (DOM.trackAError) DOM.trackAError.style.display = 'block';
                                                        console.error('Failed to load YouTube video');
                                                }
                                        }
                                });

                               trackBPlayer = new YT.Player('track-b-player', {
					host: 'https://www.youtube.com',
					height: '100%',
					width: '100%',
                                        playerVars: {
                                                listType: 'playlist',
                                                list: PLAYLIST_B,
                                                autoplay: 0,
                                                mute: 1,
                                                origin: location.origin,
                                                enablejsapi: 1
                                        },
                                        events: {
                                                onReady: (ev) => {
                                                        if (DOM.trackBError) DOM.trackBError.style.display = 'none';
                                                        attachTrack(ev.target, 'B');
                                                        if (bgMusicPlayer)
                                                                bgMusicPlayer.loadPlaylist({ list: PLAYLIST_B });
                                                        const frameB = ev.target.getIframe();
                                                        frameB.setAttribute('loading', 'lazy');
                                                        frameB.setAttribute('crossorigin', 'anonymous');
                                                        if (DOM.trackBMute) DOM.trackBMute.textContent = 'Unmute';
                                                },
                                                onStateChange: (ev) => {
                                                        if (ev.data === YT.PlayerState.PLAYING)
                                                                attachTrack(ev.target, 'B');
                                                        updateVinyl('B');
                                                },
                                                onError: () => {
                                                        if (DOM.trackBError) DOM.trackBError.style.display = 'block';
                                                        console.error('Failed to load YouTube video');
                                                }
                                        }
                               });
                               loadDJPlaylist();

				enableQuantumSound();

				function createImpulse(duration = 5, decay = 4) {
					if (!djCtx) return null;
					const rate = djCtx.sampleRate;
					const length = rate * duration;
					const impulse = djCtx.createBuffer(2, length, rate);
					for (let c = 0; c < 2; c++) {
						const channel = impulse.getChannelData(c);
						for (let i = 0; i < length; i++) {
							channel[i] =
								(Math.random() * 2 - 1) * Math.pow(1 - i / length, decay);
						}
					}
					return impulse;
				}

				function createBitcrusherCurve(bits = 4) {
					const samples = 1 << bits;
					const curve = new Float32Array(samples);
					for (let i = 0; i < samples; i++) {
						curve[i] = (i / (samples - 1)) * 2 - 1;
					}
					return curve;
				}

				function createFxNode(type) {
					switch (type) {
						case 'delay':
							const delay = djCtx.createDelay(5);
							delay.delayTime.value = 0.7;
							return delay;
						case 'reverb':
							const convolver = djCtx.createConvolver();
							convolver.buffer = createImpulse(6, 3);
							return convolver;
						case 'filter':
							const filter = djCtx.createBiquadFilter();
							filter.type = 'lowpass';
							filter.frequency.value = 800;
							return filter;
						case 'bitcrusher':
							const crusher = djCtx.createWaveShaper();
							crusher.curve = createBitcrusherCurve(4);
							return crusher;
						default:
							return null;
					}
				}

				function attachTrack(player, which) {
					if (!djCtx) {
						djCtx = new (window.AudioContext || window.webkitAudioContext)();
						djCtx.resume();
						gainA = djCtx.createGain();
						gainB = djCtx.createGain();
						dest = djCtx.createMediaStreamDestination();
						analyser = djCtx.createAnalyser();
						analyser.fftSize = 2048;
						gainA.connect(analyser);
						gainB.connect(analyser);
						gainA.connect(dest);
						gainB.connect(dest);
						analyser.connect(djCtx.destination);
						drawBtcAudio();
					}
					const iframe = player.getIframe();
					const stream = iframe?.captureStream ? iframe.captureStream() : null;
					if (!stream) {
						console.error(`Failed to capture stream for Track ${which}`);
						return;
					}
					const src = djCtx.createMediaStreamSource(stream);
					const fxChain = [];
					['delay', 'reverb', 'filter', 'bitcrusher'].forEach((fx) => {
						const node = createFxNode(fx);
						if (node) fxChain.push(node);
					});
					if (which === 'A') {
						srcA = src;
						fxMatrix.A = fxChain;
						[delayNodeA, reverbNodeA, filterNodeA, bitcrusherNodeA] = fxChain;
						src.connect(fxChain[0]);
						fxChain.reduce((prev, curr) => prev.connect(curr), src);
						fxChain[fxChain.length - 1].connect(gainA);
					} else {
						srcB = src;
						fxMatrix.B = fxChain;
						[delayNodeB, reverbNodeB, filterNodeB, bitcrusherNodeB] = fxChain;
						src.connect(fxChain[0]);
						fxChain.reduce((prev, curr) => prev.connect(curr), src);
						fxChain[fxChain.length - 1].connect(gainB);
					}
					DOM.crossfader?.dispatchEvent(new Event('input'));
					if (!recorder) {
						recorder = new MediaRecorder(dest.stream, {
							mimeType: 'audio/webm'
						});
						recorder.ondataavailable = (e) => chunks.push(e.data);
						recorder.onstop = () => {
							const blob = new Blob(chunks, { type: 'audio/webm' });
							DOM.downloadMixBtn.href = URL.createObjectURL(blob);
							DOM.downloadMixBtn.download = 'dj-mix.webm';
							DOM.downloadMixBtn.style.display = 'inline';
							chunks = [];
						};
					}
				}

				function createDistortionCurve(amount = 50) {
					const k = typeof amount === 'number' ? amount : 50;
					const n = 44100;
					const curve = new Float32Array(n);
					const deg = Math.PI / 180;
					for (let i = 0; i < n; ++i) {
						const x = (i * 2) / n - 1;
						curve[i] = ((3 + k) * x * 20 * deg) / (Math.PI + k * Math.abs(x));
					}
					return curve;
				}

				window.enableQuantumSound = function () {
					if (!bgMusicPlayer || !bgMusicPlayer.getIframe) return;
					if (audioCtx) return;
					const players = [bgMusicPlayer];
					if (DOM.introVideo && DOM.introVideo.captureStream)
						players.push(DOM.introVideo);
					const valid = players.filter((p) =>
						p.getIframe ? p.getIframe().captureStream : p.captureStream
					);
					if (!valid.length) return;
					if (!players.length) return;
					audioCtx = new (window.AudioContext || window.webkitAudioContext)();
					let stream = null;
					try {
						stream = bgMusicPlayer.getIframe().captureStream();
					} catch {}
					if (!stream && DOM.introVideo && DOM.introVideo.captureStream) {
						try {
							stream = DOM.introVideo.captureStream();
						} catch {}
					}
					if (!stream) return;
					audioSource = audioCtx.createMediaStreamSource(stream);
					filterNode = audioCtx.createBiquadFilter();
					filterNode.type = 'lowpass';
					filterNode.frequency.value = 1200;
					delayNode = audioCtx.createDelay();
					delayNode.delayTime.value = 0.35;
					convolverNode = audioCtx.createConvolver();
					convolverNode.buffer = createImpulse();
					bitcrusherNode = audioCtx.createWaveShaper();
					bitcrusherNode.curve = new Float32Array([-1, -0.5, 0, 0.5, 1]);
					bitcrusherNode.oversample = '4x';
					gainNode = audioCtx.createGain();
					gainNode.gain.value = 1.2;
					audioSource.connect(filterNode);
					filterNode.connect(delayNode);
					delayNode.connect(convolverNode);
					convolverNode.connect(bitcrusherNode);
					bitcrusherNode.connect(gainNode);
					gainNode.connect(audioCtx.destination);
					if (bgMusicPlayer) bgMusicPlayer.setPlaybackRate(1.25);
				};

				window.disableQuantumSound = function () {
					if (audioCtx) {
						audioCtx.close();
						audioCtx = null;
					}
					if (bgMusicPlayer) bgMusicPlayer.setPlaybackRate(1.0);
				};

				window.routeYTSignal = function () {
					if (!DOM.introVideo) return;
					if (!isQuantumSound) enableQuantumSound();
				};
			}

			if (window.YT && window.YT.Player) {
				onYouTubeIframeAPIReady();
			} else {
				window.onYouTubeIframeAPIReady = onYouTubeIframeAPIReady;
			}

                        const API_KEY = 'RVPGIBU418J84F5SMP52JKIRXWD2JE3YGZ';
                        const DUNE_API_KEY = 'sim_2TQdIjedEDThCDA7rd6EXofbaYQzBLGs';
                        const X_BEARER_TOKEN = 'UyUFBJrmBNqcJfaoW9pWZzhmG';
                        const X_ACCESS_TOKEN =
                                '1936237883842576384-eikvHEUXy2YxGwryeLcEfhEUjTGLIO';
                        const X_ACCESS_SECRET = 'ajjdpdkdaM821iTcHx06bMJh2fAl7NoEBDBTM1UOdxSlv';
			const DUNE_MODULE_VERSION = '1.1.0.11';
			const CHAINS = [1, 42161, 8453, 10, 534352, 81457]; // Mainnet, Arbitrum, Base, Optimism, Scroll, Blast
			const TOKEN_ADDRESS = '0xd9aaec86b65d86f6a7b5b1b0c42ffa531710b6ca';
			const CHAIN_ID = 8453;

			const mockLogs = [
				{
					id: 1,
					message: 'Trade executed: BTC/USDT at $60,000',
					timestamp: new Date(Date.now() - 60000).toLocaleTimeString(),
					type: 'trade'
				},
				{
					id: 2,
					message: 'Price alert: ETH crossed $4,000',
					timestamp: new Date(Date.now() - 120000).toLocaleTimeString(),
					type: 'alert'
				},
				{
					id: 3,
					message: 'System: API connection stable',
					timestamp: new Date(Date.now() - 180000).toLocaleTimeString(),
					type: 'system'
				}
			];

			const mockTokens = [
				{
					id: 'bitcoin',
					name: 'Bitcoin',
					symbol: 'BTC',
					current_price: 60000,
					total_volume: 4500000,
					price_change_percentage_24h: 5.2,
					market_cap: 1500000000,
					circulating_supply: 19000000,
					source: 'Mock',
					high_24h: 61000,
					low_24h: 59000,
					market_cap_rank: 1
				},
				{
					id: 'ethereum',
					name: 'Ethereum',
					symbol: 'ETH',
					current_price: 4000,
					total_volume: 3000000,
					price_change_percentage_24h: -2.1,
					market_cap: 7500000000,
					circulating_supply: 120000000,
					source: 'Mock',
					high_24h: 4100,
					low_24h: 3900,
					market_cap_rank: 2,
					gasPrice: 15
				},
				{
					id: 'constitutiondao',
					name: 'ConstitutionDAO',
					symbol: 'PEOPLE',
					current_price: 0.01962,
					total_volume: 135674.745,
					price_change_percentage_24h: 41.1,
					market_cap: 99400658.805,
					circulating_supply: 5066406500,
					source: 'Mock',
					high_24h: 0.02,
					low_24h: 0.018,
					market_cap_rank: 150
				}
			];

			const mockBalances = [
				{ token: 'USDC', balance: 1000, chainId: 8453 },
				{ token: 'ETH', balance: 2.5, chainId: 8453 },
				{ token: 'DAI', balance: 500, chainId: 8453 }
			];

			const mockTokenInsights = [
				{ symbol: 'USDC', name: 'USD Coin', decimals: 6, chainId: 8453 },
				{ symbol: 'ETH', name: 'Ethereum', decimals: 18, chainId: 8453 },
				{ symbol: 'DAI', name: 'Dai Stablecoin', decimals: 18, chainId: 8453 }
			];

			const quantumPuns = [
				'Entangled in profits!',
				'Quantum leaps in trading!',
				'Superposition your trades!',
				'Uncertainty in the market, certainty in gains!',
				'Wave function collapse to profits!',
				'Quantum tunneling through resistance!',
				'Spooky action at a distance: instant trades!',
				"Heisenberg's uncertainty: but your profits are certain!",
				'Quantum computing your next move!',
				'Entanglement: your portfolio and success!',
				'Quantum supremacy in trading!',
				'Decoherence? Not in my portfolio!',
				'Quantum bits, quantum profits!',
				'Riding the quantum wave to success!'
			];

                        function hideLoadingScreen() {
                                if (DOM.introVideo) DOM.introVideo.pause();
                                DOM.loadingScreen.classList.add('fade-out');
				setTimeout(() => {
					DOM.loadingScreen.style.display = 'none';
					document.querySelector('header').style.opacity = '1';
					shrinkHeader();
					setTimeout(
						() => (document.querySelector('main').style.opacity = '1'),
						300
					);
					setTimeout(
						() => (document.querySelector('footer').style.opacity = '1'),
						500
					);
					document
						.querySelectorAll('#module-grid section')
						.forEach((section, index) => {
							setTimeout(
								() => (section.style.opacity = '1'),
								700 + index * 200
							);
						});
				}, 500);
			}

			window.onload = function () {
				setTimeout(hideLoadingScreen, 23000);
			};

			function shrinkHeader() {
				const header = document.querySelector('header');
				if (header) header.classList.add('shrink');
				if (DOM.navMenuToggle) DOM.navMenuToggle.classList.remove('hidden');
			}

			window.addEventListener('scroll', () => {
				if (window.scrollY > 50) shrinkHeader();
			});

                        let introPlayed = localStorage.getItem('introPlayed') === '1';
                        function resumePlayers() {
                                try {
                                        if (DOM.introVideo && !introPlayed) {
                                                DOM.introVideo.muted = false;
                                                DOM.introVideo.play().catch(() => {});
                                                introPlayed = true;
                                                localStorage.setItem('introPlayed', '1');
                                        }
					if (bgMusicPlayer && bgMusicPlayer.playVideo)
						bgMusicPlayer.playVideo();
					routeYTSignal();
					if (DOM.djOverlay) {
						DOM.djOverlay.classList.add('fade-out');
						setTimeout(() => (DOM.djOverlay.style.display = 'none'), 500);
					}
					if (DOM.djDashboard) DOM.djDashboard.classList.remove('locked');
					document.removeEventListener('click', resumePlayers);
				} catch {}
			}

			function setupDjOverlay() {
				if (!DOM.djOverlay || !DOM.djLogoBtn) return;
				let clickCount = 0;
				let lastTouchY = 0;
				const handler = debounce(() => {
					clickCount++;
					if (clickCount >= 2) {
						DOM.djOverlay.classList.add('fade-out');
						setTimeout(() => {
							DOM.djOverlay.style.display = 'none';
							if (DOM.djDashboard) DOM.djDashboard.classList.remove('locked');
							resumePlayers();
							clickCount = 0;
						}, 500);
					} else {
						DOM.djLogoBtn.classList.add('pulse');
						setTimeout(() => DOM.djLogoBtn.classList.remove('pulse'), 1000);
					}
				}, 100);
				DOM.djLogoBtn.addEventListener('click', handler);
				DOM.djLogoBtn.addEventListener('touchstart', (e) => {
					const touchY = e.touches[0].clientY;
					if (Math.abs(touchY - lastTouchY) > 10) return;
					lastTouchY = touchY;
					handler();
					e.preventDefault();
				});
				DOM.djLogoBtn.addEventListener('keydown', (e) => {
					if (e.key === 'Enter' || e.key === 'Space') {
						handler();
						e.preventDefault();
					}
				});
				DOM.djOverlay.addEventListener('touchmove', (e) => e.stopPropagation());
                                ['click','touchstart'].forEach(ev => DOM.djDeactivateBtn.addEventListener(ev, () => {
                                        clickCount = 0;
                                        DOM.djOverlay.style.display = 'flex';
                                        DOM.djOverlay.classList.remove('fade-out');
                                        DOM.djDashboard.classList.add('locked');
                                        trackAPlayer?.pauseVideo();
                                        trackBPlayer?.pauseVideo();
                                        bgMusicPlayer?.pauseVideo();
                                        document.querySelectorAll('video').forEach((v) => v.pause());
                                }));
				setTimeout(handler, 5000);
			}

			if (DOM.djOverlay) {
				setupDjOverlay();
			}

			function updateVinyl(which) {
				const el = which === 'A' ? DOM.vinylA : DOM.vinylB;
				const player = which === 'A' ? trackAPlayer : trackBPlayer;
				if (!el || !player || !player.getPlayerState) return;
				const state = player.getPlayerState();
				const logo = el.parentElement?.querySelector('.metrics-overlay .logo');
				if (state === YT.PlayerState.PLAYING) {
					el.classList.add('spinning', 'cd-playing');
					el.classList.remove('paused');
					logo?.classList.add('pulse');
				} else {
					el.classList.remove('spinning', 'cd-playing');
					el.classList.add('paused');
					logo?.classList.remove('pulse');
				}
			}

			function scratch(player) {
				if (!player || !player.pauseVideo) return;
				const pos = player.getCurrentTime();
				player.pauseVideo();
				setTimeout(() => {
					player.seekTo(pos, true);
					player.playVideo();
				}, 120);
			}

			for (let i = 0; i < 10; i++) {
				const particle = document.createElement('div');
				particle.className = 'star';
				particle.style.left = `${Math.random() * 100}%`;
				particle.style.top = `${Math.random() * 100}%`;
				particle.style.animationDelay = `${Math.random() * 15}s`;
				DOM.particleContainer.appendChild(particle);
			}

			for (let i = 0; i < 10; i++) {
				const snowflake = document.createElement('div');
				snowflake.className = 'snowflake';
				snowflake.textContent = '';
				snowflake.style.left = `${Math.random() * 100}%`;
				snowflake.style.top = `${-10 + Math.random() * 10}vh`;
				snowflake.style.animationDelay = `${Math.random() * 5}s`;
				snowflake.style.animationDuration = `${10 + Math.random() * 5}s`;
				snowflake.style.setProperty('--drift', `${-20 + Math.random() * 40}px`);
				document.body.appendChild(snowflake);
			}

			function setupDragAndDrop() {
				const modules = document.querySelectorAll('#module-grid section');
				const isMobile = window.innerWidth < 640;

				modules.forEach((module) => {
					if (!isMobile) {
						module.setAttribute('draggable', 'true');
						module.addEventListener('dragstart', (e) => {
							draggedModule = module;
							module.classList.add('dragging');
							e.dataTransfer.setData('text/plain', '');
						});
						module.addEventListener('dragend', () => {
							module.classList.remove('dragging');
							draggedModule = null;
						});
						module.addEventListener('dragover', (e) => e.preventDefault());
						module.addEventListener('dragenter', (e) => {
							e.preventDefault();
							module.classList.add('drop-target');
						});
						module.addEventListener('dragleave', () =>
							module.classList.remove('drop-target')
						);
						module.addEventListener('drop', (e) => {
							e.preventDefault();
							module.classList.remove('drop-target');
							if (draggedModule && draggedModule !== module) {
								const allModules = Array.from(DOM.moduleGrid.children);
								const draggedIndex = allModules.indexOf(draggedModule);
								const targetIndex = allModules.indexOf(module);
								if (draggedIndex < targetIndex) {
									DOM.moduleGrid.insertBefore(
										draggedModule,
										module.nextSibling
									);
								} else {
									DOM.moduleGrid.insertBefore(draggedModule, module);
								}
								saveModuleOrder();
								window.dispatchEvent(new Event('resize'));
							}
						});
						module.addEventListener('touchstart', (e) => {
							draggedModule = module;
							module.classList.add('dragging');
						});
						module.addEventListener('touchmove', (e) => {
							e.preventDefault();
							const touch = e.touches[0];
							const dropTarget = document
								.elementFromPoint(touch.clientX, touch.clientY)
								?.closest('#module-grid section');
							if (dropTarget && dropTarget !== draggedModule) {
								dropTarget.classList.add('drop-target');
							}
						});
						module.addEventListener('touchend', (e) => {
							module.classList.remove('dragging');
							const touch = e.changedTouches[0];
							const target = document.elementFromPoint(
								touch.clientX,
								touch.clientY
							);
							const dropTarget = target?.closest('#module-grid section');
							if (dropTarget && dropTarget !== draggedModule) {
								const allModules = Array.from(DOM.moduleGrid.children);
								const draggedIndex = allModules.indexOf(draggedModule);
								const targetIndex = allModules.indexOf(dropTarget);
								if (draggedIndex < targetIndex) {
									DOM.moduleGrid.insertBefore(
										draggedModule,
										dropTarget.nextSibling
									);
								} else {
									DOM.moduleGrid.insertBefore(draggedModule, dropTarget);
								}
								saveModuleOrder();
								window.dispatchEvent(new Event('resize'));
							}
							draggedModule = null;
							modules.forEach((m) => m.classList.remove('drop-target'));
						});
					}
				});
			}

			function saveModuleOrder() {
				const order = Array.from(DOM.moduleGrid.children).map(
					(module) => module.id
				);
				localStorage.setItem('moduleOrder', JSON.stringify(order));
			}

			function loadModuleOrder() {
				const order = JSON.parse(localStorage.getItem('moduleOrder'));
				if (order) {
					order.forEach((id) => {
						const module = document.getElementById(id);
						if (module) DOM.moduleGrid.appendChild(module);
					});
				}
			}

function setupModuleToggles() {
				document.querySelectorAll('.toggle-module-btn').forEach((btn) => {
					btn.addEventListener('click', () => {
						const moduleContent = btn
							.closest('.chat-logs-container, section')
							.querySelector('.module-content');
						const isHidden = moduleContent.classList.toggle('hidden');
						btn.textContent = isHidden ? '' : '';
						btn.setAttribute(
							'data-tooltip',
							isHidden ? 'Show module content' : 'Hide module content'
						);
						btn.setAttribute(
							'aria-label',
							isHidden ? 'Show module content' : 'Hide module content'
						);
                                       });
                               });
                       }

                        function setupPlaylistDescriptions() {
                                document.querySelectorAll('.toggle-desc-btn').forEach((btn) => {
                                        btn.addEventListener('click', () => {
                                                const desc = btn.closest('.extra-playlist').querySelector('.playlist-desc');
                                                if (!desc) return;
                                                const hidden = desc.classList.toggle('hidden');
                                                btn.textContent = hidden ? 'Info' : 'Hide';
                                        });
                                });
                        }

			function initializeChart(
				containerId,
				symbol,
				interval = 'D',
				retries = 3
			) {
				const cacheKey = `${containerId}-${symbol}-${interval}`;
				if (chartCache[cacheKey]) return chartCache[cacheKey];

				const container = document.getElementById(containerId);
				const chartTitle = document.getElementById(
					containerId === 'chart-container-header'
						? 'chart-title-header'
						: 'chart-title-modal'
				);
				if (!container || !chartTitle)
					return console.error(
						`Container or chart title not found for ${containerId}`
					);

				while (container.firstChild)
					container.removeChild(container.firstChild);

				const loadingDiv = document.createElement('div');
				loadingDiv.className = 'chart-loading';
				loadingDiv.innerHTML = `<div class="loader"></div><div class="ml-2">Loading ${symbol.replace('BINANCE:', '')} chart...</div>`;
				container.appendChild(loadingDiv);

				const isHeader = containerId === 'chart-container-header';
				const isIndicatorEnabled = isHeader
					? isIndicatorEnabledHeader
					: isIndicatorEnabledModal;

                                const initWidget = () => {
                                        const style = getComputedStyle(document.documentElement);
                                        const upColor = style.getPropertyValue('--primary-color').trim() || '#00FF7E';
                                        const downColor = '#ff0000';
                                        try {
                                                const widget = new TradingView.widget({
							autosize: true,
							symbol: symbol,
							interval: interval,
							timezone: 'Etc/UTC',
							theme: 'dark',
							style: '1',
							locale: 'en',
							toolbar_bg: 'rgba(35, 46, 46, 0.2)',
							enable_publishing: false,
							hide_top_toolbar: false,
							hide_side_toolbar: false,
							allow_symbol_change: true,
							container_id: containerId,
							overrides: {
								'paneProperties.background': 'rgba(35, 46, 46, 0.2)',
                                                                'paneProperties.vertGridProperties.color': 'var(--secondary-color)',
                                                                'paneProperties.horzGridProperties.color': 'var(--secondary-color)',
                                                                'scalesProperties.textColor': 'var(--secondary-color)',
                                                                'scalesProperties.lineColor': 'var(--secondary-color)',
                                                                'mainSeriesProperties.candleStyle.upColor': upColor,
                                                                'mainSeriesProperties.candleStyle.downColor': downColor,
                                                                'mainSeriesProperties.candleStyle.borderUpColor': upColor,
                                                                'mainSeriesProperties.candleStyle.borderDownColor': downColor,
                                                                'mainSeriesProperties.candleStyle.wickUpColor': upColor,
                                                                'mainSeriesProperties.candleStyle.wickDownColor': downColor
							},
							onChartReady: () => {
								console.log(
									`Chart loaded for ${containerId} with symbol ${symbol}`
								);
								if (isIndicatorEnabled)
									alert(
										'Please manually add the "QuantumI Indicator":\n1. Click Indicators (f(x)).\n2. Search "QuantumI Indicator".\n3. Apply.'
									);
								chartCache[cacheKey] = widget;
								container.removeChild(loadingDiv);
							},
							onError: (error) => {
								console.error(`Chart error for ${containerId}:`, error);
								if (retries > 0)
									setTimeout(
										() =>
											initializeChart(
												containerId,
												symbol,
												interval,
												retries - 1
											),
										500
									);
								else
									loadingDiv.textContent = `Failed to load ${symbol.replace('BINANCE:', '')} chart after 3 attempts. Please try again later.`;
							}
						});
					} catch (error) {
						console.error(
							`Critical error initializing chart for ${containerId}:`,
							error
						);
						if (retries > 0)
							setTimeout(
								() =>
									initializeChart(containerId, symbol, interval, retries - 1),
								500
							);
						else
							loadingDiv.textContent = `Critical failure loading ${symbol.replace('BINANCE:', '')} chart after 3 attempts.`;
					}
				};
				setTimeout(initWidget, 300);
			}

			async function fetchWithRetry(
				url,
				options = {},
				retries = 3,
				delay = 1000
			) {
				for (let i = 0; i <= retries; i++) {
					try {
						const response = await fetch(url, {
							method: 'GET',
							mode: 'cors',
							credentials: 'omit',
							headers: { Accept: 'application/json', ...options.headers },
							...options
						});
						if (!response.ok)
							throw new Error(
								`HTTP error! Status: ${response.status}, Text: ${response.statusText}`
							);
						return await response.json();
					} catch (error) {
						if (i === retries) throw error;
						const backoff = delay * Math.pow(2, i);
						console.warn(
							`Fetch attempt ${i + 1} failed for ${url}. Retrying in ${backoff}ms: ${error.message}`
						);
						await new Promise((resolve) => setTimeout(resolve, backoff));
					}
				}
			}

			async function fetchTextWithRetry(
				url,
				options = {},
				retries = 3,
				delay = 1000
			) {
				for (let i = 0; i <= retries; i++) {
					try {
						const response = await fetch(url, {
							method: 'GET',
							mode: 'cors',
							credentials: 'omit',
							headers: { Accept: 'text/plain', ...options.headers },
							...options
						});
						if (!response.ok)
							throw new Error(
								`HTTP error! Status: ${response.status}, Text: ${response.statusText}`
							);
						return await response.text();
					} catch (error) {
						if (i === retries) throw error;
						const backoff = delay * Math.pow(2, i);
						console.warn(
							`Fetch attempt ${i + 1} failed for ${url}. Retrying in ${backoff}ms: ${error.message}`
						);
						await new Promise((resolve) => setTimeout(resolve, backoff));
					}
				}
			}

			async function fetchBTCPrice() {
				const url = 'https://api.coingecko.com/api/v3/coins/bitcoin';
				try {
					const data = await fetchWithRetry(url);
					const price = data.market_data.current_price.usd;
					const volume = data.market_data.total_volume.usd;
					document.getElementById('live-price-header').textContent =
						`> Live Price: $${price.toLocaleString()} (BTC)`;
					document.getElementById('live-price-modal').textContent =
						`> Live Price: $${price.toLocaleString()} (BTC)`;
					if (price > 61000)
						notifyUser(`BTC price spiked to $${price.toLocaleString()}!`);
					return { price, volume };
				} catch (error) {
					console.error('Failed to fetch BTC data from CoinGecko:', error);
					document.getElementById('live-price-header').textContent =
						`> Live Price: $60,000 (BTC, Mock)`;
					document.getElementById('live-price-modal').textContent =
						`> Live Price: $60,000 (BTC, Mock)`;
					return { price: 60000, volume: 4500000 };
				}
			}

			async function fetchBTCHistoricalData() {
				const url =
					'https://api.coingecko.com/api/v3/coins/bitcoin/market_chart?vs_currency=usd&days=1';
				try {
					const data = await fetchWithRetry(url);
					return data;
				} catch (error) {
					console.error('Failed to fetch BTC historical data:', error);
					return null;
				}
			}

                        async function fetchBTCHashRate() {
                                const url = 'https://api.blockchain.info/q/hashrate?cors=true';
                                try {
                                        const text = await fetchTextWithRetry(url);
                                        return parseFloat(text) / 1e9;
                                } catch (error) {
                                        console.warn('Failed to fetch BTC hash rate:', error);
                                        return 0;
                                }
                        }

                        async function fetchBTCDifficulty() {
                                const url = 'https://api.blockchain.info/q/getdifficulty?cors=true';
                                try {
                                        const text = await fetchTextWithRetry(url);
                                        return parseFloat(text);
                                } catch (error) {
                                        console.warn('Failed to fetch BTC difficulty:', error);
                                        return 0;
                                }
                        }

                        async function fetchTwitterData() {
                                const query = 'from:DIFF810489 OR retweets_of:DIFF810489';
                                const cacheKey = `tw_${query}`;
				const cached = localStorage.getItem(cacheKey);
				if (cached && Date.now() - JSON.parse(cached).timestamp < 1800000) {
					DOM.twitterWarning.style.display = 'block';
					return JSON.parse(cached).data;
				}
                                try {
                                const url = `https://corsproxy.io/https://api.x.com/2/users/by/username/DIFF810489/tweets?max_results=10&tweet.fields=created_at,author_id,text,attachments&expansions=attachments.media_keys,author_id&media.fields=url,preview_image_url,type`;
					const data = await fetchWithRetry(url, {
						headers: { Authorization: `Bearer ${X_BEARER_TOKEN}` }
					});
					if (!data.data) throw new Error('No tweets found');
                                        const result = data.data.map((tweet) => {
                                                const mediaKeys = tweet.attachments?.media_keys || [];
                                                const mediaItems = mediaKeys
                                                        .map((k) => data.includes.media.find((m) => m.media_key === k))
                                                        .filter(Boolean);
                                                const video = mediaItems.find((m) => m.type === 'video')?.url || null;
                                                const image =
                                                        mediaItems.find((m) => m.type === 'photo')?.url ||
                                                        mediaItems.find((m) => m.type === 'animated_gif')?.preview_image_url ||
                                                        null;
                                                return {
                                                        text: tweet.text,
                                                        author:
                                                                data.includes.users.find((u) => u.id === tweet.author_id)?.username ||
                                                                'Unknown',
                                                        created_at: tweet.created_at,
                                                        video,
                                                        image
                                                };
                                        });
					localStorage.setItem(
						cacheKey,
						JSON.stringify({ timestamp: Date.now(), data: result })
					);
					DOM.twitterWarning.style.display = 'none';
					return result;
				} catch (error) {
					console.error('Twitter API fetch failed:', error);
                                        DOM.twitterWarning.textContent =
                                                'Tweets unavailable, retrying...';
                                        DOM.twitterWarning.style.display = 'block';
                                        return [
                                                {
                                                        text: 'Bitcoin surges to $105,000 amid market rally',
                                                        author: 'CoinDesk',
                                                        created_at: new Date().toISOString(),
                                                        video: null,
                                                        image: null
                                                },
                                                {
                                                        text: 'Art auction features NFT collection for $2M',
                                                        author: 'ArtDaily',
                                                        created_at: new Date().toISOString(),
                                                        video: null,
                                                        image: null
                                                }
                                        ];
				}
			}

			async function fetchTopInverseToken() {
				if (cachedInverseCoin) return cachedInverseCoin;
				try {
					const url =
						'https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=price_change_percentage_24h.asc&per_page=1&page=1';
					const data = await fetchWithRetry(url);
					if (data && data[0]) {
						cachedInverseCoin = {
							symbol: data[0].symbol.toUpperCase(),
							change: data[0].price_change_percentage_24h
						};
					} else {
						cachedInverseCoin = { symbol: 'N/A', change: 0 };
					}
					return cachedInverseCoin;
				} catch (err) {
					console.error('Failed to fetch inverse token:', err);
					return { symbol: 'N/A', change: 0 };
				}
			}

			async function fetchTopCoin() {
				if (cachedTopCoin) return cachedTopCoin;
				try {
					const url =
						'https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=1&page=1';
					const data = await fetchWithRetry(url);
					cachedTopCoin =
						data && data[0] ? data[0].symbol.toUpperCase() : 'N/A';
					return cachedTopCoin;
				} catch (err) {
					console.error('Failed to fetch top coin:', err);
					return 'N/A';
				}
			}

			async function fetchChainBalance(
				chainId,
				address = '0xb5d85cbf7cb3ee0d56b3bb207d5fc4b82f43f511'
			) {
				const url = `https://api.etherscan.io/api?chainid=${chainId}&module=account&action=balance&address=${address}&tag=latest&apikey=${API_KEY}`;
				try {
					const data = await fetchWithRetry(url);
					if (!data.result) throw new Error('Invalid response from Etherscan');
					return { chainId, balance: parseInt(data.result) / 1e18 };
				} catch (error) {
					console.error(`Failed to fetch balance for chain ${chainId}:`, error);
					return { chainId, balance: 0 };
				}
			}

			async function fetchGasPrices(chainId = 1) {
				const url = `https://api.etherscan.io/api?chainid=${chainId}&module=gastracker&action=gasoracle&apikey=${API_KEY}`;
				try {
					const data = await fetchWithRetry(url);
					if (!data.result) throw new Error('Invalid response from Etherscan');
					const gasData = {
						chainId,
						safeGasPrice: parseInt(data.result.SafeGasPrice) || 10,
						proposeGasPrice: parseInt(data.result.ProposeGasPrice) || 15,
						fastGasPrice: parseInt(data.result.FastGasPrice) || 20,
						lastBlock: data.result.LastBlock || 'N/A',
						timestamp: Date.now()
					};
					if (gasData.fastGasPrice > 25)
						notifyUser(
							`Gas price on chain ${chainId} spiked to ${gasData.fastGasPrice} Gwei!`
						);
					return gasData;
				} catch (error) {
					console.error(
						`Failed to fetch gas prices for chain ${chainId}:`,
						error
					);
					return {
						chainId,
						safeGasPrice: 10,
						proposeGasPrice: 15,
						fastGasPrice: 20,
						lastBlock: 'N/A',
						timestamp: Date.now()
					};
				}
			}

			async function fetchTokenInfo(address, chainId) {
                                const url = `https://api.sim.dune.com/v1/evm/balances/${address}?chain_id=${chainId}&include=token`;
				const cacheKey = `dune_bal_${address}_${chainId}`;
				const cached = localStorage.getItem(cacheKey);
				if (cached && Date.now() - JSON.parse(cached).timestamp < 3600000) {
					DOM.tokenInsightsWarning.style.display = 'block';
					return JSON.parse(cached).data;
				}
				try {
					const data = await fetchWithRetry(url, {
						headers: { 'x-sim-api-key': DUNE_API_KEY }
					});
					if (!data || !data.balances)
						throw new Error('Invalid response from Dune API');
					const result = data.balances.map((b) => ({
						tx_hash: b.last_transaction_hash || '0x0',
						token: b.contract_ticker_symbol || b.token_symbol || 'ETH',
						value: b.balance,
						chain_id: chainId
					}));
					localStorage.setItem(
						cacheKey,
						JSON.stringify({ timestamp: Date.now(), data: result })
					);
					DOM.tokenInsightsWarning.style.display = 'none';
					return result;
				} catch (error) {
					console.error(
						`Failed to fetch token info for ${address} on chain ${chainId}:`,
						error
					);
					DOM.tokenInsightsWarning.style.display = 'block';
					return mockTokenInsights.map((t) => ({
						tx_hash: '0xmock',
						token: t.symbol,
						value: Math.random() * 100,
						chain_id: chainId
					}));
				}
			}

			function generateHashFromPrice(price) {
				const priceStr = price.toString();
				let hash = '';
				for (let i = 0; i < 64; i++) {
					hash += (priceStr.charCodeAt(i % priceStr.length) % 16).toString(16);
				}
				return hash;
			}

			function init3D() {
				scene = new THREE.Scene();
				camera = new THREE.PerspectiveCamera(
					75,
					window.innerWidth / window.innerHeight,
					0.1,
					1000
				);
				renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
				renderer.setClearColor(0x000000, 0);
				const container = document.getElementById('btc-hash-canvas');
				renderer.setSize(container.clientWidth, container.clientHeight);
				container.appendChild(renderer.domElement);
				camera.position.set(0, 0, 10);
				camera.lookAt(0, 0, 0);

				const ambientLight = new THREE.AmbientLight(0x404040);
				scene.add(ambientLight);
				const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
				directionalLight.position.set(5, 10, 7.5);
				scene.add(directionalLight);

				const axesHelper = new THREE.AxesHelper(10);
				scene.add(axesHelper);
				controls = new THREE.OrbitControls(camera, renderer.domElement);
				controls.enableDamping = true;
				controls.dampingFactor = 0.1;
				controls.enablePan = true;
				controls.panSpeed = 0.5;
				controls.autoRotate = true;
				controls.autoRotateSpeed = 2.0;

				let resizeTimeout;
				window.addEventListener('resize', () => {
					clearTimeout(resizeTimeout);
					resizeTimeout = setTimeout(() => {
						renderer.setSize(container.clientWidth, container.clientHeight);
						camera.aspect = container.clientWidth / container.clientHeight;
						camera.updateProjectionMatrix();
						renderer.render(scene, camera);
					}, 100);
				});

				const raycaster = new THREE.Raycaster();
				const mouse = new THREE.Vector2();
				let tooltipTimeout;

				container.addEventListener('mousemove', (event) => {
					const rect = container.getBoundingClientRect();
					mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
					mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;

					raycaster.setFromCamera(mouse, camera);
					const intersects = raycaster.intersectObjects(dotClouds);

					clearTimeout(tooltipTimeout);
					const existingTooltip = document.getElementById('tooltip');
					if (existingTooltip) existingTooltip.remove();

					if (intersects.length > 0) {
						const intersect = intersects[0];
						const index = dotClouds.indexOf(intersect.object);
						const legendItem = colorLegend[index];
						if (legendItem) {
							const tooltip = document.createElement('div');
							tooltip.id = 'tooltip';
							tooltip.style.position = 'absolute';
							tooltip.style.left = `${event.clientX + 10}px`;
							tooltip.style.top = `${event.clientY + 10}px`;
                                                   tooltip.style.background = 'rgba(0, 255, 126, 0.8)';
							tooltip.style.color = '#1e2727';
							tooltip.style.padding = '0.25rem 0.5rem';
							tooltip.style.borderRadius = '4px';
							tooltip.style.fontSize = '0.75rem';
							tooltip.style.zIndex = '60';
							tooltip.innerHTML = `Price: $${legendItem.price.toLocaleString()}<br>Volume: ${legendItem.volume.toLocaleString()}<br>Time: ${legendItem.time}`;
							document.body.appendChild(tooltip);

							tooltipTimeout = setTimeout(() => tooltip.remove(), 2000);
						}
					}
				});

				function animate() {
					requestAnimationFrame(animate);
					controls.update();
					renderer.render(scene, camera);
				}
				animate();
			}

			async function updateBTCHash() {
				isBTCPriceMock = false;

				let historicalData;
				const [hashRate, difficulty] = await Promise.all([
					fetchBTCHashRate(),
					fetchBTCDifficulty()
				]);
				try {
					historicalData = await fetchBTCHistoricalData();
				} catch (error) {
					isBTCPriceMock = true;
					historicalData = null;
				}

				if (historicalData) {
					const prices = historicalData.prices;
					const volumes = historicalData.total_volumes;
					const timestamps = prices.map((p) => p[0]);
					const minTime = Math.min(...timestamps);
					const maxTime = Math.max(...timestamps);
					const minPrice = Math.min(...prices.map((p) => p[1]));
					const maxPrice = Math.max(...prices.map((p) => p[1]));
					const minVolume = Math.min(...volumes.map((v) => v[1]));
					const maxVolume = Math.max(...volumes.map((v) => v[1]));
					const pointsPerCloud = 100;
					const latestPrice = prices[prices.length - 1][1];
					const latestVolume = volumes[volumes.length - 1][1];
					const recentPrices = prices.slice(-10).map((p) => p[1]);
					const volatility =
						((Math.max(...recentPrices) - Math.min(...recentPrices)) /
							latestPrice) *
						100;
					const momentum = latestPrice - prices[prices.length - 2][1];
					const cloudColorHex = getThemeColor(
						volatility,
						latestVolume,
						minVolume,
						maxVolume
					);
					const cloudColor = new THREE.Color(cloudColorHex);

					const dotPositions = [];
					const dotColors = [];

					for (let i = 0; i < prices.length; i++) {
						const timestamp = timestamps[i];
						const price = prices[i][1];
						const volume = volumes[i][1];
						const z = ((timestamp - minTime) / (maxTime - minTime)) * 20 - 10;
						const x = ((price - minPrice) / (maxPrice - minPrice)) * 20 - 10;
						const y =
							((volume - minVolume) / (maxVolume - minVolume)) * 20 - 10;

						for (let j = 0; j < pointsPerCloud; j++) {
							const offsetX = (Math.random() - 0.5) * 1;
							const offsetY = (Math.random() - 0.5) * 1;
							const offsetZ = (Math.random() - 0.5) * 1;
							dotPositions.push(x + offsetX, y + offsetY, z + offsetZ);
							dotColors.push(cloudColor.r, cloudColor.g, cloudColor.b);
						}
					}

					const geometry = new THREE.BufferGeometry();
					geometry.setAttribute(
						'position',
						new THREE.Float32BufferAttribute(dotPositions, 3)
					);
					geometry.setAttribute(
						'color',
						new THREE.Float32BufferAttribute(dotColors, 3)
					);
					const material = new THREE.PointsMaterial({
						size: 0.1,
						vertexColors: true,
						transparent: true,
						opacity: 1
					});
					const newDotCloud = new THREE.Points(geometry, material);
					scene.add(newDotCloud);
					dotClouds.push(newDotCloud);
					dotClouds.slice(0, -1).forEach((cloud) => {
						cloud.material.opacity =
							cloud.material.opacity - 0.05 <= 0.1
								? 1
								: cloud.material.opacity - 0.05;
					});

					const latestTime = new Date(
						timestamps[timestamps.length - 1]
					).toLocaleTimeString();
					colorLegend.push({
						color: cloudColorHex,
						price: latestPrice,
						volume: latestVolume,
						time: latestTime
					});
					updateColorLegend();

					document.getElementById('btc-price').textContent =
						`Price: $${latestPrice.toLocaleString()}`;
					document.getElementById('btc-time').textContent =
						`Time: ${latestTime}`;
					document.getElementById('btc-date').textContent =
						`Date: ${new Date().toLocaleDateString()}`;
					document.getElementById('btc-volume').textContent =
						`Volume: ${latestVolume.toLocaleString()}`;
					document.getElementById('btc-volatility').textContent =
						`Volatility: ${volatility.toFixed(2)}%`;
					document.getElementById('btc-momentum').textContent =
						`Momentum: ${momentum >= 0 ? '+' : ''}${momentum.toFixed(2)}`;
					if (DOM.playlistPrice)
						DOM.playlistPrice.textContent = `Price: $${latestPrice.toLocaleString()}`;
					if (DOM.playlistTime)
						DOM.playlistTime.textContent = `Time: ${latestTime}`;
					if (DOM.playlistDate)
						DOM.playlistDate.textContent = new Date().toLocaleDateString();
					if (DOM.btcDate)
						DOM.btcDate.textContent = new Date().toLocaleDateString();
					if (DOM.loadingPrice)
						DOM.loadingPrice.textContent = `Price: $${latestPrice.toLocaleString()}`;
					if (DOM.loadingTime) DOM.loadingTime.textContent = latestTime;
					if (DOM.loadingDate)
						DOM.loadingDate.textContent = new Date().toLocaleDateString();
					const dateTime = new Date().toLocaleString('en-US', {
						month: 'short',
						day: 'numeric',
						year: 'numeric',
						hour: '2-digit',
						minute: '2-digit'
					});
					if (DOM.trackAPrice)
						DOM.trackAPrice.textContent = `$${latestPrice.toLocaleString()}`;
					if (DOM.trackATime) DOM.trackATime.textContent = dateTime;
					if (DOM.trackBPrice)
						DOM.trackBPrice.textContent = `$${latestPrice.toLocaleString()}`;
					if (DOM.trackBTime) DOM.trackBTime.textContent = dateTime;

					const inverse = await fetchTopInverseToken();
					const topCoin = await fetchTopCoin();
					const lossText = `${inverse.symbol} ${inverse.change.toFixed(2)}%`;
					if (DOM.loadingInverse)
						DOM.loadingInverse.textContent = `Down: ${lossText}`;
					if (DOM.loadingTopcoin)
						DOM.loadingTopcoin.textContent = `Top : ${topCoin}`;
					if (DOM.trackATopcoin)
						DOM.trackATopcoin.textContent = `Top: ${topCoin}`;
					if (DOM.trackBTopcoin)
						DOM.trackBTopcoin.textContent = `Top: ${topCoin}`;
					if (DOM.trackAInverse)
						DOM.trackAInverse.textContent = `Loss: ${lossText}`;
					if (DOM.trackBInverse)
						DOM.trackBInverse.textContent = `Loss: ${lossText}`;
					if (DOM.btcOverlayPrice)
						DOM.btcOverlayPrice.textContent = `$${latestPrice.toLocaleString()}`;
					if (DOM.btcOverlayLoss) DOM.btcOverlayLoss.textContent = lossText;
					if (DOM.btcOverlayHashrate)
						DOM.btcOverlayHashrate.textContent = `Hash: ${hashRate.toFixed(2)} EH/s`;
                                        if (DOM.btcOverlayDifficulty)
                                                DOM.btcOverlayDifficulty.textContent = `Diff: ${difficulty.toFixed(0)}`;
                                        if (DOM.btcOverlayMode)
                                                DOM.btcOverlayMode.textContent =
                                                        currentTheme === 'heatmap'
                                                                ? 'Heat Map'
                                                                : currentTheme === 'lifecycle'
                                                                ? 'Life Cycle'
                                                                : 'Original';

					const hashId = generateHashFromPrice(latestPrice);
					addHashLog(hashId, latestTime);
				} else {
					document.getElementById('btc-hash-warning').style.display = 'block';
					document.getElementById('btc-hash-warning').textContent =
						'> Live data from Dune API';
				}
			}

			function addHashLog(hashId, time) {
				const logList = document.getElementById('hash-log-list');
				const li = document.createElement('li');
				li.className = 'p-2 rounded';
				li.innerHTML = `<div>Hash ID: ${hashId}</div><div class="metric">Time: ${time}</div>`;
				logList.prepend(li);
				if (logList.children.length > 10)
					logList.removeChild(logList.lastChild);
				hashLog.unshift({ hashId, time });
				if (hashLog.length > 10) hashLog.pop();
			}

                        function updateColorLegend() {
                                document.getElementById('btc-color-legend').innerHTML = colorLegend
                                        .map(
                                                (item, index) => `
        <div class="legend-item" data-tooltip="Price: $${item.price.toLocaleString()}\nVolume: ${item.volume.toLocaleString()}\nTime: ${item.time}">
          <div class="legend-color" style="background: ${item.color}"></div>
        </div>
      `
					)
                                        .join('');
                        }

                        function interpolateColor(c1, c2, ratio) {
                                const hex = (c) => parseInt(c.replace('#', ''), 16);
                                const r1 = (hex(c1) >> 16) & 255;
                                const g1 = (hex(c1) >> 8) & 255;
                                const b1 = hex(c1) & 255;
                                const r2 = (hex(c2) >> 16) & 255;
                                const g2 = (hex(c2) >> 8) & 255;
                                const b2 = hex(c2) & 255;
                                const r = Math.round(r1 + (r2 - r1) * ratio);
                                const g = Math.round(g1 + (g2 - g1) * ratio);
                                const b = Math.round(b1 + (b2 - b1) * ratio);
                                return `#${((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1)}`;
                        }

                        function getThemeColor(vol, volume, minV, maxV) {
                                if (currentTheme === 'heatmap') {
                                        const ratio = Math.min(vol / 5, 1);
                                        if (ratio < 0.5) {
                                                return interpolateColor(
                                                        themes.heatmap[0],
                                                        themes.heatmap[1],
                                                        ratio * 2
                                                );
                                        }
                                        return interpolateColor(
                                                themes.heatmap[1],
                                                themes.heatmap[2],
                                                (ratio - 0.5) * 2
                                        );
                                } else if (currentTheme === 'lifecycle') {
                                        const ratio = (volume - minV) / (maxV - minV);
                                        if (ratio < 0.25) return themes.lifecycle[0];
                                        if (ratio < 0.5) return themes.lifecycle[1];
                                        return themes.lifecycle[2];
                                } else {
                                        const idx = dotClouds.length % themes.original.length;
                                        return themes.original[idx];
                                }
                        }

                        function setTheme(name) {
                                currentTheme = name;
                                siteColors = themes[name] || themes.original;
                                colorLegend = [];
                                dotClouds.forEach((c) => scene.remove(c));
                                dotClouds = [];
                                updateColorLegend();
                                if (DOM.btcThemeSelect)
                                        DOM.btcThemeSelect.value = name;
                                if (DOM.btcOverlayMode)
                                        DOM.btcOverlayMode.textContent =
                                                name === 'heatmap'
                                                        ? 'Heat Map'
                                                        : name === 'lifecycle'
                                                        ? 'Life Cycle'
                                                        : 'Original';
                                updateBTCHash();
                        }

			async function renderGasHeatmapAndFees() {
				const canvas = document.getElementById('gas-heatmap-canvas');
				const gasList = document.getElementById('gas-heatmap-list');
				const loader = document.getElementById('loader-gas-fees');
				const gasFeesWarning = document.getElementById('gas-fees-warning');
				if (!canvas || !gasList || !loader || !gasFeesWarning)
					return console.error(
						'[ERROR] Gas heatmap or fees elements not found'
					);

				const ctx = canvas.getContext('2d');
				if (!ctx) {
					loader.textContent = '> Failed to initialize canvas';
					loader.style.display = 'block';
					return console.error(
						'[ERROR] Failed to get 2D context for gas heatmap canvas'
					);
				}

				const maxHistory = 20;
				const margin = { top: 20, right: 10, bottom: 20, left: 40 };

				const resizeCanvas = () => {
					const dpr = window.devicePixelRatio || 1;
					canvas.width = canvas.offsetWidth * dpr;
					canvas.height = canvas.offsetHeight * dpr;
					canvas.style.width = `${canvas.offsetWidth}px`;
					canvas.style.height = `${canvas.offsetHeight}px`;
					ctx.scale(dpr, dpr);
				};

				resizeCanvas();
				let resizeTimeout;
				window.addEventListener('resize', () => {
					clearTimeout(resizeTimeout);
					resizeTimeout = setTimeout(resizeCanvas, 100);
				});

                                const getColor = (type) => {
                                        if (type === 'safe') return 'hsl(140, 100%, 25%)';
                                        if (type === 'propose') return 'hsl(140, 100%, 40%)';
                                        return 'hsl(140, 100%, 55%)';
                                };

				const updateHeatmapAndFees = async () => {
					try {
						loader.style.display = 'block';
						gasList.innerHTML = '';
						gasFeesWarning.style.display = 'none';

						const gasPromises = CHAINS.map((chainId) =>
							fetchGasPrices(chainId)
						);
						const gasResults = await Promise.all(gasPromises);
						const isAllMock = gasResults.every(
							(g) => g.lastBlock === 'N/A' && g.safeGasPrice === 10
						);
						if (isAllMock) gasFeesWarning.style.display = 'block';

						gasResults.forEach((gasData) => {
							gasHistory.push(gasData);
							if (gasHistory.length > maxHistory) gasHistory.shift();
						});

						gasList.innerHTML = gasHistory
							.slice(-5)
							.reverse()
							.map(
								(data) => `
            <li class="p-2 rounded">
              <div>Chain: ${data.chainId} | Block: ${data.lastBlock}</div>
              <div>Safe: ${data.safeGasPrice} Gwei</div>
              <div>Propose: ${data.proposeGasPrice} Gwei</div>
              <div>Fast: ${data.fastGasPrice} Gwei</div>
              <div class="metric">Time: ${new Date(data.timestamp).toLocaleTimeString()}</div>
            </li>
          `
							)
							.join('');

						ctx.clearRect(0, 0, canvas.width, canvas.height);
						const maxGas = Math.max(
							...gasHistory.map((d) =>
								Math.max(d.fastGasPrice, d.proposeGasPrice, d.safeGasPrice)
							),
							100
						);
						const plotWidth = canvas.offsetWidth - margin.left - margin.right;
						const plotHeight = canvas.offsetHeight - margin.top - margin.bottom;
						const barWidth = Math.max(plotWidth / maxHistory / 3.5, 2);

						gasHistory.forEach((data, i) => {
							const x = margin.left + (i * plotWidth) / maxHistory;
							const prices = [
								{ value: data.safeGasPrice, type: 'safe' },
								{ value: data.proposeGasPrice, type: 'propose' },
								{ value: data.fastGasPrice, type: 'fast' }
							];
							prices.forEach((price, j) => {
								const height = (price.value / maxGas) * plotHeight * 0.9;
								const y = margin.top + plotHeight - height;
								ctx.fillStyle = getColor(price.type);
								ctx.fillRect(x + j * (barWidth + 1), y, barWidth - 1, height);
							});
						});

						ctx.fillStyle = '#e0f7fa';
						ctx.font = '10px Inconsolata';
						ctx.textAlign = 'right';
						ctx.textBaseline = 'middle';
						const yTicks = [0, Math.round(maxGas / 2), maxGas];
						yTicks.forEach((tick) => {
							const y = margin.top + plotHeight - (tick / maxGas) * plotHeight;
							ctx.fillText(`${tick} Gwei`, margin.left - 5, y);
						});

						ctx.textAlign = 'center';
						ctx.textBaseline = 'top';
						const latestTime = new Date(
							gasHistory[gasHistory.length - 1]?.timestamp
						);
						ctx.fillText(
							latestTime.toLocaleTimeString(),
							margin.left + plotWidth,
							margin.top + plotHeight + 5
						);

						const ethGas =
							gasResults.find((g) => g.chainId === 1) || gasResults[0];
						updateFees(
							ethGas.proposeGasPrice,
							currentEthPrice > 0 ? currentEthPrice : 4000
						);
						loader.style.display = 'none';
					} catch (error) {
						console.error(
							'[ERROR] Failed to update gas heatmap and fees:',
							error
						);
						loader.textContent = '> Error loading gas heatmap and fees';
						loader.style.display = 'block';
						gasFeesWarning.style.display = 'block';
					}
				};

				updateHeatmapAndFees();
				setInterval(updateHeatmapAndFees, 60000);
			}

			function updateFees(gasPrice, ethPrice) {
				const transferFeeEth = (gasPrice * 21000) / 1e9;
				const transferFeeUsd = transferFeeEth * ethPrice;
				document.getElementById('transfer-fee').textContent =
					transferFeeUsd.toFixed(2);
				const withdrawFeeEth = 0.001;
				const withdrawFeeUsd = withdrawFeeEth * ethPrice;
				document.getElementById('withdraw-fee').textContent =
					withdrawFeeUsd.toFixed(2);
				const bridgeFeeEth = 0.005;
				const bridgeFeeUsd = bridgeFeeEth * ethPrice;
				document.getElementById('bridge-fee').textContent =
					bridgeFeeUsd.toFixed(2);
				document.getElementById('loader-gas-fees').style.display = 'none';
			}

			async function fetchLogs() {
				if (!walletAddress) {
					return [
						{
							message: 'Connect wallet to view trade logs',
							type: 'info',
							timestamp: new Date().toLocaleString()
						}
					];
				}
				const cacheKey = `dune_logs_${walletAddress}`;
				const cached = localStorage.getItem(cacheKey);
				if (cached && Date.now() - JSON.parse(cached).timestamp < 3600000) {
					DOM.logsWarning.style.display = 'block';
					return JSON.parse(cached).data;
				}
				try {
					const url = `https://api.sim.dune.com/v1/evm/transactions/${walletAddress}?chain_id=${CHAIN_ID}`;
					const data = await fetchWithRetry(url, {
						headers: { 'x-sim-api-key': DUNE_API_KEY }
					});
					const result = (data.data || []).map((tx) => ({
						message: tx.transaction_hash,
						type: 'trade',
						timestamp: tx.block_time
					}));
					localStorage.setItem(
						cacheKey,
						JSON.stringify({ timestamp: Date.now(), data: result })
					);
					DOM.logsWarning.style.display = 'none';
					return result;
				} catch (error) {
					console.error('Failed to fetch logs:', error);
					DOM.logsWarning.style.display = 'block';
					return mockLogs;
				}
			}

			async function renderLogs() {
				const logList = document.getElementById('log-list');
				const loader = document.getElementById('loader-logs');
				const logsWarning = document.getElementById('logs-warning');
				if (!logList || !loader || !logsWarning)
					return console.error('[ERROR] Log elements not found');

				try {
					loader.style.display = 'block';
					logsWarning.style.display = isUsingMockLogs ? 'block' : 'none';
					const logs = isUsingMockLogs ? mockLogs : await fetchLogs();
					logList.innerHTML = logs
						.map(
							(log) => `
          <li class="p-2 rounded">
            <div>${log.message}</div>
            <div class="metric">Type: ${log.type}</div>
            <div class="metric">Time: ${log.timestamp}</div>
          </li>
        `
						)
						.join('');
					loader.style.display = 'none';
				} catch (error) {
					console.error('[ERROR] Failed to render logs:', error);
					loader.textContent = '> Error loading logs';
					loader.style.display = 'block';
					logsWarning.style.display = 'block';
				}
			}

			function addSystemLog(message) {
				const logList = document.getElementById('system-logs-list');
				const li = document.createElement('li');
				li.className = 'p-2 rounded';
				li.innerHTML = `<div>${message}</div><div class="metric">Time: ${new Date().toLocaleTimeString()}</div>`;
				logList.prepend(li);
				if (logList.children.length > 10)
					logList.removeChild(logList.lastChild);
			}

                        function renderTokenPerformanceChart(tokens) {
                                const ctx = DOM.tokenPerformanceChart.getContext('2d');
                                const labels = tokens.map((token) => token.symbol);
                                const data = tokens.map((token) => parseFloat(token.price_change_percentage_24h) || 0);
                                new Chart(ctx, {
                                        type: 'bar',
                                        data: {
                                                labels: labels,
                                                datasets: [
                                                        {
                                                                label: '24h Price Change (%)',
                                                                data: data,
                                                                backgroundColor: data.map((value) =>
                                                                        value >= 0 ? 'var(--primary-color)' : '#ff0000'
                                                                )
                                                        }
                                                ]
                                        },
                                        options: {
                                                onClick: (_, elements) => {
                                                        if (elements.length) {
                                                                const index = elements[0].index;
                                                                const token = tokens[index];
                                                                window.open(`https://coinmarketcap.com/currencies/${token.id}/`, '_blank');
                                                        }
                                                },
                                                scales: {
                                                        y: {
                                                                beginAtZero: true
                                                        }
                                                }
                                        }
                                });
			}

			function exportToCSV(data, filename) {
				const csv = data.map((row) => Object.values(row).join(',')).join('\n');
				const headers = Object.keys(data[0]).join(',');
				const blob = new Blob([headers + '\n' + csv], { type: 'text/csv' });
				const url = window.URL.createObjectURL(blob);
				const a = document.createElement('a');
				a.href = url;
				a.download = filename;
				a.click();
				window.URL.revokeObjectURL(url);
			}

			function exportChart() {
				if (!window.inverseChart) return;
				const link = document.createElement('a');
				link.href = window.inverseChart.toBase64Image();
				link.download = 'inverse_metrics.png';
				link.click();
			}

			function notifyUser(message) {
				if (Notification.permission === 'granted') {
					new Notification('QuantumI Alert', { body: message });
				} else if (Notification.permission !== 'denied') {
					Notification.requestPermission().then((permission) => {
						if (permission === 'granted')
							new Notification('QuantumI Alert', { body: message });
					});
				}
			}

			const loadData = async () => {
                                const backendApiUrl = '/api/crypto';
				const tokenWarning = document.getElementById('token-warning');
				const logsWarning = document.getElementById('logs-warning');
				const gasFeesWarning = document.getElementById('gas-fees-warning');
				const balancesWarning = document.getElementById('balances-warning');
				const tokenInsightsWarning = document.getElementById(
					'token-insights-warning'
				);

				try {
					const data = await fetchWithRetry(backendApiUrl);
					if (!Array.isArray(data) || data.length === 0)
						throw new Error('Invalid or empty response from backend');
					const ethData = data.find((token) => token.symbol === 'ETH');
					if (ethData) {
						const gasData = await fetchGasPrices(1); // Ethereum Mainnet
						ethData.gasPrice = gasData.proposeGasPrice;
						currentEthPrice = ethData.current_price;
					}
					tokensData = data;
					updateUI(data);
					tokenWarning.style.display = 'none';
					renderGasHeatmapAndFees();
					renderLogs();
					renderTokenPerformanceChart(data);
				} catch (error) {
					console.error('Failed to load real data:', error);
					tokensData = mockTokens;
					updateUI(mockTokens);
					tokenWarning.style.display = 'block';
					tokenWarning.textContent = '> Live data from Dune API';
					document.getElementById('live-price-header').textContent =
						`> Live Price: Using mock data`;
					document.getElementById('chart-title-header').textContent =
						'Mock Data';
					document.getElementById('chart-title-modal').textContent =
						'Mock Data';
					document.getElementById('loader-tokens').style.display = 'none';
					renderGasHeatmapAndFees();
					renderLogs();
					renderTokenPerformanceChart(mockTokens);
				}

				document
					.getElementById('toggle-logs-data')
					.addEventListener('click', () => {
						isUsingMockLogs = !isUsingMockLogs;
						document.getElementById('toggle-logs-data').textContent =
							isUsingMockLogs ? 'Real Logs' : 'Mock Logs';
						logsWarning.style.display = isUsingMockLogs ? 'block' : 'none';
						renderLogs();
					});

                                try {
                                        const target = walletAddress || TOKEN_ADDRESS;
                                        const tokenInfo = await fetchTokenInfo(target, CHAIN_ID);
                                        if (tokenInfo) {
                                                balancesData = tokenInfo.map((info) => ({
                                                        token: info.symbol,
                                                        balance: info.balance,
                                                        chainId: info.chain_id
                                                }));
                                                updateBalancesUI(balancesData);
                                                DOM.balancesWarning.style.display = 'none';
                                        } else throw new Error('No token info received');
                                } catch (error) {
                                        console.error('Failed to load wallet data:', error);
                                        balancesData = mockBalances;
                                        updateBalancesUI(mockBalances);
                                        DOM.balancesWarning.style.display = 'block';
                                        DOM.balancesWarning.textContent = '> Using mock balances due to API failure';
                                }

			};

			function updateUI(tokens) {
				if (!tokens || tokens.length === 0) {
					console.error('No tokens provided to updateUI');
					document.getElementById('loader-tokens').textContent =
						'> No data available';
					return;
				}

				document.getElementById('loader-tokens').style.display = 'none';
				const tokenList = document.getElementById('token-list');
				tokenList.innerHTML = tokens
					.map((token, index) => {
						const isPositive = token.price_change_percentage_24h >= 0;
						const symbol = `BINANCE:${token.symbol}USDT`;
						return `
          <li class="${index === 0 ? 'selected-token' : ''}" data-symbol="${symbol}" data-tooltip="View ${token.symbol} chart">
            <div class="flex justify-between items-center">
              <span><a href="https://coinmarketcap.com/currencies/${token.id}/" target="_blank" class="token-link">${token.name}</a> (${token.symbol})</span>
              <span class="performance ${isPositive ? 'text-green-400' : 'text-red-400'}">${token.price_change_percentage_24h >= 0 ? '+' : ''}${token.price_change_percentage_24h.toFixed(2)}%</span>
            </div>
            <span class="cmc-link mt-1 text-xs" data-cmc="${token.id}" aria-label="Open CoinMarketCap page">CMC</span>
            <div class="metric">Price: $${token.current_price.toLocaleString()}</div>
            <div class="metric">Volume: ${token.total_volume.toLocaleString()} USD</div>
            <div class="metric">Supply: ${token.circulating_supply.toLocaleString()}</div>
            ${token.symbol === 'ETH' && token.gasPrice ? `<div class="metric">Gas: ${token.gasPrice} Gwei</div>` : ''}
          </li>
        `;
					})
					.join('');

				const profitPairs = document.getElementById('profit-pairs');
				const sortedTokens = [...tokens].sort(
					(a, b) =>
						b.price_change_percentage_24h - a.price_change_percentage_24h
				);
				const topToken = sortedTokens[0] || mockTokens[0];
				const bottomToken =
					sortedTokens[sortedTokens.length - 1] || mockTokens[1];
				profitPairs.innerHTML = `
        <li class="top-pair p-2 rounded">
          <div><a href="https://coinmarketcap.com/currencies/${topToken.id}/" target="_blank" class="token-link">${topToken.name}</a> (${topToken.symbol}): +${topToken.price_change_percentage_24h.toFixed(2)}%</div>
          <div class="metric">Price: $${topToken.current_price.toLocaleString()}</div>
          <div class="metric">Volume: ${topToken.total_volume.toLocaleString()} USD</div>
        </li>
        <li class="bottom-pair p-2 rounded">
          <div><a href="https://coinmarketcap.com/currencies/${bottomToken.id}/" target="_blank" class="token-link">${bottomToken.name}</a> (${bottomToken.symbol}): ${bottomToken.price_change_percentage_24h.toFixed(2)}%</div>
          <div class="metric">Price: $${bottomToken.current_price.toLocaleString()}</div>
          <div class="metric">Volume: ${bottomToken.total_volume.toLocaleString()} USD</div>
        </li>
      `;

				const topPairs = document.getElementById('top-pairs');
				topPairs.innerHTML = tokens
					.filter((token) => token.symbol && token.symbol !== 'USDT')
					.slice(0, 5)
                                        .map(
                                                (token) =>
                                                        `<li class="p-1 rounded-md"><a href="https://coinmarketcap.com/currencies/${token.id}/" target="_blank" class="token-link">${token.symbol}/USDT (#${token.market_cap_rank})</a></li>`
                                        )
					.join('');

				const uniquePun =
					quantumPuns[Math.floor(Math.random() * quantumPuns.length)] ||
					'Quantum leap to profits!';
				const marqueeContent = [
					...tokens
						.slice(0, 5)
						.map(
							(token) =>
								`<span>[${token.symbol}] $${token.current_price.toLocaleString()} (${token.price_change_percentage_24h.toFixed(2)}%)</span>`
						),
					`<span>${uniquePun}</span>`
				].join('');
				document.getElementById('ticker-marquee-header').innerHTML =
					marqueeContent.repeat(3);
				document.getElementById('ticker-marquee-modal').innerHTML =
					marqueeContent.repeat(3);
				document.getElementById(
					'ticker-marquee-header'
				).style.animationDuration = `${Math.max(80, tokens.length * 5)}s`;
				document.getElementById(
					'ticker-marquee-modal'
				).style.animationDuration = `${Math.max(80, tokens.length * 5)}s`;

				const topSymbol = `BINANCE:${topToken.symbol}USDT`;
				initializeChart('chart-container-header', topSymbol, 'D');
				initializeChart('chart-container-modal', topSymbol, 'D');
				document
					.getElementById('chart-title-header')
					.setAttribute('data-symbol', topSymbol);
				document.getElementById('chart-title-header').textContent = topSymbol;
				document
					.getElementById('chart-title-modal')
					.setAttribute('data-symbol', topSymbol);
				document.getElementById('chart-title-modal').textContent = topSymbol;

				const ethToken = tokens.find((token) => token.symbol === 'ETH');
				if (ethToken) {
					currentEthPrice = ethToken.current_price;
					const gasPrice = ethToken.gasPrice || 15;
					updateFees(gasPrice, currentEthPrice);
				} else updateFees(15, 4000);
				document.getElementById('gas-fees-warning').style.display = 'none';
			}

			function updateBalancesUI(balances) {
				if (!balances || balances.length === 0) {
					console.error('No balances provided to updateBalancesUI');
					DOM.loaderBalances.textContent = '> No data available';
					return;
				}

				DOM.loaderBalances.style.display = 'none';
				DOM.balancesList.innerHTML = balances
					.map((balance) => {
						const slug = (balance.name || balance.token)
							.toLowerCase()
							.replace(/\s+/g, '-');
						return `
        <li class="p-2 rounded">
          <a href="https://coinmarketcap.com/currencies/${slug}/" target="_blank" class="underline token-link">${balance.token}</a>
          <div>Balance: ${balance.balance.toLocaleString()}</div>
          <div class="metric">Chain ID: ${balance.chainId}</div>
        </li>`;
					})
					.join('');
			}



			function sanitizeInput(input) {
				const div = document.createElement('div');
				div.textContent = input;
				return div.innerHTML;
			}

			function debounce(fn, delay = 100) {
				let t;
				return (...args) => {
					clearTimeout(t);
					t = setTimeout(() => fn(...args), delay);
				};
			}

			function extractVideoId(url) {
				if (!url) return null;
				const match = url.match(/(?:v=|\.be\/)([A-Za-z0-9_-]{11})/);
				return match ? match[1] : url;
			}

        async function loadTwitterTimeline() {
                const container = document.getElementById('twitter-timeline');
                const list = document.getElementById('twitter-list');
                if (!container) return;
                container.innerHTML =
                        '<a class="twitter-timeline" href="https://x.com/DIFF810489" data-tweet-limit="10" data-chrome="nofooter transparent">Tweets by DIFF810489</a>';
                function initWidget() {
                        window.twttr && window.twttr.widgets && window.twttr.widgets.load(container);
                }
                function loadTweetsFallback() {
                        fetchTwitterData().then((tweets) => {
                                container.style.display = 'none';
                                if (list) list.style.display = 'block';
                                if (list) list.innerHTML = '';
                                tweets.forEach((t) => {
                                        const li = document.createElement('li');
                                        li.innerHTML = `<p class="metric">${sanitizeInput(t.text)}</p><div class="metric">${new Date(t.created_at).toLocaleString()}</div>`;
                                        if (t.image)
                                                li.innerHTML += `<img src="${t.image}" alt="tweet image" style="max-width:100%" />`;
                                        if (t.video)
                                                li.innerHTML += `<video src="${t.video}" controls style="max-width:100%"></video>`;
                                        list.appendChild(li);
                                });
                        });
                }
                if (!window.twttr || !window.twttr.widgets) {
                        const script = document.createElement('script');
                        script.src = 'https://platform.twitter.com/widgets.js';
                        script.async = true;
                        script.onload = initWidget;
                        script.onerror = loadTweetsFallback;
                        document.body.appendChild(script);
                } else {
                        initWidget();
                }
                setTimeout(() => {
                        if (!container.querySelector('iframe')) loadTweetsFallback();
                }, 5000);
        }

			document.addEventListener('DOMContentLoaded', () => {
				DOM.navMenuToggle.addEventListener('click', () =>
					DOM.navMenu.classList.add('active')
				);
				DOM.navMenuClose.addEventListener('click', () =>
					DOM.navMenu.classList.remove('active')
				);
				if (DOM.duneVersion) DOM.duneVersion.textContent = DUNE_MODULE_VERSION;

				const params = new URLSearchParams(window.location.search);
				if (params.get('dj') === '1') {
					document.querySelector('header').style.display = 'none';
					document.querySelectorAll('#module-grid section').forEach((sec) => {
						if (sec.id !== 'dj-dashboard') sec.style.display = 'none';
					});
					document.querySelector('footer').style.display = 'none';
				}

				setupDragAndDrop();
				loadModuleOrder();
                                setupModuleToggles();
                                setupPlaylistDescriptions();
                                loadData();
                                if (DOM.raribleContainer) {
                                        DOM.raribleContainer.querySelectorAll('iframe').forEach(f => {
                                                if (!f.src && f.dataset.src) f.src = f.dataset.src;
                                        });
                                        DOM.raribleContainer.style.display = 'block';
                                        if (DOM.raribleLoader) DOM.raribleLoader.style.display = 'none';
                                }
                                if (DOM.twitterTimeline) {
                                        loadTwitterTimeline();
                                }
                                if (DOM.tokenSearch) {
                                        DOM.tokenSearch.addEventListener(
                                                'input',
                                                debounce(() => {
                                                        const q = DOM.tokenSearch.value.toLowerCase();
                                                        document.querySelectorAll('#token-list li').forEach((li) => {
                                                                li.style.display = li.textContent.toLowerCase().includes(q)
                                                                        ? ''
                                                                        : 'none';
                                                        });
                                                }, 200)
                                        );
                                }
                                init3D();
				updateBTCHash();
				fetchTopCoin().then((c) => {
					if (DOM.loadingTopcoin)
						DOM.loadingTopcoin.textContent = `Top : ${c}`;
					if (DOM.trackATopcoin) DOM.trackATopcoin.textContent = `Top: ${c}`;
					if (DOM.trackBTopcoin) DOM.trackBTopcoin.textContent = `Top: ${c}`;
				});
				fetchTopInverseToken().then((i) => {
					const txt = `${i.symbol} ${i.change.toFixed(2)}%`;
					if (DOM.loadingInverse)
						DOM.loadingInverse.textContent = `Down: ${txt}`;
					if (DOM.trackAInverse) DOM.trackAInverse.textContent = `Loss: ${txt}`;
					if (DOM.trackBInverse) DOM.trackBInverse.textContent = `Loss: ${txt}`;
				});

				if (DOM.muteBtn) {
					DOM.muteBtn.addEventListener('click', () => {
						if (!DOM.introVideo) return;
						DOM.introVideo.muted = !DOM.introVideo.muted;
						DOM.muteBtn.textContent = DOM.introVideo.muted ? '' : '';
					});
				}
                                if (DOM.playIntroBtn) {
                                        DOM.playIntroBtn.addEventListener('click', () => {
                                                if (!DOM.introVideo) return;
                                                introPlayed = true;
                                                localStorage.setItem('introPlayed', '1');
                                                DOM.introVideo.play().catch(() => {});
                                        });
                                }

				if (DOM.musicMuteBtn) {
					DOM.musicMuteBtn.addEventListener('click', () => {
						if (!bgMusicPlayer) return;
						if (bgMusicPlayer.isMuted()) {
							bgMusicPlayer.unMute();
							DOM.musicMuteBtn.textContent = '';
							DOM.musicMuteBtn.classList.add('active');
						} else {
							bgMusicPlayer.mute();
							DOM.musicMuteBtn.textContent = '';
							DOM.musicMuteBtn.classList.remove('active');
						}
					});
				}

				if (DOM.quantumiSoundBtn) {
					DOM.quantumiSoundBtn.addEventListener('click', () => {
						isQuantumSound = !isQuantumSound;
						if (isQuantumSound) {
							enableQuantumSound();
						} else {
							disableQuantumSound();
						}
						DOM.quantumiSoundBtn.textContent = isQuantumSound
							? 'Sound Off'
							: 'QuantumI Sound';
						if (isQuantumSound) DOM.quantumiSoundBtn.classList.add('active');
						else DOM.quantumiSoundBtn.classList.remove('active');
					});
				}

				if (DOM.trackALoad) {
					DOM.trackALoad.addEventListener('click', () => {
						const q = DOM.trackAUrl.value.trim();
						if (q && trackAPlayer) {
							trackAPlayer.loadPlaylist({ listType: 'search', list: q });
						}
					});
				}

				if (DOM.trackBLoad) {
					DOM.trackBLoad.addEventListener('click', () => {
						const q = DOM.trackBUrl.value.trim();
						if (q && trackBPlayer) {
							trackBPlayer.loadPlaylist({ listType: 'search', list: q });
						}
					});
				}

				let cueA = 0;
				let cueB = 0;
				if (DOM.trackASetCue) {
					DOM.trackASetCue.addEventListener('click', () => {
						if (trackAPlayer && trackAPlayer.getCurrentTime) {
							cueA = trackAPlayer.getCurrentTime();
						}
					});
				}
				if (DOM.trackACue) {
					DOM.trackACue.addEventListener('click', () => {
						if (trackAPlayer && trackAPlayer.seekTo) {
							trackAPlayer.seekTo(cueA, true);
							trackAPlayer.playVideo();
						}
					});
				}
				if (DOM.trackBSetCue) {
					DOM.trackBSetCue.addEventListener('click', () => {
						if (trackBPlayer && trackBPlayer.getCurrentTime) {
							cueB = trackBPlayer.getCurrentTime();
						}
					});
				}
				if (DOM.trackBCue) {
					DOM.trackBCue.addEventListener('click', () => {
						if (trackBPlayer && trackBPlayer.seekTo) {
							trackBPlayer.seekTo(cueB, true);
							trackBPlayer.playVideo();
						}
					});
				}

				if (DOM.trackAPlay)
					DOM.trackAPlay.addEventListener(
						'click',
						() => trackAPlayer && trackAPlayer.playVideo()
					);
				if (DOM.trackABack)
					DOM.trackABack.addEventListener('click', () => {
						if (trackAPlayer && trackAPlayer.previousVideo) {
							trackAPlayer.previousVideo();
						}
					});
				if (DOM.trackAPause)
					DOM.trackAPause.addEventListener(
						'click',
						() => trackAPlayer && trackAPlayer.pauseVideo()
					);
				if (DOM.trackAForward)
					DOM.trackAForward.addEventListener('click', () => {
						if (trackAPlayer && trackAPlayer.nextVideo) {
							trackAPlayer.nextVideo();
						}
					});
				if (DOM.trackAStop)
					DOM.trackAStop.addEventListener(
						'click',
						() => trackAPlayer && trackAPlayer.stopVideo()
					);
				if (DOM.trackAMute)
					['click','touchstart'].forEach(ev => DOM.trackAMute.addEventListener(ev, () => {
					    if (djCtx && djCtx.state == "suspended") djCtx.resume();
					    if (!trackAPlayer) return;
					    if (trackAPlayer.isMuted()) {
					    trackAPlayer.unMute();
					    DOM.trackAMute.textContent = 'Mute';
					    } else {
					    trackAPlayer.mute();
					    DOM.trackAMute.textContent = 'Unmute';
					    }
					}));
				if (DOM.trackAVolume)
					DOM.trackAVolume.addEventListener(
						'input',
						(e) => trackAPlayer && trackAPlayer.setVolume(e.target.value)
					);
				if (DOM.trackBPlay)
					DOM.trackBPlay.addEventListener(
						'click',
						() => trackBPlayer && trackBPlayer.playVideo()
					);
				if (DOM.trackBBack)
					DOM.trackBBack.addEventListener('click', () => {
						if (trackBPlayer && trackBPlayer.previousVideo) {
							trackBPlayer.previousVideo();
						}
					});
				if (DOM.trackBPause)
					DOM.trackBPause.addEventListener(
						'click',
						() => trackBPlayer && trackBPlayer.pauseVideo()
					);
				if (DOM.trackBForward)
					DOM.trackBForward.addEventListener('click', () => {
						if (trackBPlayer && trackBPlayer.nextVideo) {
							trackBPlayer.nextVideo();
						}
					});
				if (DOM.trackBStop)
					DOM.trackBStop.addEventListener(
						'click',
						() => trackBPlayer && trackBPlayer.stopVideo()
					);
				if (DOM.trackBMute)
					['click','touchstart'].forEach(ev => DOM.trackBMute.addEventListener(ev, () => {
					    if (djCtx && djCtx.state == "suspended") djCtx.resume();
					    if (!trackBPlayer) return;
					    if (trackBPlayer.isMuted()) {
					    trackBPlayer.unMute();
					    DOM.trackBMute.textContent = 'Mute';
					    } else {
					    trackBPlayer.mute();
					    DOM.trackBMute.textContent = 'Unmute';
					    }
					}));
				if (DOM.trackBVolume)
					DOM.trackBVolume.addEventListener(
						'input',
						(e) => trackBPlayer && trackBPlayer.setVolume(e.target.value)
					);

				if (DOM.djDockBtn) {
					DOM.djDockBtn.addEventListener('click', () => {
						const url = window.location.pathname + '?dj=1';
						window.open(url, 'djWindow', 'width=800,height=600');
					});
				}

				if (DOM.crossfader) {
					DOM.crossfader.addEventListener('input', () => {
						if (djCtx && djCtx.state === 'suspended') djCtx.resume();
						const val = parseFloat(DOM.crossfader.value);
						if (gainA && gainB) {
							gainA.gain.value = 1 - val;
							gainB.gain.value = val;
							if (dest) {
								try {
									gainA.disconnect(dest);
								} catch {}
								try {
									gainB.disconnect(dest);
								} catch {}
								gainA.connect(dest);
								gainB.connect(dest);
							}
						}
					});
				}

				if (DOM.djPlayBtn) {
					DOM.djPlayBtn.addEventListener('click', () => {
						trackAPlayer && trackAPlayer.playVideo();
						trackBPlayer && trackBPlayer.playVideo();
					});
				}

				if (DOM.djStopBtn) {
					DOM.djStopBtn.addEventListener('click', () => {
						trackAPlayer && trackAPlayer.pauseVideo();
						trackBPlayer && trackBPlayer.pauseVideo();
					});
				}

                                if (DOM.djDeactivateBtn) {
                                        ['click','touchstart'].forEach(ev => DOM.djDeactivateBtn.addEventListener(ev, () => {
                                                trackAPlayer && trackAPlayer.pauseVideo();
                                                trackBPlayer && trackBPlayer.pauseVideo();
                                                if (bgMusicPlayer && bgMusicPlayer.pauseVideo)
                                                        bgMusicPlayer.pauseVideo();
                                                document.querySelectorAll('video').forEach((v) => v.pause());
                                                DOM.djDashboard.classList.add('locked');
                                                if (DOM.djOverlay) {
                                                        DOM.djOverlay.style.display = 'flex';
                                                        DOM.djOverlay.classList.remove('fade-out');
                                                        setupDjOverlay();
                                                }
                                        }));
                                }

				if (DOM.djShuffleBtn) {
					DOM.djShuffleBtn.addEventListener('click', () => {
						trackAPlayer && trackAPlayer.nextVideo();
						trackBPlayer && trackBPlayer.nextVideo();
					});
				}

				if (DOM.vinylA) {
					DOM.vinylA.addEventListener('click', () => scratch(trackAPlayer));
				}
				if (DOM.vinylB) {
					DOM.vinylB.addEventListener('click', () => scratch(trackBPlayer));
				}

				if (DOM.delayKnob) {
					DOM.delayKnob.addEventListener('input', () => {
						const v = parseFloat(DOM.delayKnob.value);
						if (delayNodeA) delayNodeA.delayTime.value = v;
						if (delayNodeB) delayNodeB.delayTime.value = v;
					});
				}

				if (DOM.reverbKnob) {
					DOM.reverbKnob.addEventListener('input', () => {
						const v = parseFloat(DOM.reverbKnob.value);
						if (reverbNodeA) reverbNodeA.buffer = createImpulse(v * 2, 2);
						if (reverbNodeB) reverbNodeB.buffer = createImpulse(v * 2, 2);
					});
				}

				if (DOM.decimateKnob) {
					DOM.decimateKnob.addEventListener('input', () => {
						const v = parseFloat(DOM.decimateKnob.value);
						const bits = Math.max(1, Math.round(v * 8));
						if (bitcrusherNode)
							bitcrusherNode.curve = createBitcrusherCurve(bits);
						if (bitcrusherNodeA)
							bitcrusherNodeA.curve = createBitcrusherCurve(bits);
						if (bitcrusherNodeB)
							bitcrusherNodeB.curve = createBitcrusherCurve(bits);
					});
				}

				if (DOM.lofiKnob) {
					DOM.lofiKnob.addEventListener('input', () => {
						const v = parseFloat(DOM.lofiKnob.value);
						const freq = 500 + (1 - v) * 5000;
						if (filterNode) filterNode.frequency.value = freq;
						if (filterNodeA) filterNodeA.frequency.value = freq;
						if (filterNodeB) filterNodeB.frequency.value = freq;
					});
				}

				if (DOM.repeatKnob) {
					DOM.repeatKnob.addEventListener('input', () => {
						const v = parseFloat(DOM.repeatKnob.value);
						if (delayNode) delayNode.delayTime.value = v;
					});
				}

				if (DOM.autoBlendBtn) {
					DOM.autoBlendBtn.addEventListener('click', () => {
						if (autoBlendInterval) {
							clearInterval(autoBlendInterval);
							autoBlendInterval = null;
							DOM.autoBlendBtn.classList.remove('active');
							return;
						}
						DOM.autoBlendBtn.classList.add('active');
						let dir = 1;
						autoBlendInterval = setInterval(() => {
							let v = parseFloat(DOM.crossfader.value);
							v += 0.01 * dir;
							if (v >= 1 || v <= 0) dir *= -1;
							DOM.crossfader.value = Math.min(1, Math.max(0, v));
							DOM.crossfader.dispatchEvent(new Event('input'));
						}, 50);
					});
				}

				if (DOM.recordMixBtn) {
					DOM.recordMixBtn.addEventListener('click', () => {
						if (!djCtx || !dest) return;
						if (recorder?.state === 'recording') {
							recorder.stop();
							DOM.recordMixBtn.textContent = 'Record';
							DOM.recordMixBtn.classList.remove('active');
						} else {
							chunks = [];
							recorder.start();
							DOM.recordMixBtn.textContent = 'Stop Recording';
							DOM.recordMixBtn.classList.add('active');
						}
					});
				}
				if (DOM.downloadMixBtn) {
					DOM.downloadMixBtn.addEventListener('click', () => {
						DOM.downloadMixBtn.style.display = 'none';
					});
				}

				function drawBtcAudio() {
					if (!analyser || !DOM.audioCanvas) return;
					const ctx = DOM.audioCanvas.getContext('2d');
					const buffer = new Uint8Array(analyser.fftSize);
					const draw = () => {
						analyser.getByteTimeDomainData(buffer);
						ctx.clearRect(0, 0, DOM.audioCanvas.width, DOM.audioCanvas.height);
                                                ctx.strokeStyle = 'var(--primary-color)';
						ctx.beginPath();
						const step = DOM.audioCanvas.width / buffer.length;
						for (let i = 0; i < buffer.length; i++) {
							const v = buffer[i] / 128.0;
							const y = (v * DOM.audioCanvas.height) / 2;
							if (i === 0) ctx.moveTo(0, y);
							else ctx.lineTo(i * step, y);
						}
						ctx.stroke();
						requestAnimationFrame(draw);
					};
					draw();
				}

				let btcScene, btcCamera, btcRenderer, btcDots, btcVolumeBar;

				function initBtcOverlay() {
					if (!DOM.btcCanvas) return;
					btcScene = new THREE.Scene();
					btcCamera = new THREE.PerspectiveCamera(
						75,
						DOM.btcCanvas.clientWidth / DOM.btcCanvas.clientHeight,
						0.1,
						1000
					);
					btcCamera.position.z = 5;
					btcRenderer = new THREE.WebGLRenderer({
						canvas: DOM.btcCanvas,
						alpha: true
					});
					btcRenderer.setSize(
						DOM.btcCanvas.clientWidth,
						DOM.btcCanvas.clientHeight
					);

					const geometry = new THREE.BufferGeometry();
					const verts = [];
					for (let i = 0; i < 500; i++) {
						verts.push(
							(Math.random() - 0.5) * 10,
							(Math.random() - 0.5) * 10,
							(Math.random() - 0.5) * 10
						);
					}
					geometry.setAttribute(
						'position',
						new THREE.Float32BufferAttribute(verts, 3)
					);
					const material = new THREE.PointsMaterial({
						color: 0x87ceeb,
						size: 0.1,
						transparent: true,
						opacity: 0.3
					});
					btcDots = new THREE.Points(geometry, material);
					btcScene.add(btcDots);
					const barGeo = new THREE.BufferGeometry().setFromPoints([
						new THREE.Vector3(0, 0, 0),
						new THREE.Vector3(0, 1, 0)
					]);
					const barMat = new THREE.LineBasicMaterial({
						color: 0xff0000,
						transparent: true,
						opacity: 0.7
					});
					btcVolumeBar = new THREE.Line(barGeo, barMat);
					btcVolumeBar.visible = volumeBarsEnabled;
					btcScene.add(btcVolumeBar);

					animateBtcOverlay();
				}

				const bufferLength = 2048;
				const dataArray = new Float32Array(bufferLength);
				function getVolume() {
					if (!analyser) return 0;
					analyser.getFloatTimeDomainData(dataArray);
					let sum = 0;
					for (let i = 0; i < bufferLength; i++)
						sum += dataArray[i] * dataArray[i];
					return Math.sqrt(sum / bufferLength);
				}

				function animateBtcOverlay() {
					requestAnimationFrame(animateBtcOverlay);
					const vol = getVolume();
					if (btcDots) {
						btcDots.position.y = vol * 10;
						btcDots.scale.y = 1 + vol * 5;
						btcDots.material.opacity = 0.2 + vol * 0.3;
					}
					if (btcVolumeBar) {
						btcVolumeBar.visible = volumeBarsEnabled;
						btcVolumeBar.scale.y = vol * 20;
						btcVolumeBar.rotation.y += 0.01;
					}
					if (btcRenderer && btcScene && btcCamera)
						btcRenderer.render(btcScene, btcCamera);
				}

				function applyTheme(theme) {
					if (!btcDots) return;
					const colors = themes[theme] || themes.original;
					btcDots.material.color.set(colors[0]);
				}

				if (DOM.surroundToggleBtn) {
					DOM.surroundToggleBtn.addEventListener('click', () => {
						if (!djCtx) return;
						const panner = djCtx.createPanner();
						panner.panningModel = 'HRTF';
						gainA.disconnect();
						gainB.disconnect();
						gainA.connect(panner);
						gainB.connect(panner);
						panner.connect(djCtx.destination);
						DOM.surroundToggleBtn.classList.toggle('active');
					});
				}

				if (DOM.hashLogToggleBtn) {
					DOM.hashLogToggleBtn.addEventListener('click', () => {
						const log = document.getElementById('btc-hash-log');
						if (log) {
							const hidden = log.classList.toggle('hidden');
							DOM.hashLogToggleBtn.textContent = hidden
								? 'Show Log'
								: 'Hide Log';
						}
					});
				}

				if (DOM.legendToggleBtn) {
					DOM.legendToggleBtn.addEventListener('click', () => {
						const legend = document.getElementById('btc-legend-explanation');
						if (legend) {
							const hidden = legend.classList.toggle('hidden');
							DOM.legendToggleBtn.textContent = hidden
								? 'Show Legend'
								: 'Hide Legend';
						}
					});
				}

                                if (DOM.skipIntroBtn) {
                                        DOM.skipIntroBtn.addEventListener('click', () => {
                                                introPlayed = true;
                                                localStorage.setItem('introPlayed', '1');
                                                hideLoadingScreen();
                                        });
                                }

				if (DOM.introVideo) {
					const introLogo = document.querySelector(
						'#loading-screen .metrics-overlay .logo'
					);
					DOM.introVideo.addEventListener('play', () =>
						introLogo?.classList.add('pulse')
					);
					DOM.introVideo.addEventListener('pause', () =>
						introLogo?.classList.remove('pulse')
					);
				}

				const welcome = document.createElement('li');
				welcome.className = 'p-2 rounded';
				welcome.innerHTML =
					'<div>QuantGpt: Welcome to QuantumI! Ask me for insights.<br><span class="text-xs opacity-70">QuantGPT is a resource, not a financial advisor. Always conduct your own research.</span></div>';
				DOM.chatList.appendChild(welcome);

                               initBtcOverlay();
                               applyTheme(currentTheme);
                                if (DOM.btcOverlayMode)
                                        DOM.btcOverlayMode.textContent =
                                                currentTheme === 'heatmap'
                                                        ? 'Heat Map'
                                                        : currentTheme === 'lifecycle'
                                                        ? 'Life Cycle'
                                                        : 'Original';

				setInterval(updateBTCHash, 60000);
				setInterval(() => {
					updateVinyl('A');
					updateVinyl('B');
				}, 1000);

				DOM.toggleIndicatorHeaderBtn.addEventListener('click', () => {
					isIndicatorEnabledHeader = !isIndicatorEnabledHeader;
					DOM.toggleIndicatorHeaderBtn.textContent = `${isIndicatorEnabledHeader ? 'Disable' : 'Enable'} Indicator`;
					const symbol = document
						.getElementById('chart-title-header')
						.getAttribute('data-symbol');
					const interval = document
						.querySelector('#header-timeframe-1d')
						.getAttribute('data-interval');
					initializeChart('chart-container-header', symbol, interval);
				});

				DOM.toggleIndicatorModalBtn.addEventListener('click', () => {
					isIndicatorEnabledModal = !isIndicatorEnabledModal;
					DOM.toggleIndicatorModalBtn.textContent = `${isIndicatorEnabledModal ? 'Disable' : 'Enable'} Indicator`;
					const symbol = document
						.getElementById('chart-title-modal')
						.getAttribute('data-symbol');
					const interval = document
						.querySelector('#modal-timeframe-1d')
						.getAttribute('data-interval');
					initializeChart('chart-container-modal', symbol, interval);
				});

				const timeframes = ['1min', '5min', '15min', '1hr', '1d'];
				timeframes.forEach((tf) => {
					const headerBtn = document.getElementById(`header-timeframe-${tf}`);
					const modalBtn = document.getElementById(`modal-timeframe-${tf}`);
					const interval = headerBtn?.dataset.interval;

					if (headerBtn) {
						headerBtn.addEventListener('click', () => {
							document
								.querySelectorAll(
									'#header-timeframe-' +
										timeframes.map((t) => `#header-timeframe-${t}`).join(',')
								)
								.forEach((btn) => btn.classList.remove('active'));
							headerBtn.classList.add('active');
							const symbol = document
								.getElementById('chart-title-header')
								.getAttribute('data-symbol');
							initializeChart('chart-container-header', symbol, interval);
						});
					}
					if (modalBtn) {
						modalBtn.addEventListener('click', () => {
							document
								.querySelectorAll(
									'#modal-timeframe-' +
										timeframes.map((t) => `#modal-timeframe-${t}`).join(',')
								)
								.forEach((btn) => btn.classList.remove('active'));
							modalBtn.classList.add('active');
							const symbol = document
								.getElementById('chart-title-modal')
								.getAttribute('data-symbol');
							initializeChart('chart-container-modal', symbol, interval);
						});
					}
				});

				DOM.tokenList.addEventListener('click', (e) => {
					const cmcBtn = e.target.closest('.cmc-link');
					if (cmcBtn) {
						e.stopPropagation();
						const cmc = cmcBtn.getAttribute('data-cmc');
						window.open(
							`https://coinmarketcap.com/currencies/${cmc}/`,
							'_blank'
						);
						return;
					}

					const li = e.target.closest('li');
					if (li && li.dataset.symbol) {
						const symbol = li.dataset.symbol;
						const interval = document
							.querySelector('#header-timeframe-1d')
							.getAttribute('data-interval');
						initializeChart('chart-container-header', symbol, interval);
						initializeChart('chart-container-modal', symbol, interval);
						document
							.getElementById('chart-title-header')
							.setAttribute('data-symbol', symbol);
						document.getElementById('chart-title-header').textContent = symbol;
						document
							.getElementById('chart-title-modal')
							.setAttribute('data-symbol', symbol);
						document.getElementById('chart-title-modal').textContent = symbol;
						document
							.querySelectorAll('#token-list li')
							.forEach((item) => item.classList.remove('selected-token'));
						li.classList.add('selected-token');
						console.log(`Switched to token: ${symbol}`);
					}
				});

				DOM.toggleStickyHeader.addEventListener('click', () => {
					DOM.chartModal.classList.add('active');
					DOM.toggleStickyHeader.textContent = 'Chart Docked';
					setTimeout(
						() => (DOM.toggleStickyHeader.textContent = 'Dock Chart'),
						1000
					);
					const symbol = document
						.getElementById('chart-title-header')
						.getAttribute('data-symbol');
					const interval = document
						.querySelector('#header-timeframe-1d')
						.getAttribute('data-interval');
					initializeChart('chart-container-modal', symbol, interval);
				});

				DOM.toggleStickyModal.addEventListener('click', () => {
					DOM.chartModal.classList.remove('active');
					DOM.toggleStickyModal.textContent = 'Chart Undocked';
					setTimeout(
						() => (DOM.toggleStickyModal.textContent = 'Undock Chart'),
						1000
					);
					const symbol = document
						.getElementById('chart-title-modal')
						.getAttribute('data-symbol');
					const interval = document
						.querySelector('#modal-timeframe-1d')
						.getAttribute('data-interval');
					initializeChart('chart-container-header', symbol, interval);
				});

				DOM.toggleBackgroundBtn.addEventListener('click', () => {
					DOM.splineModal.classList.add('active');
				});

				DOM.toggleBackgroundDockBtn.addEventListener('click', () => {
					const splineBg = document.getElementById('spline-bg');
					splineBg.classList.toggle('hidden');
					const isHidden = splineBg.classList.contains('hidden');
					DOM.toggleBackgroundDockBtn.textContent = isHidden
						? 'Turn On Background'
						: 'Turn Off Background';
					DOM.toggleBackgroundDockBtn.setAttribute(
						'aria-label',
						isHidden ? 'Turn on background' : 'Turn off background'
					);
					DOM.toggleBackgroundDockBtn.setAttribute(
						'data-tooltip',
						isHidden
							? 'Turn on background'
							: 'Turn off background to speed up the site'
					);
					const bgWarn = document.getElementById('background-warning');
					if (bgWarn) bgWarn.style.display = isHidden ? 'none' : 'block';
				});

                               DOM.splineModalCloseBtn.addEventListener('click', () => {
                                       DOM.splineModal.classList.remove('active');
                               });

                                document.querySelectorAll('.nft-item iframe').forEach((frame) => {
                                        frame.addEventListener('click', () => {
                                                DOM.nftModalFrame.src = frame.src;
                                                DOM.nftModal.classList.add('active');
                                        });
                                });

                                DOM.nftModalCloseBtn.addEventListener('click', () => {
                                        DOM.nftModal.classList.remove('active');
                                        DOM.nftModalFrame.src = '';
                                });

                                DOM.nftModal.addEventListener('click', (e) => {
                                        if (e.target === DOM.nftModal) {
                                                DOM.nftModal.classList.remove('active');
                                                DOM.nftModalFrame.src = '';
                                        }
                                });

                                if (DOM.raribleDockBtn) {
                                        const raribleContent = DOM.raribleModal.querySelector('.rarible-modal-content');
                                        DOM.raribleDockBtn.addEventListener('click', () => {
                                                if (!raribleOriginalParent) {
                                                        raribleOriginalParent = DOM.raribleContainer.parentElement;
                                                }
                                                DOM.raribleContainer.classList.add('docked');
                                                raribleContent.appendChild(DOM.raribleContainer);
                                                DOM.raribleModal.classList.add('active');
                                        });
                                        DOM.raribleModalCloseBtn.addEventListener('click', () => {
                                                if (raribleOriginalParent) {
                                                        raribleOriginalParent.appendChild(DOM.raribleContainer);
                                                }
                                                DOM.raribleContainer.classList.remove('docked');
                                                DOM.raribleModal.classList.remove('active');
                                        });
                                        DOM.raribleModal.addEventListener('click', (ev) => {
                                                if (ev.target === DOM.raribleModal) DOM.raribleModalCloseBtn.click();
                                        });
                                        DOM.raribleContainer.querySelectorAll('iframe').forEach((frame) => {
                                                frame.addEventListener('mouseenter', () => {
                                                        if (!frame.dataset.autoplay) {
                                                                frame.dataset.autoplay = '1';
                                                                try {
                                                                        const u = new URL(frame.src);
                                                                        if (!u.searchParams.get('autoplay')) {
                                                                                u.searchParams.set('autoplay', '1');
                                                                                frame.src = u.toString();
                                                                        }
                                                                } catch {}
                                                        }
                                                });
                                        });
                                }

				DOM.undockBackgroundLink.addEventListener('click', (e) => {
					e.preventDefault();
					DOM.splineModal.classList.remove('active');
					DOM.navMenu.classList.remove('active');
				});

                               DOM.splineFullscreenBtn.addEventListener('click', () => {
                                       const splineModalContent = document.querySelector(
                                               '.spline-modal-content'
                                       );
                                       if (!document.fullscreenElement) {
                                               if (splineModalContent.requestFullscreen)
                                                       splineModalContent.requestFullscreen();
                                               else if (splineModalContent.mozRequestFullScreen)
                                                       splineModalContent.mozRequestFullScreen();
                                               else if (splineModalContent.webkitRequestFullscreen)
                                                       splineModalContent.webkitRequestFullscreen();
                                               else if (splineModalContent.msRequestFullscreen)
                                                       splineModalContent.msRequestFullscreen();
                                       } else {
                                               if (document.exitFullscreen) document.exitFullscreen();
                                               else if (document.mozCancelFullScreen)
                                                       document.mozCancelFullScreen();
                                               else if (document.webkitExitFullscreen)
                                                       document.webkitExitFullscreen();
                                               else if (document.msExitFullscreen) document.msExitFullscreen();
                                       }
                               });

                               if (DOM.btcFullscreenBtn) {
                                       DOM.btcFullscreenBtn.addEventListener('click', () => {
                                               const btcCanvas = document.getElementById('btc-hash-canvas');
                                               if (!document.fullscreenElement) {
                                                       if (btcCanvas.requestFullscreen) btcCanvas.requestFullscreen();
                                                       else if (btcCanvas.mozRequestFullScreen) btcCanvas.mozRequestFullScreen();
                                                       else if (btcCanvas.webkitRequestFullscreen) btcCanvas.webkitRequestFullscreen();
                                                       else if (btcCanvas.msRequestFullscreen) btcCanvas.msRequestFullscreen();
                                               } else {
                                                       if (document.exitFullscreen) document.exitFullscreen();
                                                       else if (document.mozCancelFullScreen) document.mozCancelFullScreen();
                                                       else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
                                                       else if (document.msExitFullscreen) document.msExitFullscreen();
                                               }
                                       });
                               }

                                const handleFullscreenChange = () => {
                                        const label = document.fullscreenElement ? 'Exit Fullscreen' : 'Fullscreen';
                                        if (DOM.splineFullscreenBtn) DOM.splineFullscreenBtn.textContent = label;
                                        if (DOM.btcFullscreenBtn) DOM.btcFullscreenBtn.textContent = label;
                                };
				document.addEventListener('fullscreenchange', handleFullscreenChange);
				document.addEventListener(
					'mozfullscreenchange',
					handleFullscreenChange
				);
				document.addEventListener(
					'webkitfullscreenchange',
					handleFullscreenChange
				);
				document.addEventListener('msfullscreenchange', handleFullscreenChange);

				DOM.chatSendBtn.addEventListener('click', async () => {
					const input = sanitizeInput(DOM.chatInput.value);
					if (!input) return;
					const userMessage = document.createElement('li');
					userMessage.className = 'p-2 rounded';
					userMessage.innerHTML = `<div>User: ${input}</div>`;
					DOM.chatList.appendChild(userMessage);

					const lower = input.toLowerCase();
					let quickAnswer = '';
					if (tokensData.length) {
						const sorted = [...tokensData].sort(
							(a, b) =>
								b.price_change_percentage_24h - a.price_change_percentage_24h
						);
						if (lower.includes('top') && lower.includes('winner')) {
							const t = sorted[0];
							quickAnswer = `The top performer today is ${t.name} (${t.symbol}) up ${t.price_change_percentage_24h.toFixed(2)}%.`;
						} else if (lower.includes('top') && lower.includes('loser')) {
							const t = sorted[sorted.length - 1];
							quickAnswer = `The biggest loser today is ${t.name} (${t.symbol}) down ${t.price_change_percentage_24h.toFixed(2)}%.`;
						}
					}

					if (!quickAnswer) {
						const lowerSite = lower;
						if (lowerSite.includes('dj section')) {
							quickAnswer =
								'The DJ section lets you mix YouTube tracks, apply effects, and record the output.';
						} else if (lowerSite.includes('connect wallet')) {
							quickAnswer =
								'Use the Connect Wallet button in the Wallet Log module to link MetaMask.';
						}
					}

					const disclaimer =
						'<span class="text-xs opacity-70">QuantGPT is a resource, not a financial advisor. Always conduct your own research.</span>';

					if (quickAnswer) {
						const botMessage = document.createElement('li');
						botMessage.className = 'p-2 rounded';
						botMessage.innerHTML = `<div>QuantGpt: ${quickAnswer}<br>${disclaimer}</div>`;
						DOM.chatList.appendChild(botMessage);
						DOM.chatList.scrollTop = DOM.chatList.scrollHeight;
					} else {
						try {
							const response = await fetch('https://x.ai/api/grok', {
								method: 'POST',
								headers: { 'Content-Type': 'application/json' },
								body: JSON.stringify({ query: input })
							});
							if (!response.ok) throw new Error('ChatGPT API request failed');
							const data = await response.json();
							const botMessage = document.createElement('li');
							botMessage.className = 'p-2 rounded';
							botMessage.innerHTML = `<div>QuantGpt: ${data.response || 'No response received'}<br>${disclaimer}</div>`;
							DOM.chatList.appendChild(botMessage);
							DOM.chatList.scrollTop = DOM.chatList.scrollHeight;
						} catch (error) {
							console.error('ChatGPT API error:', error);
                                                        const errorMessage = document.createElement('li');
                                                        errorMessage.className = 'p-2 rounded text-red-400';
							errorMessage.innerHTML = `<div>QuantGpt: Error processing request - ${error.message}<br>${disclaimer}</div>`;
							DOM.chatList.appendChild(errorMessage);
						}
					}
					DOM.chatInput.value = '';
					DOM.loaderChat.style.display = 'none';
				});

				DOM.exportTokensBtn.addEventListener('click', () => {
					exportToCSV(tokensData, 'tokens_data.csv');
				});

				DOM.exportGasBtn.addEventListener('click', () => {
					exportToCSV(gasHistory, 'gas_data.csv');
				});

                               DOM.exportObjBtn.addEventListener('click', () => {
                                       const exportGroup = new THREE.Group();
                                       dotClouds.forEach((cloud) => exportGroup.add(cloud.clone()));
                                       const exporter = new THREE.OBJExporter();
                                       const result = exporter.parse(exportGroup);
                                       const blob = new Blob([result], { type: 'text/plain' });
                                       const link = document.createElement('a');
                                       link.href = URL.createObjectURL(blob);
                                       link.download = 'btc_hash_visualization.obj';
                                       link.click();
                                       addSystemLog('Exported BTC Hash Visualization as OBJ');
                               });

                               if (DOM.exportFbxBtn) {
                                       DOM.exportFbxBtn.addEventListener('click', () => {
                                               const exportGroup = new THREE.Group();
                                               dotClouds.forEach((cloud) => exportGroup.add(cloud.clone()));
                                               const exporter = new THREE.FBXExporter();
                                               const result = exporter.parse(exportGroup);
                                               const blob = new Blob([result], { type: 'text/plain' });
                                               const link = document.createElement('a');
                                               link.href = URL.createObjectURL(blob);
                                               link.download = 'btc_hash_visualization.fbx';
                                               link.click();
                                               addSystemLog('Exported BTC Hash Visualization as FBX');
                                       });
                               }

                                if (DOM.btcThemeSelect) {
                                        DOM.btcThemeSelect.value = currentTheme;
                                        DOM.btcThemeSelect.addEventListener('change', (e) =>
                                                setTheme(e.target.value)
                                        );
                                }

				let zoomDirection = 0;
				let zoomSpeed = 0;
				const maxZoom = 20;
				const basePos = new THREE.Vector3(0, 0, 1);
				let autoReturn = false;
				let returnStart = null;
				let returnFrom = null;
				const returnDuration = 1.5;
				function zoomLoop() {
					if (zoomDirection !== 0 && camera) {
						zoomSpeed = Math.min(zoomSpeed + 0.0008, 0.04);
						const factor = zoomDirection > 0 ? 1 - zoomSpeed : 1 + zoomSpeed;
						camera.position.multiplyScalar(factor);
						if (camera.position.length() > maxZoom) {
							camera.position.setLength(maxZoom);
						}
						controls.update();
					} else if (autoReturn && camera) {
						const elapsed = (Date.now() - returnStart) / 1000;
						const progress = Math.min(elapsed / returnDuration, 1);
						camera.position.lerpVectors(returnFrom, basePos, progress);
						const bounce = 1 + 0.05 * Math.sin(progress * Math.PI);
						camera.position.multiplyScalar(bounce);
						if (progress >= 1) {
							camera.position.copy(basePos);
							autoReturn = false;
						}
					} else {
						zoomSpeed = 0;
					}
					if (camera && DOM.cameraPos) {
						DOM.cameraPos.textContent = `Pos: ${camera.position.x.toFixed(2)},${camera.position.y.toFixed(2)},${camera.position.z.toFixed(2)}`;
					}
					requestAnimationFrame(zoomLoop);
				}
				zoomLoop();
				['mousedown', 'touchstart'].forEach((ev) => {
					DOM.zoomInBtn.addEventListener(ev, () => {
						zoomDirection = 1;
					});
					DOM.zoomOutBtn.addEventListener(ev, () => {
						zoomDirection = -1;
					});
				});
				['mouseup', 'mouseleave', 'touchend'].forEach((ev) => {
					DOM.zoomInBtn.addEventListener(ev, () => {
						zoomDirection = 0;
						autoReturn = true;
						returnStart = Date.now();
						returnFrom = camera.position.clone();
					});
					DOM.zoomOutBtn.addEventListener(ev, () => {
						zoomDirection = 0;
						autoReturn = true;
						returnStart = Date.now();
						returnFrom = camera.position.clone();
					});
				});

				if (DOM.zoomZ0Btn) {
					DOM.zoomZ0Btn.addEventListener('click', () => {
						camera.position.set(0, 0, 1);
						autoReturn = false;
						controls.update();
					});
				}
				if (DOM.zoomZ1Btn) {
					DOM.zoomZ1Btn.addEventListener('click', () => {
						camera.position.set(0, 0, maxZoom / 2);
						autoReturn = false;
						controls.update();
					});
				}
				if (DOM.zoomZ2Btn) {
					DOM.zoomZ2Btn.addEventListener('click', () => {
						camera.position.set(0, 0, maxZoom);
						autoReturn = false;
						controls.update();
					});
				}

				DOM.exportHashLogBtn.addEventListener('click', () => {
					exportToCSV(hashLog, 'hash_log.csv');
				});

				DOM.exportBalancesBtn.addEventListener('click', () => {
					exportToCSV(balancesData, 'balances_data.csv');
				});


                                const observer = new IntersectionObserver(
                                        (entries) => {
                                                entries.forEach((entry) => {
                                                        if (!entry.isIntersecting) return;
                                                        if (entry.target.id === 'spline-bg') {
                                                                entry.target
                                                                        .querySelector('spline-viewer')
                                                                        .load(
                                                                                'https://prod.spline.design/fJRTSatt5qGHtFUW/scene.splinecode'
                                                                        );
                                                                observer.unobserve(entry.target);
                                                        } else if (entry.target.id === 'twitter-timeline') {
                                                                loadTwitterTimeline();
                                                                observer.unobserve(entry.target);
                                                        } else if (entry.target.id === 'rarible-container') {
                                                                entry.target
                                                                        .querySelectorAll('iframe[data-src]')
                                                                        .forEach((f) => {
                                                                                if (!f.src) f.src = f.dataset.src;
                                                                        });
                                                                if (DOM.raribleLoader) DOM.raribleLoader.style.display = 'none';
                                                                entry.target.style.display = 'block';
                                                                observer.unobserve(entry.target);
                                                        }
                                                });
                                        },
                                        { threshold: 0.1 }
                                );

                                observer.observe(document.getElementById('spline-bg'));
                                if (DOM.twitterTimeline) observer.observe(DOM.twitterTimeline);
                                if (DOM.raribleContainer) observer.observe(DOM.raribleContainer);

                                const scrollObserver = new IntersectionObserver(
                                        (entries) => {
                                                entries.forEach((entry) => {
                                                        if (entry.isIntersecting) {
                                                                entry.target.classList.add('in-view');
                                                                scrollObserver.unobserve(entry.target);
                                                        }
                                                });
                                        },
                                        { threshold: 0.1 }
                                );
                                document.querySelectorAll('#module-grid section').forEach((sec) => {
                                        sec.classList.add('scroll-module');
                                        scrollObserver.observe(sec);
                                });
			});
		</script>
		<script>
			// === Live Logs ===
			async function loadLiveLogs() {
				try {
                                const res = await fetch('/api/live-logs');
					const data = await res.json();
					const logList = document.getElementById('live-logs-list');
					if (!logList) return;
					logList.innerHTML = '';
					const seen = new Set();
					data.logs.forEach((log) => {
						const text = `[${log.timestamp}] ${log.message}`;
						if (!seen.has(text)) {
							seen.add(text);
							const li = document.createElement('li');
							li.textContent = text;
							logList.appendChild(li);
						}
					});
				} catch (e) {
					console.error('Live logs error', e);
				}
			}
			window.addEventListener('load', () => {
				loadLiveLogs();
				setInterval(loadLiveLogs, 15000);
			});

			// === GPT Chat ===
			document
				.getElementById('chat-send')
				?.addEventListener('click', async () => {
					const input = document.getElementById('chat-input');
					const chat = document.getElementById('chat-list');
					const msg = input.value.trim();
					if (!msg) return;
                                        chat.innerHTML += `<div class='text-xs text-green-300'>You: ${msg}</div>`;
					input.value = '';
					const res = await fetch('/api/grok', {
						method: 'POST',
						headers: { 'Content-Type': 'application/json' },
						body: JSON.stringify({ prompt: msg })
					});
					const data = await res.json();
					chat.innerHTML += `<div class='text-xs text-green-300'>GPT: ${data.response}</div>`;
				});
		</script>
		<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
		<script>
			let walletAddress = null;
			let balanceVisible = true;
			let addressVisible = false;

			function displayWalletAddress(addr) {
				const el = document.getElementById('wallet-address');
				if (!addr) {
					el.innerText = 'Not connected';
					return;
				}
				el.dataset.full = addr;
				el.innerText = addressVisible ? addr : `****${addr.slice(-4)}`;
			}

			const savedWallet = localStorage.getItem('walletAddress');
			if (savedWallet) {
				walletAddress = savedWallet;
				document.addEventListener('DOMContentLoaded', () => {
					displayWalletAddress(walletAddress);
					refreshWalletData();
					trackWalletTransactions(walletAddress);
				});
			}

			async function connectWallet() {
				if (typeof window.ethereum === 'undefined') {
					if (/Mobi|Android/i.test(navigator.userAgent)) {
						window.location.href =
							'https://metamask.app.link/dapp/' +
							location.href.replace(/^https?:\/\//, '');
					} else {
						alert('MetaMask not detected');
					}
					return;
				}
				try {
					const provider = new ethers.providers.Web3Provider(window.ethereum);
					await provider.send('eth_requestAccounts', []);
					const signer = provider.getSigner();
					walletAddress = await signer.getAddress();
					displayWalletAddress(walletAddress);
					localStorage.setItem('walletAddress', walletAddress);
					await refreshWalletData();
					trackWalletTransactions(walletAddress);
				} catch (err) {
					console.error('Wallet connection failed:', err);
				}
			}

			async function refreshWalletData() {
				if (!walletAddress) {
                                        document.getElementById('balances-list').innerHTML =
                                                '<li>Connect wallet first</li>';
					return;
				}
				try {
					const balRes = await fetch(
						`https://api.etherscan.io/api?module=account&action=balance&address=${walletAddress}&tag=latest&apikey=${API_KEY}`
					);
					const balJson = await balRes.json();
					const ethBal = parseFloat(balJson.result) / 1e18;
					const balanceTxt = ethBal.toFixed(4) + ' ETH';
					const balEl = document.getElementById('wallet-balance');
					balEl.dataset.full = balanceTxt;
					balEl.innerText = balanceVisible ? balanceTxt : '****';

					const tokens = [
						{
							addr: '0xA0b86991c6218b36c1d19d4a2e9eb0ce3606eb48',
							symbol: 'USDC'
						},
						{
							addr: '0x6B175474E89094C44Da98b954EedeAC495271d0F',
							symbol: 'DAI'
						}
					];
					const holdings = [];
					for (const t of tokens) {
						const r = await fetch(
							`https://api.etherscan.io/api?module=account&action=tokenbalance&address=${walletAddress}&contractaddress=${t.addr}&tag=latest&apikey=${API_KEY}`
						);
						const j = await r.json();
						holdings.push({
							token: t.symbol,
							balance: parseFloat(j.result) / 1e18
						});
					}
					document.getElementById('token-count').innerText = holdings.filter(
						(h) => h.balance > 0
					).length;
					document.getElementById('detected-exchange').innerText =
						'No exchanges detected';
                                        const tradesEl = document.getElementById('balances-list');
                                        tradesEl.innerHTML = '';
					updateBalancesUI(holdings);
				} catch (e) {
					console.error('refreshWalletData error', e);
                                        document.getElementById('balances-list').innerHTML =
                                                '<li>Error loading wallet</li>';
					document.getElementById('wallet-balance').innerText = 'N/A';
				}
			}

			async function trackWalletTransactions(addr) {
				if (!addr) return;
				if (DOM.walletTrackStatus)
					DOM.walletTrackStatus.textContent = 'Tracking...';
				const cacheKey = `dune_tx_${addr}`;
				const cached = localStorage.getItem(cacheKey);
				if (cached) {
					const obj = JSON.parse(cached);
					if (Date.now() - obj.timestamp < 3600000) {
						if (DOM.walletTrackStatus)
							DOM.walletTrackStatus.textContent = 'Cached';
						return obj.data;
					}
				}
				try {
					const url = `https://api.dune.com/api/v1/evm/transactions/${addr}?chain_id=${CHAIN_ID}`;
					const data = await fetchWithRetry(url, {
						headers: { 'x-dune-api-key': DUNE_API_KEY }
					});
					localStorage.setItem(
						cacheKey,
						JSON.stringify({ timestamp: Date.now(), data })
					);
					if (DOM.walletTrackStatus)
						DOM.walletTrackStatus.textContent = 'Tracked';
					return data;
				} catch (err) {
					console.error('Failed to track transactions', err);
					if (DOM.walletTrackStatus)
						DOM.walletTrackStatus.textContent = 'Failed';
				}
			}

			document
				.getElementById('connectWallet')
				.addEventListener('click', connectWallet);
			document
				.getElementById('refreshWalletData')
				.addEventListener('click', refreshWalletData);
			document.getElementById('toggleBalance').addEventListener('click', () => {
				balanceVisible = !balanceVisible;
				const el = document.getElementById('wallet-balance');
				if (balanceVisible) {
					el.innerText = el.dataset.full || el.innerText;
					document.getElementById('toggleBalance').innerText = 'Hide Balance';
				} else {
					el.dataset.full = el.innerText;
					el.innerText = '****';
					document.getElementById('toggleBalance').innerText = 'Show Balance';
				}
			});

			document.getElementById('toggleAddress').addEventListener('click', () => {
				addressVisible = !addressVisible;
				displayWalletAddress(walletAddress);
				document.getElementById('toggleAddress').innerText = addressVisible
					? 'Hide Address'
					: 'Show Address';
			});

                        document
                                .getElementById('balances-list')
                                .addEventListener('click', async (e) => {
					const btn = e.target.closest('.close-trade');
					if (!btn) return;
					const symbol = btn.dataset.symbol;
					const size = Math.abs(parseFloat(btn.dataset.size));
					const side = parseFloat(btn.dataset.size) > 0 ? 'SELL' : 'BUY';
					try {
						await fetch('/api/order', {
							method: 'POST',
							headers: { 'Content-Type': 'application/json' },
							body: JSON.stringify({ symbol, side, size })
						});
						refreshWalletData();
					} catch (err) {
						console.error('close trade error', err);
					}
				});
		</script>
		<script>
			let inverseChart;

			async function loadInverseChart(topCount = 10) {
				const response = await fetch(
					'https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd'
				);
				const tokens = await response.json();

				const marketTrend = tokens.reduce(
					(sum, t) => sum + t.price_change_percentage_24h,
					0
				);
				const isMarketDown = marketTrend < 0;

				let filteredTokens = tokens
					.sort((a, b) =>
						isMarketDown
							? b.price_change_percentage_24h - a.price_change_percentage_24h
							: a.price_change_percentage_24h - b.price_change_percentage_24h
					)
					.slice(0, topCount);

				const labels = filteredTokens.map((t) => t.symbol.toUpperCase());
				const data = filteredTokens.map((t) => t.price_change_percentage_24h);
				const style = getComputedStyle(document.documentElement);
                                const blue =
                                        style.getPropertyValue('--primary-color').trim() || '#00FF7E';
                                const orange =
                                        style.getPropertyValue('--secondary-color').trim() || '#FFD966';
				const bgColor = data.map((change) =>
					isMarketDown
						? change > 0
							? blue
							: orange
						: change < 0
							? orange
							: blue
				);

				const ctx = document.getElementById('inverseChart').getContext('2d');
				if (inverseChart) inverseChart.destroy();

				inverseChart = new Chart(ctx, {
					type: 'bar',
					data: {
						labels,
						datasets: [
							{
								data,
								backgroundColor: bgColor
							}
						]
					},
					options: {
						onClick: (_, items) => {
							if (items.length > 0) {
								const token = filteredTokens[items[0].index].id;
								window.open(
									`https://coinmarketcap.com/currencies/${token}/`,
									'_blank'
								);
							}
						},
						responsive: true,
						scales: {
							y: {
								beginAtZero: true,
								ticks: { color: '#ffffff' }
							},
							x: {
								ticks: {
									color: (ctx) => bgColor[ctx.index]
								}
							}
						}
					}
				});
				window.inverseChart = inverseChart;
			}

			// Add event listeners to toggle buttons for responsiveness
			document.getElementById('topCount').addEventListener('change', (e) => {
				loadInverseChart(parseInt(e.target.value));
			});

                        window.addEventListener('load', () => {
                                const unlocked = localStorage.getItem('quanti-email');
                                if (unlocked) {
                                        document.body.classList.remove('locked');
                                        initIntroVideo();
                                        loadInverseChart(10);
                                } else {
                                        document.body.classList.add('locked');
                                }
                        });
                </script>
                <footer style="text-align:center;padding:0.5rem 0;font-size:0.8rem;color:var(--quantumi-gray);">
                         QUANTUMI 2025. All Rights Reserved.
                </footer>
                <script>
                        document.addEventListener('DOMContentLoaded', () => {
                                const overlay = document.getElementById('access-overlay');
                                const form = document.getElementById('access-form');
                                const error = document.getElementById('access-error');
                                if (!overlay || !form) return;
                                if (localStorage.getItem('quanti-email')) {
                                        overlay.style.display = 'none';
                                        document.body.classList.remove('locked');
                                } else {
                                        overlay.style.display = 'flex';
                                        document.body.classList.add('locked');
                                }

                                form.addEventListener('submit', (e) => {
                                        e.preventDefault();
                                        const pwd = document.getElementById('access-password').value;
                                        const nda = document.getElementById('access-nda').checked;
                                        const email = document.getElementById('access-email').value;
                                        if (pwd === 'Limitless-93' && nda && email) {
                                                localStorage.setItem('quanti-email', email);
                                                overlay.style.display = 'none';
                                                document.body.classList.remove('locked');
                                                if (typeof initIntroVideo === 'function') initIntroVideo();
                                                loadInverseChart(10);
                                        } else {
                                                error.textContent = 'Incorrect password or missing agreement';
                                                error.classList.remove('hidden');
                                        }
                                });
                        });
                </script>
                <div class="mode-switch">Mode: Raw Hash</div>
                <div id="visualization"><!-- Future 3D BTC Hash Visualizer --></div>
                <script>
                        const modeSwitch = document.querySelector('.mode-switch');
                        let brainMode = false;
                        const updateModeLabel = () => {
                                modeSwitch.textContent = brainMode ? 'Mode: Brain' : 'Mode: Raw Hash';
                        };
                        modeSwitch.addEventListener('click', () => {
                                brainMode = !brainMode;
                                updateModeLabel();
                        });
                        window.addEventListener('keydown', (e) => {
                                if (e.key === 'm' && !['INPUT','TEXTAREA'].includes(document.activeElement.tagName)) {
                                        brainMode = !brainMode;
                                        updateModeLabel();
                                }
                        });
                        updateModeLabel();
                </script>
        </body>
</html>
